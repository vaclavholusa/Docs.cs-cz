---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Zabezpečení aplikací ověřováním a autorizací | Dokumentace Microsoftu
author: microsoft
description: Krok 9 ukazuje, jak přidat ověřování a autorizace pro zabezpečení naší aplikace NerdDinner tak, aby uživatelé potřebují k registraci a přihlaste se k webu k vytvoření...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
ms.technology: dotnet-mvc
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: d28102c8b80433b58a42cadc70b26c9fb5bc4404
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/03/2018
ms.locfileid: "37369881"
---
<a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="e55f2-103">Zabezpečení aplikací ověřováním a autorizací</span><span class="sxs-lookup"><span data-stu-id="e55f2-103">Secure Applications Using Authentication and Authorization</span></span>
====================
<span data-ttu-id="e55f2-104">podle [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="e55f2-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="e55f2-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="e55f2-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="e55f2-106">Toto je krok 9 bezplatného [kurz vývoje aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , který procházení procházení po tom, jak sestavit malý, ale bylo možné provést, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="e55f2-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="e55f2-107">Krok 9 ukazuje, jak přidat ověřování a autorizace pro zabezpečení naší aplikace NerdDinner tak, aby uživatelé potřebují k registraci a přihlášení na web za účelem vytvoření nové večeří a jenom uživatel, který je hostitelem dinner můžete upravit ho později.</span><span class="sxs-lookup"><span data-stu-id="e55f2-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="e55f2-108">Pokud používáte ASP.NET MVC 3, doporučujeme je provést [získávání začít s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="e55f2-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="e55f2-109">NerdDinner krok 9: Ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="e55f2-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="e55f2-110">Teď naše NerdDinner aplikace poskytuje všem uživatelům následujícím webu umožňuje vytvářet a upravovat podrobnosti libovolné dinner.</span><span class="sxs-lookup"><span data-stu-id="e55f2-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="e55f2-111">Změňme ji tak, aby uživatelé potřebují k registraci a přihlaste se k webu a vytvořte nový večeří, tak, aby jenom uživatel, který je hostitelem dinner můžete upravit ho později přidat omezení.</span><span class="sxs-lookup"><span data-stu-id="e55f2-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="e55f2-112">Chcete-li tuto možnost povolte, použijeme ověřování a autorizace pro zabezpečení aplikace.</span><span class="sxs-lookup"><span data-stu-id="e55f2-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="e55f2-113">Principy ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="e55f2-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="e55f2-114">*Ověřování* je proces identifikace a ověření identity klienta přístupu k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="e55f2-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="e55f2-115">Jednoduše řečeno je o identifikaci ", koncový uživatel je při návštěvě webu".</span><span class="sxs-lookup"><span data-stu-id="e55f2-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="e55f2-116">Technologie ASP.NET podporuje více způsobů, jak ověřovat uživatele prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="e55f2-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="e55f2-117">Nejběžnější metodu ověřování použitou pro webové aplikace, nazývá "Ověřování pomocí formulářů".</span><span class="sxs-lookup"><span data-stu-id="e55f2-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="e55f2-118">Ověřování pomocí formulářů umožňuje vývojářům vytvářet formuláře HTML přihlášení do své aplikace a její ověření uživatelského jména a hesla, které koncový uživatel odešle proti databázi nebo jiných přihlašovacích údajů úložiště hesel.</span><span class="sxs-lookup"><span data-stu-id="e55f2-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="e55f2-119">Pokud kombinace uživatelského jména a hesla je správný, Vývojář potom požádejte ASP.NET vydat do zašifrovaného souboru cookie HTTP k identifikaci uživatele napříč budoucí požadavky.</span><span class="sxs-lookup"><span data-stu-id="e55f2-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="e55f2-120">My se vám s použitím ověřování pomocí formulářů s naší aplikace NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="e55f2-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="e55f2-121">*Autorizace* je procesu, který určuje, zda ověřený uživatel má oprávnění pro přístup k určité adresy URL/prostředku nebo k provedení nějaké akce.</span><span class="sxs-lookup"><span data-stu-id="e55f2-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="e55f2-122">Například v rámci naší aplikace NerdDinner nám budete chtít povolit, že přístup pouze uživatelé, kteří jsou přihlášení */večeří/vytvořit* adresy URL a vytvořit nové večeří.</span><span class="sxs-lookup"><span data-stu-id="e55f2-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="e55f2-123">Můžeme také vhodné přidat logiku autorizace tak, aby jenom uživatel, který je hostitelem dinner jej mohli upravit – a všem ostatním uživatelům odepřít přístup pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="e55f2-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="e55f2-124">Ověřování pomocí formulářů a AccountController</span><span class="sxs-lookup"><span data-stu-id="e55f2-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="e55f2-125">Výchozí šablona projektu sady Visual Studio pro architekturu ASP.NET MVC automaticky povolí ověřování pomocí formulářů, při vytvoření nové aplikace ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="e55f2-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="e55f2-126">Také automaticky přidá na předem sestavených účet přihlašovací stránky implementace do projektu – díky tomu je skutečně snadno integrovat zabezpečení v rámci lokality.</span><span class="sxs-lookup"><span data-stu-id="e55f2-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="e55f2-127">Výchozí stránku předlohy Site.master zobrazí odkaz "Přihlásit" v pravé horní části webu, když nebude ověřený uživatel přístup:</span><span class="sxs-lookup"><span data-stu-id="e55f2-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="e55f2-128">Kliknutím na odkaz "Přihlásit" trvá uživateli */účet/přihlášení* adresy URL:</span><span class="sxs-lookup"><span data-stu-id="e55f2-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="e55f2-129">Návštěvníci, kteří se ještě nezaregistrovali to tak, že kliknutím na odkaz "Register" – které je pro vás přesměruje */účtu/registrace* adresy URL a umožnit jim zadejte podrobnosti o účtu:</span><span class="sxs-lookup"><span data-stu-id="e55f2-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="e55f2-130">Kliknutím na tlačítko "Register" bude vytvoření nového uživatele v rámci systému členství technologie ASP.NET a ověřit uživatele na serveru pomocí ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="e55f2-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="e55f2-131">Pokud je uživatel přihlášený, Site.master změní pravé horní části stránky a výstup "Vítejte [username]!"</span><span class="sxs-lookup"><span data-stu-id="e55f2-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="e55f2-132">zpráva a vykreslí "odhlásit" propojení namísto "přihlášení" jeden.</span><span class="sxs-lookup"><span data-stu-id="e55f2-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="e55f2-133">Kliknutím na odkaz "Odhlásit" odhlásí uživatele:</span><span class="sxs-lookup"><span data-stu-id="e55f2-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="e55f2-134">Výše uvedené přihlášení, odhlášení a registrace funkce je implementovaná v rámci AccountController třídy, která byla přidána do našich projektu ve Visual Studio při vytvoření projektu.</span><span class="sxs-lookup"><span data-stu-id="e55f2-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="e55f2-135">V uživatelském rozhraní AccountController je implementováno pomocí zobrazení šablony v adresáři \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="e55f2-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="e55f2-136">Třída AccountController využívá systém ověřování formulářů ASP.NET vydat šifrované ověřovací soubory cookie a rozhraní API členství technologie ASP.NET k ukládání a ověřit uživatelská jména a hesla.</span><span class="sxs-lookup"><span data-stu-id="e55f2-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="e55f2-137">Rozhraní API členství technologie ASP.NET je rozšiřitelný a umožňuje všechny přihlašovací údaje úložiště hesel má být použit.</span><span class="sxs-lookup"><span data-stu-id="e55f2-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="e55f2-138">Technologie ASP.NET se dodává s integrovanou členství zprostředkovatele implementace, které ukládání uživatelského jména a hesla, SQL database, nebo v rámci služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e55f2-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="e55f2-139">Nakonfigurujeme kterého zprostředkovatele členství naší aplikace NerdDinner by měl použít soubor "web.config" v kořenovém adresáři projektu otevřete a vyhledáním &lt;členství&gt; části v něm.</span><span class="sxs-lookup"><span data-stu-id="e55f2-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="e55f2-140">Výchozí soubor web.config přidat, pokud byl projekt vytvořen registruje zprostředkovatele členství SQL a nakonfiguruje ho, aby použijte připojovací řetězec s názvem "ApplicationServices" a zadejte umístění databáze.</span><span class="sxs-lookup"><span data-stu-id="e55f2-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="e55f2-141">Výchozí připojovací řetězec "ApplicationServices" (který je zadán v rámci &lt;connectionStrings&gt; část souboru web.config) je nakonfigurován na použití SQL Express.</span><span class="sxs-lookup"><span data-stu-id="e55f2-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="e55f2-142">Odkazuje na databázi SQL Express s názvem "ASPNETDB. MDF"v rámci vaší aplikace" aplikace\_Data "adresáře.</span><span class="sxs-lookup"><span data-stu-id="e55f2-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="e55f2-143">Pokud tuto databázi neexistuje okamžiku, kdy se používá rozhraní API pro členství v rámci aplikace, technologie ASP.NET automaticky vytvořit databázi a zřizování schématu databáze odpovídající členství v rámci něj:</span><span class="sxs-lookup"><span data-stu-id="e55f2-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="e55f2-144">Pokud místo SQL Express, jsme chtěli použít plná instance systému SQL Server (nebo připojení ke vzdálené databázi), všechny by potřebujeme úkolů je aktualizovat připojovací řetězec "ApplicationServices" v souboru web.config a ujistěte se, že schéma odpovídající členství byla přidána do databáze, na který odkazuje na.</span><span class="sxs-lookup"><span data-stu-id="e55f2-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="e55f2-145">Můžete spustit "aspnet\_regsql.exe" nástroje v adresáři \Windows\Microsoft.NET\Framework\v2.0.50727\ přidat příslušného schématu pro členství a dalších aplikačních služeb ASP.NET s databází.</span><span class="sxs-lookup"><span data-stu-id="e55f2-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="e55f2-146">Autorizace URL večeří/vytvořit pomocí [Authorize] filtr</span><span class="sxs-lookup"><span data-stu-id="e55f2-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="e55f2-147">Psaní kódu zabezpečené ověřování a implementaci účtu správy pro aplikace NerdDinner nebyly k dispozici.</span><span class="sxs-lookup"><span data-stu-id="e55f2-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="e55f2-148">Uživatelé můžou registrovat nové účty s naší aplikace a přihlášení/odhlášení lokality.</span><span class="sxs-lookup"><span data-stu-id="e55f2-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="e55f2-149">Teď můžeme přidat logiku ověřování k aplikaci a můžete řídit, co mohou a nemůže provádět v rámci stránky stav ověření a uživatelské jméno návštěvníků.</span><span class="sxs-lookup"><span data-stu-id="e55f2-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="e55f2-150">Začněme přidáním autorizace logiku do metody akce "Vytvořit" náš DinnersController třídy.</span><span class="sxs-lookup"><span data-stu-id="e55f2-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="e55f2-151">Konkrétně jsme se požadovat, aby uživatele, kteří používají */večeří/vytvořit* adresy URL musíte být přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="e55f2-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="e55f2-152">Pokud uživatel není přihlášený přesměrujeme je na přihlašovací stránku tak, aby se můžete přihlásit.</span><span class="sxs-lookup"><span data-stu-id="e55f2-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="e55f2-153">Implementace tuto logiku je poměrně snadné.</span><span class="sxs-lookup"><span data-stu-id="e55f2-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="e55f2-154">Všechny potřebujeme úkol má přidat atribut [Authorize] filtr na naše metody akce vytvořit takto:</span><span class="sxs-lookup"><span data-stu-id="e55f2-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="e55f2-155">ASP.NET MVC podporuje schopnost vytvářet "filtrů akce", které lze použít k implementaci opakovaně použitelné logiku, která je deklarativně použít na metody akce.</span><span class="sxs-lookup"><span data-stu-id="e55f2-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="e55f2-156">[Authorize] filtr je jeden z filtrů vestavěná akce poskytované rozhraní ASP.NET MVC a umožňuje vývojáři deklarativně aplikuje autorizační pravidla do třídy kontroleru a metody akce.</span><span class="sxs-lookup"><span data-stu-id="e55f2-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="e55f2-157">Při použití bez parametrů (jako výše) vynucuje [Authorize] filtr, musíte být přihlášeni uživatele, který vytváří požadavek metody akce – a automaticky přesměruje prohlížeč na adresu URL pro přihlášení, nejsou-li.</span><span class="sxs-lookup"><span data-stu-id="e55f2-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="e55f2-158">Při provádění této přesměrování původně požadovanou URL adresu je předán jako argument řetězce dotazu (Příklad: / účet/přihlášení? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="e55f2-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="e55f2-159">AccountController pak přesměruje uživatele zpět na původně požadovanou URL adresu po jejich přihlášení.</span><span class="sxs-lookup"><span data-stu-id="e55f2-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="e55f2-160">[Authorize] filtr volitelně podporuje možnost zadat vlastnost "Users" nebo "Role", který můžete použít tak, aby vyžadovala, že obou přihlášení uživatele a v seznamu povolených uživatelů nebo členem role zabezpečení povolené.</span><span class="sxs-lookup"><span data-stu-id="e55f2-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="e55f2-161">Například následující kód povoluje jenom dva konkrétní uživatele, "scottgu" a "billg" na adresu URL večeří nebo vytvoření:</span><span class="sxs-lookup"><span data-stu-id="e55f2-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="e55f2-162">Vložení konkrétní uživatelská jména v kódu je spíše poměrně zrušení udržovatelného ale.</span><span class="sxs-lookup"><span data-stu-id="e55f2-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="e55f2-163">Lepším řešením je definování vyšší úrovně "role", která zkontroluje kód oproti a pak pro mapování uživatelů do role pomocí databáze nebo systému služby active directory (povolení skutečného uživatelského seznamu mapování externě ukládaly z kódu).</span><span class="sxs-lookup"><span data-stu-id="e55f2-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="e55f2-164">Technologie ASP.NET obsahuje předdefinovanou roli správy rozhraní API, jakož i předdefinované sady zprostředkovatelů rolí (včetně těch, které jsou pro SQL a službu Active Directory), které vám mohou pomoci provést toto mapování uživatelů a rolí.</span><span class="sxs-lookup"><span data-stu-id="e55f2-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="e55f2-165">Jsme pak může aktualizovat kód a Povolit jenom uživatelé v rámci role konkrétní "admin" Otevřít adresu URL večeří nebo vytvoření:</span><span class="sxs-lookup"><span data-stu-id="e55f2-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="e55f2-166">Pomocí vlastnosti User.Identity.Name při vytváření večeří</span><span class="sxs-lookup"><span data-stu-id="e55f2-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="e55f2-167">Nemůžeme načíst uživatelské jméno aktuálně přihlášeného uživatele žádost pomocí vlastnosti User.Identity.Name zveřejněné na základní třídu Kontroleru.</span><span class="sxs-lookup"><span data-stu-id="e55f2-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="e55f2-168">Starší když jsme implementovali verze HTTP POST metody akce naše Create() jsme měli pevně zakódované vlastnost "HostedBy" Dinner statický řetězec.</span><span class="sxs-lookup"><span data-stu-id="e55f2-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="e55f2-169">Jsme můžete nyní aktualizovat tento kód, aby místo toho použijte vlastnost User.Identity.Name, jakož i automaticky přidat odpověď pro vytváření společnosti Dinner hostitele:</span><span class="sxs-lookup"><span data-stu-id="e55f2-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="e55f2-170">Protože jsme přidali atribut [Authorize] metodě Create(), ASP.NET MVC zajistí, že spuštění metody akce pouze pokud je uživatel navštívit adresu URL večeří nebo vytvoření přihlášení na webu.</span><span class="sxs-lookup"><span data-stu-id="e55f2-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="e55f2-171">Hodnota vlastnosti User.Identity.Name v důsledku toho bude vždy obsahovat platné uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="e55f2-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="e55f2-172">Pomocí vlastnosti User.Identity.Name při úpravách večeří</span><span class="sxs-lookup"><span data-stu-id="e55f2-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="e55f2-173">Přidejme teď některé logiku autorizace, která omezuje uživatele tak, aby mohou upravovat pouze vlastnosti večeří, které jsou hostiteli sami.</span><span class="sxs-lookup"><span data-stu-id="e55f2-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="e55f2-174">Pro usnadnění, nejprve přidáme metodu helper "IsHostedBy(username)" naše společnost Dinner objektu (v rámci Dinner.cs částečné třídy, které jsme vytvořili výše).</span><span class="sxs-lookup"><span data-stu-id="e55f2-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="e55f2-175">Tato pomocná metoda vrátí hodnotu PRAVDA nebo NEPRAVDA v závislosti na tom, jestli zadané uživatelské jméno odpovídá vlastnost Dinner HostedBy a zapouzdří logiku potřebnou k provádění porovnání nerozlišuje velikost písmen řetězců z nich:</span><span class="sxs-lookup"><span data-stu-id="e55f2-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="e55f2-176">Potom přidáme atribut [Authorize] na Edit() metody akce v rámci naší DinnersController třídy.</span><span class="sxs-lookup"><span data-stu-id="e55f2-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="e55f2-177">Tím se zajistí, že uživatelé musíte být přihlášení k žádosti */Dinners/Edit / [id]* adresy URL.</span><span class="sxs-lookup"><span data-stu-id="e55f2-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="e55f2-178">Naše úpravy metodám, které používá Dinner.IsHostedBy(username) pomocnou metodu k ověření, že přihlášeného uživatele odpovídá hostitele Dinner jsme poté můžete přidat kód.</span><span class="sxs-lookup"><span data-stu-id="e55f2-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="e55f2-179">Pokud uživatel není hostiteli, vytvoříme zobrazení "InvalidOwner" a ukončení požadavku.</span><span class="sxs-lookup"><span data-stu-id="e55f2-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="e55f2-180">Kód k tomu bude vypadat jako následující:</span><span class="sxs-lookup"><span data-stu-id="e55f2-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="e55f2-181">My pak klikněte pravým tlačítkem na adresář \Views\Dinners a zvolte možnost Add -&gt;zobrazit příkaz k vytvoření nového zobrazení "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="e55f2-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="e55f2-182">Budete ji naplníme následující chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="e55f2-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="e55f2-183">A když se uživatel pokusí upravit dinner, který není vlastníkem, získají nyní první chybovou zprávu:</span><span class="sxs-lookup"><span data-stu-id="e55f2-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="e55f2-184">V rámci kontroleru zamezit oprávnění k odstraňování večeří také a zajistili, že pouze hostitele večeři můžete odstranili jsme můžete opakujte stejný postup pro Delete() metody akce.</span><span class="sxs-lookup"><span data-stu-id="e55f2-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="e55f2-185">Zobrazení nebo skrytí upravit a odstranit odkazy</span><span class="sxs-lookup"><span data-stu-id="e55f2-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="e55f2-186">Na metodu akce upravit a odstranit třídy Naše DinnersController jsme propojení z našich podrobnosti adresy URL:</span><span class="sxs-lookup"><span data-stu-id="e55f2-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="e55f2-187">Právě jsme se zobrazují upravit a odstranit odkazy na akce bez ohledu na to, zda návštěvníky na adresu URL podrobnosti hostitele společnosti dinner.</span><span class="sxs-lookup"><span data-stu-id="e55f2-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="e55f2-188">Umožňuje změnit tak, aby odkazy se zobrazí jenom v případě hostujícími uživatel je vlastníkem společnosti dinner.</span><span class="sxs-lookup"><span data-stu-id="e55f2-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="e55f2-189">Details() metody akce v rámci naší DinnersController načte objekt Dinner a předá jej jako objekt modelu do našich zobrazení šablony:</span><span class="sxs-lookup"><span data-stu-id="e55f2-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="e55f2-190">Aktualizujeme naše zobrazit šablonu podmíněně zobrazit/skrýt odkazy upravit a odstranit pomocí Dinner.IsHostedBy() Pomocná metoda podobná níže uvedenému příkladu:</span><span class="sxs-lookup"><span data-stu-id="e55f2-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="e55f2-191">Další kroky</span><span class="sxs-lookup"><span data-stu-id="e55f2-191">Next Steps</span></span>

<span data-ttu-id="e55f2-192">Nyní Podívejme se na tom, jak jsme povolili ověřeným uživatelům RSVP pro večeří pomocí rozhraní AJAX.</span><span class="sxs-lookup"><span data-stu-id="e55f2-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e55f2-193">[Předchozí](implement-efficient-data-paging.md)
> [další](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="e55f2-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
