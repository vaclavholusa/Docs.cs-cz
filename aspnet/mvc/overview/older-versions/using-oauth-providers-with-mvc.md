---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: Použití poskytovatelů OAuth v MVC 4 | Dokumentace Microsoftu
author: tfitzmac
description: V tomto kurzu se dozvíte, jak vytvořit webovou aplikaci ASP.NET MVC 4, který umožňuje uživatelům přihlásit se pomocí přihlašovacích údajů z externího poskytovatele, jako je například Facebo...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: 9b0db2775db5c74762bdc55328ad44ef7ebe75ce
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/16/2018
ms.locfileid: "41756870"
---
<a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="dd29b-103">Použití poskytovatelů OAuth v MVC 4</span><span class="sxs-lookup"><span data-stu-id="dd29b-103">Using OAuth Providers with MVC 4</span></span>
====================
<span data-ttu-id="dd29b-104">podle [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="dd29b-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="dd29b-105">V tomto kurzu se dozvíte, jak vytvořit webovou aplikaci ASP.NET MVC 4, který umožňuje uživatelům přihlášení pomocí přihlašovacích údajů z externího poskytovatele, jako je Facebook, Twitter, Microsoft nebo Google a pak do ní některé funkce z těchto zprostředkovatelů do vaší Webová aplikace.</span><span class="sxs-lookup"><span data-stu-id="dd29b-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="dd29b-106">Pro zjednodušení tento kurz se zaměřuje na práci s přihlašovacími údaji ze sítě Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="dd29b-107">Externí přihlašovací údaje používané k webové aplikaci ASP.NET MVC 5, naleznete v tématu [vytvoření aplikace ASP.NET MVC 5 pomocí Facebooku a Google OAuth2 nebo OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="dd29b-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="dd29b-108">Povolení tyto přihlašovací údaje ve webových stránek poskytuje výraznou výhodu, protože milionům uživatelů již mají účty u těchto externích poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="dd29b-109">Tito uživatelé mohou být více ochotni zaregistrujte svůj web, pokud nemají k vytvoření a zapamatovat si novou sadu přihlašovacích údajů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="dd29b-110">Navíc po přihlášení uživatele prostřednictvím některého z těchto zprostředkovatelů, můžete začlenit sociální operace od poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="dd29b-111">Co budete vytvářet</span><span class="sxs-lookup"><span data-stu-id="dd29b-111">What you'll build</span></span>

<span data-ttu-id="dd29b-112">V tomto kurzu existují dva hlavní cíle:</span><span class="sxs-lookup"><span data-stu-id="dd29b-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="dd29b-113">Povolte tak uživateli přihlášení pomocí přihlašovacích údajů od poskytovatele OAuth.</span><span class="sxs-lookup"><span data-stu-id="dd29b-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="dd29b-114">Načíst informace o účtu ze zprostředkovatele a integrovat tyto informace se registrace účtu pro vašeho webu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="dd29b-115">I když se v příkladech v tomto kurzu se zaměřit na jako zprostředkovatel ověřování pomocí Facebooku, můžete upravit kód, který použije některý zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="dd29b-116">Postup implementace jakýkoli poskytovatel jsou velmi podobné kroky, které se zobrazí v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="dd29b-117">Lze si pouze všimnout významné rozdíly při vytvoření přímého volání rozhraní API poskytovatele nastavení.</span><span class="sxs-lookup"><span data-stu-id="dd29b-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="dd29b-118">Požadavky</span><span class="sxs-lookup"><span data-stu-id="dd29b-118">Prerequisites</span></span>

- <span data-ttu-id="dd29b-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) nebo [Microsoft Visual Studio Express 2012 pro Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="dd29b-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="dd29b-120">Nebo</span><span class="sxs-lookup"><span data-stu-id="dd29b-120">Or</span></span>

- <span data-ttu-id="dd29b-121">Microsoft Visual Studio 2010 SP1 nebo [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="dd29b-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="dd29b-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="dd29b-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="dd29b-123">Kromě toho toto téma předpokládá, že máte základní znalosti o ASP.NET MVC a sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dd29b-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="dd29b-124">Pokud potřebujete Úvod do ASP.NET MVC 4, přečtěte si [Úvod do ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="dd29b-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="dd29b-125">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="dd29b-125">Create the project</span></span>

<span data-ttu-id="dd29b-126">V sadě Visual Studio vytvořte novou aplikaci ASP.NET MVC 4 Web s názvem &quot;OAuthMVC&quot;.</span><span class="sxs-lookup"><span data-stu-id="dd29b-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="dd29b-127">Můžete cílit rozhraní .NET Framework 4.5 nebo 4.</span><span class="sxs-lookup"><span data-stu-id="dd29b-127">You can target either .NET Framework 4.5 or 4.</span></span>

![Vytvoření projektu](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="dd29b-129">V okně nového projektu ASP.NET MVC 4 vyberte **internetovou aplikaci** a nechat **Razor** jako zobrazovací modul.</span><span class="sxs-lookup"><span data-stu-id="dd29b-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Vyberte Internetové aplikace.](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="dd29b-131">Povolit zprostředkovatele</span><span class="sxs-lookup"><span data-stu-id="dd29b-131">Enable a provider</span></span>

<span data-ttu-id="dd29b-132">Při vytváření webové aplikace MVC 4 s šablonou Internetové aplikace se projekt vytvoří se soubor s názvem AuthConfig.cs v aplikaci\_spouštěcí složka.</span><span class="sxs-lookup"><span data-stu-id="dd29b-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![Soubor AuthConfig](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="dd29b-134">AuthConfig soubor obsahuje kód pro registraci klientů u zprostředkovatele externího ověřování.</span><span class="sxs-lookup"><span data-stu-id="dd29b-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="dd29b-135">Ve výchozím nastavení, tento kód je zakomentovaný, takže žádná externí zprostředkovatele není povolena.</span><span class="sxs-lookup"><span data-stu-id="dd29b-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="dd29b-136">Musíte zrušením komentáře u tohoto kódu pro použití externího ověřování klienta.</span><span class="sxs-lookup"><span data-stu-id="dd29b-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="dd29b-137">Zrušením komentáře u zprostředkovatelů, které chcete zahrnout do vaší lokality.</span><span class="sxs-lookup"><span data-stu-id="dd29b-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="dd29b-138">Pro účely tohoto kurzu vám umožní pouze pověření služby Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="dd29b-139">Všimněte si, že v příkladu výše, že metoda obsahuje prázdné řetězce pro registračních parametrů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="dd29b-140">Pokud se pokusíte spustit nyní aplikaci, aplikace vyvolá výjimku argument, protože nejsou povolené prázdné řetězce pro parametry.</span><span class="sxs-lookup"><span data-stu-id="dd29b-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="dd29b-141">Poskytnout platné hodnoty, musíte zaregistrovat svůj web u externích poskytovatelů, jak je znázorněno v následující části.</span><span class="sxs-lookup"><span data-stu-id="dd29b-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="dd29b-142">Registrace u externího poskytovatele</span><span class="sxs-lookup"><span data-stu-id="dd29b-142">Registering with an external provider</span></span>

<span data-ttu-id="dd29b-143">K ověřování uživatelů pomocí přihlašovacích údajů z externího poskytovatele, musíte zaregistrovat svůj web s tímto poskytovatelem.</span><span class="sxs-lookup"><span data-stu-id="dd29b-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="dd29b-144">Při registraci vašeho webu, zobrazí se parametry (například klíč nebo id a tajný klíč) Pokud chcete zahrnout při registraci klienta.</span><span class="sxs-lookup"><span data-stu-id="dd29b-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="dd29b-145">Účet musí mít s poskytovateli, kterou chcete použít.</span><span class="sxs-lookup"><span data-stu-id="dd29b-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="dd29b-146">Tento kurz neukazuje všechny kroky, které musíte provést při registraci těchto poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="dd29b-147">Kroky nejsou obvykle obtížné.</span><span class="sxs-lookup"><span data-stu-id="dd29b-147">The steps are typically not difficult.</span></span> <span data-ttu-id="dd29b-148">Zajištění úspěšné registrace vašeho webu, postupujte podle pokynů uvedených v těchto lokalitách.</span><span class="sxs-lookup"><span data-stu-id="dd29b-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="dd29b-149">Abyste mohli začít s registrací vašeho webu, najdete v článku webu pro vývojáře pro:</span><span class="sxs-lookup"><span data-stu-id="dd29b-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="dd29b-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="dd29b-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="dd29b-151">Google</span><span class="sxs-lookup"><span data-stu-id="dd29b-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="dd29b-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="dd29b-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="dd29b-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="dd29b-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="dd29b-154">Při registraci vašeho webu pomocí Facebooku, můžete zadat &quot;localhost&quot; domény, lokality a `&quot;http://localhost/&quot;` pro adresu URL, jak je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="dd29b-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="dd29b-155">Pomocí místního hostitele spolupracuje s poskytovateli většinu, ale aktuálně nefunguje pro zprostředkovatele společnosti Microsoft.</span><span class="sxs-lookup"><span data-stu-id="dd29b-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="dd29b-156">Pro poskytovatele Microsoft uvést adresu URL webu platná.</span><span class="sxs-lookup"><span data-stu-id="dd29b-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![registrace serveru](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="dd29b-158">Na předchozím obrázku byly odebrány hodnoty pro id aplikace, tajný klíč aplikace a kontaktní e-mailu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="dd29b-159">Při registraci ve skutečnosti vašeho webu, tyto hodnoty budou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="dd29b-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="dd29b-160">Můžete si hodnoty pro id aplikace a tajný kód aplikace, vzhledem k tomu, které přidáte do vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="dd29b-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="dd29b-161">Vytvoření testovacích uživatelů</span><span class="sxs-lookup"><span data-stu-id="dd29b-161">Creating test users</span></span>

<span data-ttu-id="dd29b-162">Pokud vám nevadí, otestujte svůj web pomocí existujícího účtu sítě Facebook, můžete tuto část přeskočit.</span><span class="sxs-lookup"><span data-stu-id="dd29b-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="dd29b-163">Můžete snadno vytvořit testovací uživatele pro vaši aplikaci v rámci stránky správy aplikace Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="dd29b-164">Můžete je použít testovací účty pro přihlášení k webu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="dd29b-165">Vytvoření testovacích uživatelů kliknutím **role** v levém navigačním podokně a klepněte na odkaz **vytvořit** odkaz.</span><span class="sxs-lookup"><span data-stu-id="dd29b-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![Vytvoření testovacích uživatelů](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="dd29b-167">Facebook lokality automaticky vytvoří počet testovací účty, které požadujete.</span><span class="sxs-lookup"><span data-stu-id="dd29b-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="dd29b-168">Přidání id aplikace a tajný kód od poskytovatele</span><span class="sxs-lookup"><span data-stu-id="dd29b-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="dd29b-169">Teď, když jste obdrželi id a tajný kód ze sítě Facebook, vraťte se do souboru AuthConfig a přidejte je jako hodnoty parametrů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="dd29b-170">Hodnoty zobrazené níže nejsou skutečné hodnoty.</span><span class="sxs-lookup"><span data-stu-id="dd29b-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="dd29b-171">Přihlaste se pomocí přihlašovacích údajů externí</span><span class="sxs-lookup"><span data-stu-id="dd29b-171">Log in with external credentials</span></span>

<span data-ttu-id="dd29b-172">To je všechno, co musíte udělat, abyste povolte externí přihlašovací údaje na vašem webu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="dd29b-173">Spusťte aplikaci a klikněte na odkaz přihlášení v pravém horním rohu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="dd29b-174">Šablona automaticky rozpozná registrovány jako poskytovatel sítě Facebook a obsahuje tlačítko pro zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="dd29b-175">Když si zaregistrujete několik zprostředkovatelů, tlačítko pro každé z nich je automaticky zahrnuty.</span><span class="sxs-lookup"><span data-stu-id="dd29b-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![externí přihlášení](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="dd29b-177">V tomto kurzu ale nenajdete, jak přizpůsobit přihlašovací tlačítka pro externí poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="dd29b-178">Informace najdete v tématu [přizpůsobení uživatelské rozhraní pro přihlášení při použití účtu OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="dd29b-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="dd29b-179">Klikněte na tlačítko Facebooku se chcete přihlásit pomocí přihlašovacích údajů k Facebooku.</span><span class="sxs-lookup"><span data-stu-id="dd29b-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="dd29b-180">Při výběru jednoho z externích poskytovatelů, jsou přesměrován na dané lokalitě a tyto služby výzva k přihlášení.</span><span class="sxs-lookup"><span data-stu-id="dd29b-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="dd29b-181">Následující obrázek ukazuje na přihlašovací obrazovce pro Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="dd29b-182">Poznamenává, že používáte Facebookový účet k přihlášení na web s názvem oauthmvcexample.</span><span class="sxs-lookup"><span data-stu-id="dd29b-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![ověřování facebooku](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="dd29b-184">Po přihlášení pomocí přihlašovacích údajů k Facebooku, na stránce informuje uživatele, že web bude mít přístup k základní informace.</span><span class="sxs-lookup"><span data-stu-id="dd29b-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![žádost o oprávnění](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="dd29b-186">Po výběru **přejít do aplikace**, uživatel musí zaregistrovat pro lokalitu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="dd29b-187">Následující obrázek ukazuje na registrační stránku po uživatel přihlásil se pomocí přihlašovacích údajů k Facebooku.</span><span class="sxs-lookup"><span data-stu-id="dd29b-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="dd29b-188">Uživatelské jméno je obvykle předem vyplněná název od poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-188">The user name is typically pre-filled with a name from the provider.</span></span>

![register](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="dd29b-190">Klikněte na tlačítko **zaregistrovat** dokončit registraci.</span><span class="sxs-lookup"><span data-stu-id="dd29b-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="dd29b-191">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="dd29b-191">Close the browser.</span></span>

<span data-ttu-id="dd29b-192">Uvidíte, že byl přidán nový účet k vaší databázi.</span><span class="sxs-lookup"><span data-stu-id="dd29b-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="dd29b-193">V Průzkumníku serveru, otevřete **objekt DefaultConnection** databáze a otevřete **tabulky** složky.</span><span class="sxs-lookup"><span data-stu-id="dd29b-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![tabulky databáze](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="dd29b-195">Klikněte pravým tlačítkem myši **UserProfile** tabulce a vybrat **zobrazit Data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="dd29b-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![zobrazení dat](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="dd29b-197">Zobrazí se nový účet, který jste přidali.</span><span class="sxs-lookup"><span data-stu-id="dd29b-197">You will see the new account you added.</span></span> <span data-ttu-id="dd29b-198">Podívejte se na data v **webová stránka\_OAuthMembership** tabulky.</span><span class="sxs-lookup"><span data-stu-id="dd29b-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="dd29b-199">Zobrazí se další data související s externí zprostředkovatele pro účet, který jste právě přidali.</span><span class="sxs-lookup"><span data-stu-id="dd29b-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="dd29b-200">Pokud chcete povolit externí ověřování, jste hotovi.</span><span class="sxs-lookup"><span data-stu-id="dd29b-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="dd29b-201">Ale můžete dál integrovat informace od poskytovatele do nový proces registrace uživatele, jak je znázorněno v následujících částech.</span><span class="sxs-lookup"><span data-stu-id="dd29b-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="dd29b-202">Vytváření modelů pro dalších informací o uživatelích</span><span class="sxs-lookup"><span data-stu-id="dd29b-202">Create models for additional user information</span></span>

<span data-ttu-id="dd29b-203">Protože jste si všimli v předchozích částech, není potřeba žádné další informace pro registraci předdefinovaný účet pro práci.</span><span class="sxs-lookup"><span data-stu-id="dd29b-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="dd29b-204">Většina externích poskytovatelů však předat zpět Další informace o uživateli.</span><span class="sxs-lookup"><span data-stu-id="dd29b-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="dd29b-205">Následující části vysvětlují, jak zachovat tyto informace a uložte ho do databáze.</span><span class="sxs-lookup"><span data-stu-id="dd29b-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="dd29b-206">Konkrétně si zachovají hodnoty pro celé jméno uživatele, identifikátor URI uživatele osobní webové stránky a hodnotu, která označuje, zda má Facebooku ověřit účet.</span><span class="sxs-lookup"><span data-stu-id="dd29b-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="dd29b-207">Budete používat [migrace Code First](https://msdn.microsoft.com/data/jj591621) přidat tabulku pro ukládání dalších informací o uživatelích.</span><span class="sxs-lookup"><span data-stu-id="dd29b-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="dd29b-208">V tabulce přidáváte do existující databáze, proto musíte nejdřív vytvořit snímek aktuální databázi.</span><span class="sxs-lookup"><span data-stu-id="dd29b-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="dd29b-209">Vytvořením snímek aktuální databázi, můžete později vytvořit migraci, která obsahuje pouze nové tabulky.</span><span class="sxs-lookup"><span data-stu-id="dd29b-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="dd29b-210">Chcete-li vytvořit snímek aktuální databázi:</span><span class="sxs-lookup"><span data-stu-id="dd29b-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="dd29b-211">Otevřít **Konzola správce balíčků**</span><span class="sxs-lookup"><span data-stu-id="dd29b-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="dd29b-212">Spusťte příkaz **povolení migrace**</span><span class="sxs-lookup"><span data-stu-id="dd29b-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="dd29b-213">Spusťte příkaz **přidat migrace počáteční – IgnoreChanges**</span><span class="sxs-lookup"><span data-stu-id="dd29b-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="dd29b-214">Spusťte příkaz **aktualizace databáze**</span><span class="sxs-lookup"><span data-stu-id="dd29b-214">Run the command **update-database**</span></span>

<span data-ttu-id="dd29b-215">Nyní přidáte nové vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="dd29b-215">Now, you will add the new properties.</span></span> <span data-ttu-id="dd29b-216">Ve složce modely otevřete soubor AccountModels.cs a najít RegisterExternalLoginModel třídu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="dd29b-217">Třída RegisterExternalLoginModel obsahuje hodnoty, které vrátit ze zprostředkovatele ověřování.</span><span class="sxs-lookup"><span data-stu-id="dd29b-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="dd29b-218">Přidáte vlastnosti s názvem FullName a odkaz, jak je zdůrazněno níže.</span><span class="sxs-lookup"><span data-stu-id="dd29b-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="dd29b-219">Také v AccountModels.cs, přidejte novou třídu s názvem ExtraUserInformation.</span><span class="sxs-lookup"><span data-stu-id="dd29b-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="dd29b-220">Tato třída představuje nové tabulky, který se vytvoří v databázi.</span><span class="sxs-lookup"><span data-stu-id="dd29b-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="dd29b-221">Ve třídě UsersContext přidáte zvýrazněný kód uvedený níže pro vytvoření vlastnosti DbSet pro novou třídu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="dd29b-222">Nyní jste připraveni vytvořit novou tabulku.</span><span class="sxs-lookup"><span data-stu-id="dd29b-222">You are now ready to create the new table.</span></span> <span data-ttu-id="dd29b-223">Otevřete konzolu Správce balíčků znovu a tentokrát:</span><span class="sxs-lookup"><span data-stu-id="dd29b-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="dd29b-224">Spusťte příkaz **AddExtraUserInformation přidat migrace**</span><span class="sxs-lookup"><span data-stu-id="dd29b-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="dd29b-225">Spusťte příkaz **aktualizace databáze**</span><span class="sxs-lookup"><span data-stu-id="dd29b-225">Run the command **update-database**</span></span>

<span data-ttu-id="dd29b-226">Nová tabulka nyní v databázi existuje.</span><span class="sxs-lookup"><span data-stu-id="dd29b-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="dd29b-227">Načíst další data.</span><span class="sxs-lookup"><span data-stu-id="dd29b-227">Retrieve the additional data</span></span>

<span data-ttu-id="dd29b-228">Existují dva způsoby, jak načíst další uživatelská data.</span><span class="sxs-lookup"><span data-stu-id="dd29b-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="dd29b-229">Prvním způsobem je chcete zachovat data uživatele, který je předán zpět, ve výchozím nastavení, během žádosti o ověření.</span><span class="sxs-lookup"><span data-stu-id="dd29b-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="dd29b-230">Druhý způsob je konkrétně volat rozhraní API poskytovatele a požádat o další informace.</span><span class="sxs-lookup"><span data-stu-id="dd29b-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="dd29b-231">Hodnoty pro jméno a příjmení a odkazu jsou automaticky předány zpět pomocí Facebooku.</span><span class="sxs-lookup"><span data-stu-id="dd29b-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="dd29b-232">Přistoupíte přímo pomocí volání rozhraní API Facebooku se načte hodnotu určující, zda má Facebooku ověřit účet.</span><span class="sxs-lookup"><span data-stu-id="dd29b-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="dd29b-233">Nejprve bude vyplněné hodnoty pro jméno a příjmení a odkaz a později získáte hodnotu ověřené.</span><span class="sxs-lookup"><span data-stu-id="dd29b-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="dd29b-234">Chcete-li načíst další uživatelská data, otevřete **AccountController.cs** soubor **řadiče** složky.</span><span class="sxs-lookup"><span data-stu-id="dd29b-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="dd29b-235">Tento soubor obsahuje logiku pro protokolování, registrace a správy účtů.</span><span class="sxs-lookup"><span data-stu-id="dd29b-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="dd29b-236">Zejména, Všimněte si, že volání metody **ExternalLoginCallback** a **ExternalLoginConfirmation**.</span><span class="sxs-lookup"><span data-stu-id="dd29b-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="dd29b-237">V rámci těchto metod můžete přidat kód pro přizpůsobení operací externí přihlášení pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="dd29b-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="dd29b-238">První řádek **ExternalLoginCallback** metoda obsahuje:</span><span class="sxs-lookup"><span data-stu-id="dd29b-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="dd29b-239">Další uživatelská data je předán **ExtraData** vlastnost **AuthenticationResult** objekt, který je vrácen z **VerifyAuthentication** metody.</span><span class="sxs-lookup"><span data-stu-id="dd29b-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="dd29b-240">Klient sítě Facebook obsahuje následující hodnoty **ExtraData** vlastnost:</span><span class="sxs-lookup"><span data-stu-id="dd29b-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="dd29b-241">id</span><span class="sxs-lookup"><span data-stu-id="dd29b-241">id</span></span>
- <span data-ttu-id="dd29b-242">name</span><span class="sxs-lookup"><span data-stu-id="dd29b-242">name</span></span>
- <span data-ttu-id="dd29b-243">Odkaz</span><span class="sxs-lookup"><span data-stu-id="dd29b-243">link</span></span>
- <span data-ttu-id="dd29b-244">pohlaví</span><span class="sxs-lookup"><span data-stu-id="dd29b-244">gender</span></span>
- <span data-ttu-id="dd29b-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="dd29b-245">accesstoken</span></span>

<span data-ttu-id="dd29b-246">Ostatní zprostředkovatelé budou mít podobné, ale mírně odlišné data ve vlastnosti ExtraData.</span><span class="sxs-lookup"><span data-stu-id="dd29b-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="dd29b-247">Pokud uživatel je nový na váš web, bude načítat některé další data a předat data do zobrazení potvrzení.</span><span class="sxs-lookup"><span data-stu-id="dd29b-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="dd29b-248">Poslední blok kódu v metodě se spustí pouze v případě, že uživatel je nový na váš web.</span><span class="sxs-lookup"><span data-stu-id="dd29b-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="dd29b-249">Nahraďte následující řádek:</span><span class="sxs-lookup"><span data-stu-id="dd29b-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="dd29b-250">Tento řádek:</span><span class="sxs-lookup"><span data-stu-id="dd29b-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="dd29b-251">Tato změna zahrnuje pouze hodnoty vlastností FullName a odkaz.</span><span class="sxs-lookup"><span data-stu-id="dd29b-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="dd29b-252">V **ExternalLoginConfirmation** metoda, upravte kód zvýraznily níže můžete uložit dalších informací o uživatelích.</span><span class="sxs-lookup"><span data-stu-id="dd29b-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="dd29b-253">Úprava zobrazení</span><span class="sxs-lookup"><span data-stu-id="dd29b-253">Adjusting the view</span></span>

<span data-ttu-id="dd29b-254">Zobrazí se další uživatelská data, která se načítají ze zprostředkovatele na stránce registrace.</span><span class="sxs-lookup"><span data-stu-id="dd29b-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="dd29b-255">V **zobrazení**/**účet** složku, otevřete **ExternalLoginConfirmation.cshtml**.</span><span class="sxs-lookup"><span data-stu-id="dd29b-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="dd29b-256">Pod existující pole pro uživatelské jméno přidejte pole pro jméno a příjmení, propojení a PictureLink.</span><span class="sxs-lookup"><span data-stu-id="dd29b-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="dd29b-257">Nyní jste téměř připraveni aplikaci spustit a zaregistrovat nového uživatele s dodatečnými informacemi, které jsou uloženy.</span><span class="sxs-lookup"><span data-stu-id="dd29b-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="dd29b-258">Musíte mít účet, který není serveru již zaregistrován.</span><span class="sxs-lookup"><span data-stu-id="dd29b-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="dd29b-259">Můžete buď použití různých testovacích účtu nebo odstranit řádky v tabulce **UserProfile** a **webové stránky\_OAuthMembership** tabulky pro účet, který chcete znovu použít.</span><span class="sxs-lookup"><span data-stu-id="dd29b-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="dd29b-260">Odstraněním tyto řádky zajistí, že účet je zaregistrovat znovu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="dd29b-261">Spusťte aplikaci a zaregistrovat nové uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-261">Run the application and register the new user.</span></span> <span data-ttu-id="dd29b-262">Všimněte si, že tentokrát stránku potvrzení obsahuje více hodnot.</span><span class="sxs-lookup"><span data-stu-id="dd29b-262">Notice that this time the confirmation page contains more values.</span></span>

![register](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="dd29b-264">Po dokončení registrace, ukončete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="dd29b-264">After completing registration, close the browser.</span></span> <span data-ttu-id="dd29b-265">Podívejte se v databázi a Všimněte si nových hodnot v **ExtraUserInformation** tabulky.</span><span class="sxs-lookup"><span data-stu-id="dd29b-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="dd29b-266">Nainstalujte balíček NuGet pro rozhraní API Facebooku</span><span class="sxs-lookup"><span data-stu-id="dd29b-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="dd29b-267">Poskytuje služby Facebook [API](https://developers.facebook.com/docs/reference/apis/) , že můžete volat k provádění operací.</span><span class="sxs-lookup"><span data-stu-id="dd29b-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="dd29b-268">Můžete volat rozhraní API Facebooku přesměrováním odesílání požadavků HTTP nebo pomocí instalace balíčku NuGet, který usnadňuje odesílání těchto požadavků.</span><span class="sxs-lookup"><span data-stu-id="dd29b-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="dd29b-269">Pomocí balíčku NuGet se zobrazí v tomto kurzu, ale instalace NuGet balíček není nezbytné.</span><span class="sxs-lookup"><span data-stu-id="dd29b-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="dd29b-270">Tento kurz ukazuje, jak použít balíček SDK Facebooku jazyk C#.</span><span class="sxs-lookup"><span data-stu-id="dd29b-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="dd29b-271">Existují další balíčky NuGet, které vám pomůže s volání rozhraní API sítě Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="dd29b-272">Z **spravovat balíčky NuGet** windows, vyberte balíček SDK Facebooku jazyk C#.</span><span class="sxs-lookup"><span data-stu-id="dd29b-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![instalovat balíček](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="dd29b-274">Facebook C# SDK bude používat k volání operace, která vyžaduje přístupový token pro daného uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="dd29b-275">V další části ukazuje, jak získat přístupový token.</span><span class="sxs-lookup"><span data-stu-id="dd29b-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="dd29b-276">Načtení přístupového tokenu</span><span class="sxs-lookup"><span data-stu-id="dd29b-276">Retrieve access token</span></span>

<span data-ttu-id="dd29b-277">Většina externích poskytovatelů předávání zpátky přístupový token po ověření přihlašovacích údajů uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="dd29b-278">Tento přístupový token je velmi důležité, protože umožňuje volat operace, které jsou dostupné pouze pro ověřené uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="dd29b-279">Načítání a ukládání přístupového tokenu je proto zásadní Pokud byste chtěli poskytnout více funkcí.</span><span class="sxs-lookup"><span data-stu-id="dd29b-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="dd29b-280">V závislosti na externího zprostředkovatele může být přístupový token platný pro pouze omezené množství času.</span><span class="sxs-lookup"><span data-stu-id="dd29b-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="dd29b-281">Aby bylo zajištěno, že máte platný přístupový token, se budou načítat ho pokaždé, když uživatel přihlásí a uložte ho jako hodnotu relace místo uložení do databáze.</span><span class="sxs-lookup"><span data-stu-id="dd29b-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="dd29b-282">V **ExternalLoginCallback** metoda, přístupový token je také se předat zpátky **ExtraData** vlastnost **AuthenticationResult** objektu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="dd29b-283">Přidejte zvýrazněný kód, který **ExternalLoginCallback** uložit přístupový token v **relace** objektu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="dd29b-284">Tento kód spuštěný pokaždé, když se uživatel přihlásí pomocí účtu sítě Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="dd29b-285">Přestože tento příklad načte přístupový token z Facebooku, můžete načíst přístupový token z jakékoli externího poskytovatele pomocí stejný klíč s názvem &quot;accesstoken&quot;.</span><span class="sxs-lookup"><span data-stu-id="dd29b-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="dd29b-286">Odhlášení</span><span class="sxs-lookup"><span data-stu-id="dd29b-286">Logging off</span></span>

<span data-ttu-id="dd29b-287">Výchozí hodnota **odhlášení** metoda přihlásí uživatele přesunete mimo svou aplikaci, ale není přihlášení uživatele z externího poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="dd29b-288">Přihlášení uživatele z Facebooku a zabránit token uchování až uživatel odhlásí, můžete přidat následující zvýrazněný kód **odhlášení** metodu AccountController.</span><span class="sxs-lookup"><span data-stu-id="dd29b-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="dd29b-289">Hodnota je zadat v `next` parametr je adresa URL pro použití po uživatel přihlásí ze sítě Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="dd29b-290">Při testování v místním počítači, by se správným číslem portu zadejte pro místní lokalitu.</span><span class="sxs-lookup"><span data-stu-id="dd29b-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="dd29b-291">V produkčním prostředí by poskytují výchozí stránku, třeba contoso.com.</span><span class="sxs-lookup"><span data-stu-id="dd29b-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="dd29b-292">Načítání informací o uživatelích, které vyžaduje přístupový token</span><span class="sxs-lookup"><span data-stu-id="dd29b-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="dd29b-293">Teď, když máte uložené přístupový token a nainstalován balíček SDK Facebooku jazyk C#, můžete je použít společně k vyžádání dalších informací o uživatelích ze sítě Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="dd29b-294">V **ExternalLoginConfirmation** metody vytvoření instance **FacebookClient** třídy předáním hodnoty přístupový token.</span><span class="sxs-lookup"><span data-stu-id="dd29b-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="dd29b-295">Požádat o hodnotu **ověřit** vlastnost pro aktuální, ověřeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="dd29b-296">**Ověřit** vlastnost určuje, zda Facebooku ověřila účtu pomocí jiné prostředky, jako je odeslání zprávy na mobilní telefon.</span><span class="sxs-lookup"><span data-stu-id="dd29b-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="dd29b-297">Uloží tuto hodnotu v databázi.</span><span class="sxs-lookup"><span data-stu-id="dd29b-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="dd29b-298">Bude nutné znovu odstranit záznamy v databázi pro uživatele, nebo použijte jiný účet Facebook.</span><span class="sxs-lookup"><span data-stu-id="dd29b-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="dd29b-299">Spusťte aplikaci a zaregistrovat nové uživatele.</span><span class="sxs-lookup"><span data-stu-id="dd29b-299">Run the application, and register the new user.</span></span> <span data-ttu-id="dd29b-300">Podívejte se na **ExtraUserInformation** tabulky a zobrazit tak hodnotu pro vlastnost ověřeno.</span><span class="sxs-lookup"><span data-stu-id="dd29b-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="dd29b-301">Závěr</span><span class="sxs-lookup"><span data-stu-id="dd29b-301">Conclusion</span></span>

<span data-ttu-id="dd29b-302">V tomto kurzu jste vytvořili lokalitu, která je integrovaná se službou Facebook pro ověřování uživatelů a registrační data.</span><span class="sxs-lookup"><span data-stu-id="dd29b-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="dd29b-303">Jste se dozvěděli o výchozí chování, který je nastaven pro webové aplikace MVC 4 a tom, jak přizpůsobit výchozí chování.</span><span class="sxs-lookup"><span data-stu-id="dd29b-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dd29b-304">Související témata</span><span class="sxs-lookup"><span data-stu-id="dd29b-304">Related topics</span></span>

- [<span data-ttu-id="dd29b-305">Vytvoření aplikace ASP.NET MVC pomocí ověření a SQL DB a nasazení do služby Azure App Service</span><span class="sxs-lookup"><span data-stu-id="dd29b-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
