---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
title: Vytváření vlastního databázově řízeného zprostředkovatele mapy webu (VB) | Dokumentace Microsoftu
author: rick-anderson
description: Výchozího zprostředkovatele mapy webu v technologii ASP.NET 2.0 načte data ze statického souboru XML. Je vhodné pro mnoho malé a střední okno velikosti zprostředkovatele založený na formátu XML...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: f904cd2c-a408-4484-9324-8b8d7fe33893
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
msc.type: authoredcontent
ms.openlocfilehash: 55658c563b6dd3c3b097e562cb1fe036bbfce815
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/16/2018
ms.locfileid: "41756020"
---
<a name="building-a-custom-database-driven-site-map-provider-vb"></a><span data-ttu-id="a842a-104">Vytváření vlastního databázově řízeného zprostředkovatele mapy webu (VB)</span><span class="sxs-lookup"><span data-stu-id="a842a-104">Building a Custom Database-Driven Site Map Provider (VB)</span></span>
====================
<span data-ttu-id="a842a-105">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a842a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a842a-106">[Stáhněte si kód](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) nebo [stahovat PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a842a-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span></span>

> <span data-ttu-id="a842a-107">Výchozího zprostředkovatele mapy webu v technologii ASP.NET 2.0 načte data ze statického souboru XML.</span><span class="sxs-lookup"><span data-stu-id="a842a-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="a842a-108">Zatímco zprostředkovatele založený na formátu XML je vhodný pro mnoho malé a středně velké webové stránky, větší webových aplikací vyžaduje více dynamická Mapa webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="a842a-109">V tomto kurzu vytvoříme vlastního zprostředkovatele mapy webu, který načte data z vrstvy obchodní logiky, která načte data z databáze.</span><span class="sxs-lookup"><span data-stu-id="a842a-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="a842a-110">Úvod</span><span class="sxs-lookup"><span data-stu-id="a842a-110">Introduction</span></span>

<span data-ttu-id="a842a-111">ASP.NET 2.0 s funkce mapy webu umožňuje vývojářům definovat mapy webu webové aplikace s některé trvalou média, jako například v souboru XML.</span><span class="sxs-lookup"><span data-stu-id="a842a-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="a842a-112">Po definování data mapy webu je přístupná prostřednictvím kódu programu přes [ `SiteMap` třídy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) v [ `System.Web` obor názvů](https://msdn.microsoft.com/library/system.web.aspx) nebo prostřednictvím různých navigace webové ovládací prvky, například Ovládací prvky SiteMapPath, nabídky a prvku TreeView.</span><span class="sxs-lookup"><span data-stu-id="a842a-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="a842a-113">Mapa systém lokality používá [modelu poskytovatele](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) tak, aby implementace serializace jiné lokalitě mapy se dají vytvářet a zapojí se do webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="a842a-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="a842a-114">Výchozího zprostředkovatele mapy webu, která je dodávána s prostředím ASP.NET 2.0 nevyřeší struktury mapy webu v souboru XML.</span><span class="sxs-lookup"><span data-stu-id="a842a-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="a842a-115">Zpátky [stránky předlohy a navigace na webu](../introduction/master-pages-and-site-navigation-vb.md) kurzu jsme vytvořili soubor s názvem `Web.sitemap` , která obsahovala tuto strukturu a se aktualizuje její XML s každé nové části kurzu.</span><span class="sxs-lookup"><span data-stu-id="a842a-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="a842a-116">Zprostředkovatele mapy webu založený na formátu XML výchozí dobře fungují v případě strukturu s mapy webu je poměrně statická, například pro tyto kurzy.</span><span class="sxs-lookup"><span data-stu-id="a842a-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="a842a-117">V mnoha případech ale více dynamická Mapa webu je potřeba.</span><span class="sxs-lookup"><span data-stu-id="a842a-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="a842a-118">Vezměte v úvahu mapy webu je znázorněno na obrázku 1, kde každé kategorie a produkt zobrazí jako oddíly ve struktuře s webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="a842a-119">Pomocí této mapy webu navštívit webovou stránku odpovídající kořenový uzel může být seznam všech kategorií, že určité kategorie s webové stránce by zobrazila seznam této kategorie s produkty a zobrazení webové stránky s konkrétním produktu by zobrazil produktu s podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="a842a-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="a842a-120">[![Kategorie a produkty strukturu mapu s struktury webu](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span></span>

<span data-ttu-id="a842a-121">**Obrázek 1**: The kategorie a strukturu produktů mapy webu s strukturu ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span></span>


<span data-ttu-id="a842a-122">I když tato struktura podle kategorie a produktů může být pevně zakódovaný do `Web.sitemap` souboru, soubor bude potřeba aktualizovat pokaždé, když kategorie nebo produkt byl přidat, odebrat nebo přejmenovat.</span><span class="sxs-lookup"><span data-stu-id="a842a-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="a842a-123">V důsledku toho mapy Údržba webového serveru by se dá výrazně zjednodušit. Pokud své struktury byla získána z databáze, nebo v ideálním případě z vrstvy obchodní logiky architektury s aplikací.</span><span class="sxs-lookup"><span data-stu-id="a842a-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="a842a-124">Tímto způsobem, jak byly přidány produktů a kategorie, přejmenována nebo odstraněna, mapy webu bude automaticky aktualizovat tak, aby odrážela tyto změny.</span><span class="sxs-lookup"><span data-stu-id="a842a-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="a842a-125">Protože serializace mapování lokality s ASP.NET 2.0 je vytvořeným na základě podle modelu poskytovatele, můžeme vytvořit vlastní vlastního zprostředkovatele mapy webu, který získá data z nebo alternativní datové úložiště, jako jsou databáze nebo architekturu.</span><span class="sxs-lookup"><span data-stu-id="a842a-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="a842a-126">V tomto kurzu vytvoříme vlastní poskytovatele, který načte data z BLL.</span><span class="sxs-lookup"><span data-stu-id="a842a-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="a842a-127">Začínáme s let!</span><span class="sxs-lookup"><span data-stu-id="a842a-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="a842a-128">Vlastního zprostředkovatele mapy webu v tomto kurzu vytvořili je těsně spjat s aplikace s architekturou a datový model.</span><span class="sxs-lookup"><span data-stu-id="a842a-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="a842a-129">Jeff Prosise s [ukládání mapy webu v systému SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) a [zprostředkovatele mapy webu SQL jste již bylo čekání](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) články prozkoumat zobecněný přístup k ukládání dat mapy webu v systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a842a-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="a842a-130">Krok 1: Vytvoření vlastní stránky mapy poskytovatele webových stránek</span><span class="sxs-lookup"><span data-stu-id="a842a-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="a842a-131">Než začneme vytvořením vlastního zprostředkovatele mapy webu, umožní s nejprve přidat stránek ASP.NET, kterou potřebujeme pro účely tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="a842a-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="a842a-132">Začněte přidáním novou složku s názvem `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="a842a-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="a842a-133">Dále přidejte následující stránky ASP.NET do této složky, nezapomeňte přiřadit každou stránku s `Site.master` hlavní stránky:</span><span class="sxs-lookup"><span data-stu-id="a842a-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="a842a-134">Také přidat `CustomProviders` podsložku `App_Code` složky.</span><span class="sxs-lookup"><span data-stu-id="a842a-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![Přidání stránky technologie ASP.NET pro kurzy související zprostředkovatele mapy webu](building-a-custom-database-driven-site-map-provider-vb/_static/image2.gif)

<span data-ttu-id="a842a-136">**Obrázek 2**: Přidání stránky ASP.NET pro web mapování kurzy týkající se poskytovatele</span><span class="sxs-lookup"><span data-stu-id="a842a-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="a842a-137">Vzhledem k tomu, že existuje pouze jeden kurz v této části, budeme zadávat nepotřebujete `Default.aspx` seznam v části s kurzech.</span><span class="sxs-lookup"><span data-stu-id="a842a-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="a842a-138">Místo toho `Default.aspx` kategorií se zobrazí v ovládacím prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="a842a-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="a842a-139">To jsme budete řešit v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="a842a-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="a842a-140">Dále, aktualizujte `Web.sitemap` zahrnout odkaz na `Default.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a842a-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="a842a-141">Konkrétně, přidejte následující kód za ukládání do mezipaměti `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="a842a-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample1.xml)]

<span data-ttu-id="a842a-142">Po aktualizaci `Web.sitemap`, věnujte chvíli zobrazit kurzy web prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a842a-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="a842a-143">V nabídce na levé straně nyní obsahuje položku pro tento kurz zprostředkovatele mapy jediný server.</span><span class="sxs-lookup"><span data-stu-id="a842a-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![Mapa webu nyní obsahuje záznam pro tento kurz zprostředkovatele mapy webu](building-a-custom-database-driven-site-map-provider-vb/_static/image3.gif)

<span data-ttu-id="a842a-145">**Obrázek 3**: mapy webu nyní obsahuje záznam pro tento kurz zprostředkovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="a842a-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="a842a-146">Tento kurz s hlavní fokus je pro ilustraci vlastního zprostředkovatele mapy webu vytváření a konfigurace webové aplikace k používání tohoto zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="a842a-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="a842a-147">Zejména vytvoříme poskytovatele, který vrátí mapy webu, který obsahuje kořenový uzel společně s uzlem pro každou kategorii a produkt, jak je znázorněno na obrázku 1.</span><span class="sxs-lookup"><span data-stu-id="a842a-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="a842a-148">Obecně platí může každý uzel v mapě webu zadejte adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a842a-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="a842a-149">Pro naše Mapa webu, bude mít adresu URL uzlu s kořenové `~/SiteMapProvider/Default.aspx`, který zobrazí seznam všech kategorií v databázi.</span><span class="sxs-lookup"><span data-stu-id="a842a-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="a842a-150">Každý uzel kategorie v mapě webu bude mít adresu URL, která odkazuje na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, který se zobrazí všechny produkty v zadaném *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="a842a-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="a842a-151">A konečně, bude každý uzel mapy webu produktu přejděte na `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, který se zobrazí podrobnosti o konkrétním produktu s.</span><span class="sxs-lookup"><span data-stu-id="a842a-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="a842a-152">Chcete-li spustit potřebujeme vytvořit `Default.aspx`, `ProductsByCategory.aspx`, a `ProductDetails.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a842a-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="a842a-153">Tyto stránky se provádí v kroku 2, 3 a 4, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="a842a-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="a842a-154">Protože těžiště tohoto kurzu je na poskytovatelé map webu, a od poslední kurzy pokryli vytváření sestav se tyto druhy vícestránkového záznamů master/detail jsme se hurry prostřednictvím kroky 2 až 4.</span><span class="sxs-lookup"><span data-stu-id="a842a-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="a842a-155">Pokud potřebujete občerstvit o vytváření záznamů master/detail sestav, které přesahují délku jedné stránky, vraťte se do [filtrování záznamů Master/Detail napříč dvěma stránkami](../masterdetail/master-detail-filtering-across-two-pages-vb.md) kurzu.</span><span class="sxs-lookup"><span data-stu-id="a842a-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="a842a-156">Krok 2: Zobrazení seznamu kategorií</span><span class="sxs-lookup"><span data-stu-id="a842a-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="a842a-157">Otevřít `Default.aspx` stránku `SiteMapProvider` složky a GridView přetáhněte z panelu nástrojů do Návrháře nastavení jeho `ID` k `Categories`.</span><span class="sxs-lookup"><span data-stu-id="a842a-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="a842a-158">Z inteligentních značek GridView s vázat na nového prvku ObjectDataSource s názvem `CategoriesDataSource` a nakonfigurujte ho tak, aby jej obnoví svoje data pomocí `CategoriesBLL` třída s `GetCategories` metody.</span><span class="sxs-lookup"><span data-stu-id="a842a-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="a842a-159">Od tohoto ovládacího prvku GridView stačí zobrazí kategorie a neposkytuje funkce pro úpravu dat, nastavte rozevírací seznamy v UPDATE, INSERT a odstranit karty na (žádný).</span><span class="sxs-lookup"><span data-stu-id="a842a-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="a842a-160">[![Konfigurace ObjectDataSource vrátit kategorií pomocí GetCategories – metoda](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span></span>

<span data-ttu-id="a842a-161">**Obrázek 4**: Konfigurace ObjectDataSource vrátit pomocí kategorií `GetCategories` – metoda ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span></span>


<span data-ttu-id="a842a-162">[![Nastavte rozevírací seznamy v UPDATE, INSERT a odstranit karty na (žádný)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span></span>

<span data-ttu-id="a842a-163">**Obrázek 5**: Nastavte rozevírací seznam obsahuje v UPDATE, INSERT a odstranit záložky (žádný) ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span></span>


<span data-ttu-id="a842a-164">Po dokončení Průvodce nakonfigurovat zdroj dat, sada Visual Studio přidá vlastnost BoundField pro `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, a `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="a842a-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="a842a-165">Upravte prvku GridView, tak, aby obsahoval pouze `CategoryName` a `Description` BoundFields a aktualizovat `CategoryName` Vlastnost BoundField s `HeaderText` vlastnosti do kategorií.</span><span class="sxs-lookup"><span data-stu-id="a842a-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="a842a-166">V dalším kroku přidejte HyperLinkField a umístěte ho tak, že s pole nejvíce vlevo.</span><span class="sxs-lookup"><span data-stu-id="a842a-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="a842a-167">Nastavte `DataNavigateUrlFields` vlastnost `CategoryID` a `DataNavigateUrlFormatString` vlastnost `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="a842a-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="a842a-168">Nastavte `Text` vlastnost zobrazit produkty.</span><span class="sxs-lookup"><span data-stu-id="a842a-168">Set the `Text` property to View Products .</span></span>


![Přidat HyperLinkField do kategorií GridView](building-a-custom-database-driven-site-map-provider-vb/_static/image6.gif)

<span data-ttu-id="a842a-170">**Obrázek 6**: Přidat HyperLinkField k `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="a842a-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="a842a-171">Po vytvoření ObjectDataSource a přizpůsobení polí s ovládacího prvku GridView, dva ovládací prvky deklarativní bude vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="a842a-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample2.aspx)]

<span data-ttu-id="a842a-172">Obrázek 7 znázorňuje `Default.aspx` při prohlížení prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a842a-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="a842a-173">Kliknutím na kategorii s zobrazit produkty odkaz vás nasměruje na `ProductsByCategory.aspx?CategoryID=categoryID`, který vytvoříme v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="a842a-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="a842a-174">[![Každá kategorie je uvedený spolu s odkazem produkty zobrazení](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span></span>

<span data-ttu-id="a842a-175">**Obrázek 7**: Každá kategorie je uvedený spolu s odkazem Zobrazit produkty ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="a842a-176">Krok 3: Seznam produktů s vybranou kategorii.</span><span class="sxs-lookup"><span data-stu-id="a842a-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="a842a-177">Otevřít `ProductsByCategory.aspx` stránce a přidejte prvku GridView, jeho pojmenování `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="a842a-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="a842a-178">Z inteligentních značek, svázání prvku GridView nového prvku ObjectDataSource s názvem `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a842a-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="a842a-179">Konfigurace ObjectDataSource používat `ProductsBLL` třída s `GetProductsByCategoryID(categoryID)` metoda a nastavte rozevíracího seznamu jsou uvedeny na (žádný) na kartách UPDATE, INSERT a DELETE.</span><span class="sxs-lookup"><span data-stu-id="a842a-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="a842a-180">[![Pomocí této metody s GetProductsByCategoryID(categoryID) ProductsBLL třídy](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span></span>

<span data-ttu-id="a842a-181">**Obrázek 8**: použijte `ProductsBLL` třída s `GetProductsByCategoryID(categoryID)` – metoda ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span></span>


<span data-ttu-id="a842a-182">V posledním kroku v průvodci Konfigurace zdroje dat zobrazí výzvu k zadání parametrů zdroj pro *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="a842a-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="a842a-183">Protože tyto informace se předává pole řetězce dotazu `CategoryID`vyberte řetězce dotazu z rozevíracího seznamu a zadejte ID kategorie v textovém poli vlastnost QueryStringField, jak je znázorněno na obrázku 9.</span><span class="sxs-lookup"><span data-stu-id="a842a-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="a842a-184">Kliknutím na Dokončit dokončíte průvodce.</span><span class="sxs-lookup"><span data-stu-id="a842a-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="a842a-185">[![Použijte pole řetězce dotazu ID kategorie pro ID kategorie parametr](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span></span>

<span data-ttu-id="a842a-186">**Obrázek 9**: použití `CategoryID` pro pole řetězce dotazu *categoryID* parametr ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span></span>


<span data-ttu-id="a842a-187">Po dokončení průvodce, Visual Studio přidá odpovídající BoundFields a třídě CheckBoxField do prvku GridView pro datová pole produktu.</span><span class="sxs-lookup"><span data-stu-id="a842a-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="a842a-188">Odeberte všechny kromě na `ProductName`, `UnitPrice`, a `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="a842a-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="a842a-189">Přizpůsobit tyto tři BoundFields `HeaderText` vlastností ke čtení produktu, ceny a dodavatele, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="a842a-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="a842a-190">Formát `UnitPrice` Vlastnost BoundField jako měnu.</span><span class="sxs-lookup"><span data-stu-id="a842a-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="a842a-191">V dalším kroku přidejte HyperLinkField a přesunout na pozici nejvíce vlevo.</span><span class="sxs-lookup"><span data-stu-id="a842a-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="a842a-192">Nastavte jeho `Text` vlastnosti chcete zobrazit podrobnosti, jeho `DataNavigateUrlFields` vlastnost `ProductID`a jeho `DataNavigateUrlFormatString` vlastnost `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="a842a-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![Přidat podrobnosti HyperLinkField zobrazení, který odkazuje na ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image10.gif)

<span data-ttu-id="a842a-194">**Obrázek 10**: Přidání, zobrazení podrobností HyperLinkField, který odkazuje na `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="a842a-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="a842a-195">Po provedení tyto úpravy, ovládacími prvky GridView a prvku ObjectDataSource s deklarativní by měl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="a842a-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample3.aspx)]

<span data-ttu-id="a842a-196">Vraťte se do zobrazení `Default.aspx` prostřednictvím prohlížeče a klikněte na Zobrazit produkty odkaz nápoje.</span><span class="sxs-lookup"><span data-stu-id="a842a-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="a842a-197">Tím přejdete na `ProductsByCategory.aspx?CategoryID=1`, zobrazení názvy, ceny a dodavatelů, produkty, které patří do kategorie Nápoje databáze Northwind (viz obrázek 11).</span><span class="sxs-lookup"><span data-stu-id="a842a-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="a842a-198">Nebojte se dál vylepšit tuto stránku a obsahovat odkaz pro návrat na stránku výpis kategorie uživatelů (`Default.aspx`) a ovládacího prvku DetailsView nebo FormView zobrazující vybranou kategorii s název a popis.</span><span class="sxs-lookup"><span data-stu-id="a842a-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="a842a-199">[![Jsou zobrazeny názvy nápoje, ceny a dodavatelů](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span></span>

<span data-ttu-id="a842a-200">**Obrázek 11**: zobrazené názvy nápoje, ceny a dodavatelů ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="a842a-201">Krok 4: S podrobnostmi produktu s</span><span class="sxs-lookup"><span data-stu-id="a842a-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="a842a-202">Na poslední stránce `ProductDetails.aspx`, se zobrazí podrobnosti vybrané produkty.</span><span class="sxs-lookup"><span data-stu-id="a842a-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="a842a-203">Otevřít `ProductDetails.aspx` a DetailsView přetáhněte z panelu nástrojů do návrháře.</span><span class="sxs-lookup"><span data-stu-id="a842a-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="a842a-204">Nastavit prvek DetailsView s `ID` vlastnost `ProductInfo` a vymažte její `Height` a `Width` hodnot vlastností.</span><span class="sxs-lookup"><span data-stu-id="a842a-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="a842a-205">Z inteligentních značek, svázat s ovládacím prvku DetailsView nového prvku ObjectDataSource s názvem `ProductDataSource`, konfigurace ObjectDataSource přebírat jeho data ze `ProductsBLL` třída s `GetProductByProductID(productID)` metody.</span><span class="sxs-lookup"><span data-stu-id="a842a-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="a842a-206">Stejně jako u předchozí webových stránek vytvořených v krocích 2 a 3, nastavte rozevírací seznamy v UPDATE, INSERT a odstranit karty na (žádný).</span><span class="sxs-lookup"><span data-stu-id="a842a-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="a842a-207">[![Konfigurace ObjectDataSource GetProductByProductID(productID) metody](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span></span>

<span data-ttu-id="a842a-208">**Obrázek 12**: Konfigurace ObjectDataSource k použití `GetProductByProductID(productID)` – metoda ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span></span>


<span data-ttu-id="a842a-209">Poslední krok v průvodci Konfigurace zdroje dat zobrazí výzvu k zadání zdroj *productID* parametru.</span><span class="sxs-lookup"><span data-stu-id="a842a-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="a842a-210">Protože tato data prochází pole řetězce dotazu `ProductID`, nastavte rozevírací seznam na řetězce dotazu a vlastnost QueryStringField textového pole na ProductID.</span><span class="sxs-lookup"><span data-stu-id="a842a-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="a842a-211">Nakonec kliknutím na tlačítko Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="a842a-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="a842a-212">[![Konfigurace productID parametr načítat jeho hodnotu z pole řetězce dotazu ProductID](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span></span>

<span data-ttu-id="a842a-213">**Obrázek 13**: konfigurace *productID* o přijetí změn svou hodnotu z parametru `ProductID` pole řetězce dotazu ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span></span>


<span data-ttu-id="a842a-214">Po dokončení Průvodce nakonfigurovat zdroj dat, vytvoří Visual Studio odpovídající BoundFields a třídě CheckBoxField v ovládacím prvku DetailsView pro datová pole produktu.</span><span class="sxs-lookup"><span data-stu-id="a842a-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="a842a-215">Odeberte `ProductID`, `SupplierID`, a `CategoryID` BoundFields a nakonfigurujte zbývající pole podle svých potřeb.</span><span class="sxs-lookup"><span data-stu-id="a842a-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="a842a-216">Po několika aesthetic konfigurace my DetailsView a prvku ObjectDataSource s deklarativní vypadal následující:</span><span class="sxs-lookup"><span data-stu-id="a842a-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample4.aspx)]

<span data-ttu-id="a842a-217">Chcete-li otestovat tuto stránku, vraťte se na `Default.aspx` a klikněte na Zobrazit produkty pro kategorie Nápoje.</span><span class="sxs-lookup"><span data-stu-id="a842a-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="a842a-218">V seznamu nápoje produktů, klikněte na odkaz zobrazit podrobnosti pro Chai čaje.</span><span class="sxs-lookup"><span data-stu-id="a842a-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="a842a-219">Tím přejdete na `ProductDetails.aspx?ProductID=1`, zobrazí s Chai čaje podrobnosti (viz obrázek 14).</span><span class="sxs-lookup"><span data-stu-id="a842a-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="a842a-220">[![Zobrazí se Chai čaje s dodavatel, kategorie, ceny a dalších informací](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span></span>

<span data-ttu-id="a842a-221">**Obrázek 14**: Chai čaje s dodavatel, kategorie, ceny a další informace se zobrazí ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="a842a-222">Krok 5: Principy vnitřní fungování zprostředkovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="a842a-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="a842a-223">Mapa webu reprezentované v paměti webového serveru s jako kolekci `SiteMapNode` instancí, které tvoří hierarchii.</span><span class="sxs-lookup"><span data-stu-id="a842a-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="a842a-224">Musí být přesně jeden kořenový, všechny uzly nekořenovými musí obsahovat přesně jeden nadřazený uzel a všechny uzly mohou mít libovolný počet podřízené položky.</span><span class="sxs-lookup"><span data-stu-id="a842a-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="a842a-225">Každý `SiteMapNode` objekt představuje oddíl ve struktuře webu s; tyto části běžně mít odpovídající webové stránky.</span><span class="sxs-lookup"><span data-stu-id="a842a-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="a842a-226">V důsledku toho [ `SiteMapNode` třídy](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) má vlastnosti, jako je `Title`, `Url`, a `Description`, které poskytují informace o části `SiteMapNode` představuje.</span><span class="sxs-lookup"><span data-stu-id="a842a-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="a842a-227">K dispozici je také `Key` vlastnost, která jednoznačně identifikuje každý `SiteMapNode` v hierarchii, jakož i vlastnosti, které používá k navázání této hierarchie `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`a tak dále.</span><span class="sxs-lookup"><span data-stu-id="a842a-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="a842a-228">Obrázek 15 znázorňuje strukturu obecný web mapování z obrázku 1, ale s šrafují podrobně jemnější podrobnosti implementace.</span><span class="sxs-lookup"><span data-stu-id="a842a-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="a842a-229">[![Každý SiteMapNode má vlastnosti jako název, adresu Url, klíč a tak dále](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="a842a-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span></span>

<span data-ttu-id="a842a-230">**Obrázek 15**: každý `SiteMapNode` má vlastnosti jako `Title`, `Url`, `Key`, a tak dále ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="a842a-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span></span>


<span data-ttu-id="a842a-231">Mapa webu je přístupný prostřednictvím [ `SiteMap` třídy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) v [ `System.Web` obor názvů](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="a842a-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="a842a-232">Tato třída s `RootNode` vlastnost vrací mapy s kořenového webu `SiteMapNode` instance; `CurrentNode` vrátí `SiteMapNode` jehož `Url` vlastnost odpovídá adrese URL aktuálně požadovanou stránku.</span><span class="sxs-lookup"><span data-stu-id="a842a-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="a842a-233">Tato třída se používá interně ve webové ovládací prvky pro navigaci s ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="a842a-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="a842a-234">Když `SiteMap` vlastnosti třídy s přistupuje, se musí serializovat strukturu mapy webu z některých trvalou média do paměti.</span><span class="sxs-lookup"><span data-stu-id="a842a-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="a842a-235">Ale logiky serializace mapy webu není pevný zakódovaný do `SiteMap` třídy.</span><span class="sxs-lookup"><span data-stu-id="a842a-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="a842a-236">Místo toho v době běhu `SiteMap` určuje třídy, které mapy webu *poskytovatele* pro serializaci.</span><span class="sxs-lookup"><span data-stu-id="a842a-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="a842a-237">Ve výchozím nastavení [ `XmlSiteMapProvider` třída](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) se používá, která čte mapu s struktury webu ze souboru XML správně naformátovaná.</span><span class="sxs-lookup"><span data-stu-id="a842a-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="a842a-238">Však stačí nepatrné práce, můžeme vytvořit vlastní vlastního zprostředkovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="a842a-239">Všichni poskytovatelé map webu musí být odvozen od [ `SiteMapProvider` třída](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), což zahrnuje základní metody a vlastnosti potřebné pro server mapování poskytovatele, ale vynechá řadu podrobnosti implementace.</span><span class="sxs-lookup"><span data-stu-id="a842a-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="a842a-240">Druhá třída [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), rozšiřuje `SiteMapProvider` třída a obsahuje více robustní provádění požadovaných funkcí.</span><span class="sxs-lookup"><span data-stu-id="a842a-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="a842a-241">Interně `StaticSiteMapProvider` ukládá `SiteMapNode` instance serveru namapovat ve `Hashtable` a poskytuje metody, jako jsou `AddNode(child, parent)`, `RemoveNode(siteMapNode),` a `Clear()` , přidávat a odebírat `SiteMapNode` s vnitřní `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="a842a-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="a842a-242">`XmlSiteMapProvider` je odvozen z `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="a842a-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="a842a-243">Při vytváření vlastního zprostředkovatele mapy webu, který rozšiřuje `StaticSiteMapProvider`, existují dvě abstraktní metody, které se musí přepsat: [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) a [ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="a842a-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="a842a-244">`BuildSiteMap`, jak již název napovídá, zodpovídá za načítání strukturu mapy webu z trvalého úložiště a vytvářet v paměti.</span><span class="sxs-lookup"><span data-stu-id="a842a-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="a842a-245">`GetRootNodeCore` Vrátí kořenový uzel mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="a842a-246">Před webové aplikace můžete použít zprostředkovatele mapy webu, který musí být zaregistrovaný v konfiguraci aplikace s.</span><span class="sxs-lookup"><span data-stu-id="a842a-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="a842a-247">Ve výchozím nastavení `XmlSiteMapProvider` třída je registrována pomocí názvu `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="a842a-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="a842a-248">Registrace zprostředkovatele mapy další lokality, přidejte následující kód k `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="a842a-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample5.xml)]

<span data-ttu-id="a842a-249">*Název* hodnotu přiřadí popisný název zprostředkovatele při *typ* Určuje typ plně kvalifikovaný název zprostředkovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="a842a-250">Ukážeme si některé konkrétní hodnoty *název* a *typ* hodnoty v kroku 7, po jsme vytvořili ve naše vlastního zprostředkovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="a842a-251">Třída zprostředkovatele mapy webu je vytvořena instance při prvním je přistupovat z `SiteMap` třídy a zůstanou v paměti dobu životnosti webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="a842a-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="a842a-252">Vzhledem k tomu, že existuje pouze jedna instance zprostředkovatele mapy webu, které mohou být vyvolány z více, návštěvníkům webu souběžných, je nutné, aby se metody zprostředkovatele s *bezpečné pro vlákna*.</span><span class="sxs-lookup"><span data-stu-id="a842a-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="a842a-253">Pro výkon a škálovatelnost je důležité, že jsme mezipaměti webu v paměti s zmapování struktury a vraťte to do mezipaměti, struktura, místo opětovného vytvoření pokaždé, když `BuildSiteMap` vyvolání metody.</span><span class="sxs-lookup"><span data-stu-id="a842a-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="a842a-254">`BuildSiteMap` může být volána několikrát za požadavek na stránku na uživatele, v závislosti na navigační ovládací prvky používané na stránce a hloubka strukturu mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="a842a-255">V případě, pokud jsme Neukládat do mezipaměti struktury mapy webu v `BuildSiteMap` pokaždé, když je vyvolána jsme nutné znovu načíst informace o produktu a kategorie z architektury (což by vytvořilo dotaz do databáze).</span><span class="sxs-lookup"><span data-stu-id="a842a-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="a842a-256">Jak jsme probírali v předchozích kurzech ukládání do mezipaměti, můžete data uložená v mezipaměti stala zastaralými.</span><span class="sxs-lookup"><span data-stu-id="a842a-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="a842a-257">Z toho důvodu, můžeme použít buď čas - nebo expiries založené na závislost mezipaměti SQL.</span><span class="sxs-lookup"><span data-stu-id="a842a-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="a842a-258">Volitelně může přepsat zprostředkovatele mapy webu [ `Initialize` metoda](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="a842a-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="a842a-259">`Initialize` je voláno, když při prvním vytvoření instance zprostředkovatele mapy webu a je předán všemi vlastními atributy přiřazené k poskytovateli v `Web.config` v `<add>` prvky jako: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="a842a-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="a842a-260">To je užitečné, pokud chcete povolit vývojářům určit různé lokality mapy týkající se poskytovatele nastavení bez nutnosti upravovat kód s zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="a842a-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="a842a-261">Pokud jsme byly čtení dat kategorie a produktů pravděpodobně přímo z databáze nikoli prostřednictvím architektury, jsme d třeba chcete, aby vývojář stránky zadejte připojovací řetězec databáze prostřednictvím `Web.config` místo použití pevně zakódované Hodnota v kódu s zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="a842a-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="a842a-262">Vlastního zprostředkovatele mapy webu vytvoříme v kroku 6 nepřepisuje to `Initialize` metody.</span><span class="sxs-lookup"><span data-stu-id="a842a-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="a842a-263">Příklad použití `Initialize` metodu, najdete [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [ukládání mapy webu v systému SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) článku.</span><span class="sxs-lookup"><span data-stu-id="a842a-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="a842a-264">Krok 6: Vytvoření vlastního zprostředkovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="a842a-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="a842a-265">Chcete-li vytvořit vlastního zprostředkovatele mapy webu, který vytváří Mapa webu z kategorie a produkty v databázi Northwind, musíme vytvořit třídu, která rozšiřuje `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="a842a-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="a842a-266">V kroku 1 se zobrazuje výzva k přidání `CustomProviders` složky `App_Code` složka – přidejte novou třídu do této složky s názvem `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="a842a-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="a842a-267">Přidejte následující kód, který `NorthwindSiteMapProvider` třídy:</span><span class="sxs-lookup"><span data-stu-id="a842a-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample6.vb)]

<span data-ttu-id="a842a-268">Umožní s začínat zkoumání této třídy s `BuildSiteMap` metodu, která začíná [ `lock` příkaz](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="a842a-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="a842a-269">`lock` Příkaz povoluje jenom jedno vlákno najednou zadat, a tím serializace přístup k jeho kódu a zabraňuje krokování na prstech s sebou dvou souběžných vláken.</span><span class="sxs-lookup"><span data-stu-id="a842a-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="a842a-270">Úrovni třídy `SiteMapNode` proměnnou `root` se používá k ukládání do mezipaměti strukturu mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="a842a-271">Když poprvé nebo poprvé po podkladová data byla změněna, mapy webu `root` bude `Nothing` a částka se vypočte strukturu mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `Nothing` and the site map structure will be constructed.</span></span> <span data-ttu-id="a842a-272">Kořenový uzel mapy s lokalitě přiřazen `root` během procesu vytváření se nazývá procesu tak, aby příště tuto metodu, `root` nebudou `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="a842a-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `Nothing`.</span></span> <span data-ttu-id="a842a-273">V důsledku toho tak dlouho, dokud `root` není `Nothing` strukturu mapy webu bude vrácen volajícímu bez nutnosti znovu ho vytvořte.</span><span class="sxs-lookup"><span data-stu-id="a842a-273">Consequently, so long as `root` is not `Nothing` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="a842a-274">Pokud je kořenový `Nothing`, strukturu mapy webu je vytvořený z informací o produktu a kategorie.</span><span class="sxs-lookup"><span data-stu-id="a842a-274">If root is `Nothing`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="a842a-275">Mapa webu je sestaven tak, že vytvoříte `SiteMapNode` instancí a pak tvoří hierarchii pomocí volání `StaticSiteMapProvider` třída s `AddNode` metoda.</span><span class="sxs-lookup"><span data-stu-id="a842a-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="a842a-276">`AddNode` provádí se účetnictví ukládání různé `SiteMapNode` instance `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="a842a-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="a842a-277">Než začneme, vytváření hierarchie, začneme voláním `Clear` metodu, která vymaže prvky z vnitřní `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="a842a-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="a842a-278">Dále `ProductsBLL` třída s `GetProducts` metoda a výsledné `ProductsDataTable` jsou uloženy v místní proměnné.</span><span class="sxs-lookup"><span data-stu-id="a842a-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="a842a-279">Konstrukce mapy s lokality začne vytvořením kořenový uzel a ji přiřadíte `root`.</span><span class="sxs-lookup"><span data-stu-id="a842a-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="a842a-280">Přetížení [ `SiteMapNode` konstruktor s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) používá zde a v rámci tohoto `BuildSiteMap` se předá tyto informace:</span><span class="sxs-lookup"><span data-stu-id="a842a-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="a842a-281">Odkaz na zprostředkovatele mapy webu (`Me`).</span><span class="sxs-lookup"><span data-stu-id="a842a-281">A reference to the site map provider (`Me`).</span></span>
- <span data-ttu-id="a842a-282">`SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="a842a-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="a842a-283">Tato oprávnění vyžadují hodnota musí být jedinečná pro každou `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="a842a-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="a842a-284">`SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="a842a-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="a842a-285">`Url` je volitelný, ale pokud je zadán, každý `SiteMapNode` s `Url` hodnota musí být jedinečný.</span><span class="sxs-lookup"><span data-stu-id="a842a-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="a842a-286">`SiteMapNode` s `Title`, což je povinné.</span><span class="sxs-lookup"><span data-stu-id="a842a-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="a842a-287">`AddNode(root)` Přidá volání metody `SiteMapNode` `root` do mapy webu jako kořen.</span><span class="sxs-lookup"><span data-stu-id="a842a-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="a842a-288">Dále, každý `ProductRow` v `ProductsDataTable` výčtu.</span><span class="sxs-lookup"><span data-stu-id="a842a-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="a842a-289">Pokud už existuje `SiteMapNode` pro aktuální kategorii produktu s se odkazuje.</span><span class="sxs-lookup"><span data-stu-id="a842a-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="a842a-290">V opačném případě nový `SiteMapNode` pro kategorii je vytvořen a přidán jako podřízený objekt `SiteMapNode``root` prostřednictvím `AddNode(categoryNode, root)` volání metody.</span><span class="sxs-lookup"><span data-stu-id="a842a-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="a842a-291">Po odpovídající kategorii `SiteMapNode` uzlu byl nalezen nebo vytvořen, `SiteMapNode` je vytvořen pro aktuální produkt a přidán jako podřízený objekt kategorie `SiteMapNode` prostřednictvím `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="a842a-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="a842a-292">Všimněte si, že kategorie `SiteMapNode` s `Url` hodnota vlastnosti je `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while produktu `SiteMapNode` s `Url` je vlastnosti přiřazen `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="a842a-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="a842a-293">Tyto produkty, které mají databáze `NULL` hodnotu pro jejich `CategoryID` jsou seskupené podle kategorie `SiteMapNode` jehož `Title` nastavenou na None a jehož `Url` je nastavena na prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="a842a-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="a842a-294">Jsem se rozhodla nastavit `Url` na prázdný řetězec, protože `ProductBLL` třída s `GetProductsByCategory(categoryID)` schopnost vrátit pouze tyto produkty se v tuto chvíli nemá metodu `NULL` `CategoryID` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a842a-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="a842a-295">Navíc já bych chtěl předvést způsob vykreslení ovládací prvky navigace `SiteMapNode` , který nemá hodnotu pro jeho `Url` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a842a-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="a842a-296">Neváhejte se v tomto kurzu rozšířit tak, aby žádný `SiteMapNode` s `Url` vlastnost odkazuje na `ProductsByCategory.aspx`, ještě zobrazí jenom produkty s `NULL` `CategoryID` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="a842a-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="a842a-297">Po vytváření mapy webu, je libovolný objekt přidán do mezipaměti dat na závislost mezipaměti SQL `Categories` a `Products` tabulky prostřednictvím `AggregateCacheDependency` objektu.</span><span class="sxs-lookup"><span data-stu-id="a842a-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="a842a-298">Prozkoumali jsme použití závislostí mezipaměti SQL v předchozím kurzu *použití závislostí mezipaměti SQL*.</span><span class="sxs-lookup"><span data-stu-id="a842a-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="a842a-299">Vlastního zprostředkovatele mapy webu, ale používá přetížení mezipaměť dat s `Insert` metody, který jsme ve ještě chcete prozkoumat.</span><span class="sxs-lookup"><span data-stu-id="a842a-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="a842a-300">Toto přetížení jako jeho poslední vstupní parametr přijímá delegát, který se volá, když se odebere objekt z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="a842a-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="a842a-301">Konkrétně jsme předat v novém [ `CacheItemRemovedCallback` delegovat](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) , která odkazuje na `OnSiteMapChanged` definována metoda další dolů v `NorthwindSiteMapProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="a842a-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="a842a-302">Reprezentace v paměti mapy webu se uloží do mezipaměti prostřednictvím proměnné úrovni třídy `root`.</span><span class="sxs-lookup"><span data-stu-id="a842a-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="a842a-303">Vzhledem k tomu, že existuje pouze jedna instance třídy zprostředkovatele mapy vlastní stránky a od této instance je sdílena mezi všemi vlákny ve webové aplikaci, tato proměnná třídy slouží jako mezipaměť.</span><span class="sxs-lookup"><span data-stu-id="a842a-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="a842a-304">`BuildSiteMap` Metoda také používá mezipaměť dat, ale pouze jako prostředky, na které přijde upozornění, když data v podkladové databázi `Categories` nebo `Products` tabulky změn.</span><span class="sxs-lookup"><span data-stu-id="a842a-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="a842a-305">Mějte na paměti, že hodnota do datové mezipaměti je jenom aktuálním datem a časem.</span><span class="sxs-lookup"><span data-stu-id="a842a-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="a842a-306">Je aktuální data mapy *není* umístit do datové mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="a842a-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="a842a-307">`BuildSiteMap` Dokončení metody tak, že vrací kořenový uzel mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="a842a-308">Ostatní metody jsou poměrně jednoduché.</span><span class="sxs-lookup"><span data-stu-id="a842a-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="a842a-309">`GetRootNodeCore` je zodpovědná za navrácení kořenového uzlu.</span><span class="sxs-lookup"><span data-stu-id="a842a-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="a842a-310">Protože `BuildSiteMap` vrátí kořen, `GetRootNodeCore` jednoduše vrací `BuildSiteMap` s návratovou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a842a-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="a842a-311">`OnSiteMapChanged` Metody nastaví `root` zpět `Nothing` při odebrání položky mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="a842a-311">The `OnSiteMapChanged` method sets `root` back to `Nothing` when the cache item is removed.</span></span> <span data-ttu-id="a842a-312">Se nastaví zpátky kořenem `Nothing`, při příštím `BuildSiteMap` je vyvolána, strukturu mapy webu bude znovu vytvořen.</span><span class="sxs-lookup"><span data-stu-id="a842a-312">With root set back to `Nothing`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="a842a-313">A konečně `CachedDate` vlastnost vrací hodnoty data a času, které jsou uložené v mezipaměti dat, pokud taková hodnota neexistuje.</span><span class="sxs-lookup"><span data-stu-id="a842a-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="a842a-314">Tato vlastnost slouží vývojář stránky k určení, kdy byl naposledy do mezipaměti data mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="a842a-315">Krok 7: Registrace`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="a842a-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="a842a-316">V pořadí pro naši webovou aplikaci používat `NorthwindSiteMapProvider` zprostředkovatele mapy webu vytvořené v kroku 6, musíme ho zaregistrovat `<siteMap>` část `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="a842a-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="a842a-317">Konkrétně, přidejte následující kód v rámci `<system.web>` prvek `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="a842a-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample7.xml)]

<span data-ttu-id="a842a-318">Tento kód provede dvě věci: nejprve znamená, že integrované `AspNetXmlSiteMapProvider` je zprostředkovatele mapy webu výchozí; za druhé, zaregistruje vlastního zprostředkovatele mapy webu vytvořené v kroku 6 s lidských – popisný název Northwind.</span><span class="sxs-lookup"><span data-stu-id="a842a-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="a842a-319">Pro zprostředkovatele mapy webu v aplikaci s `App_Code` složky, hodnota `type` atribut je jednoduše název třídy.</span><span class="sxs-lookup"><span data-stu-id="a842a-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="a842a-320">Můžete také vlastního zprostředkovatele mapy webu by byla vytvořena v samostatném projektu knihovny tříd zkompilovaného sestavení umístí do webové aplikace s `/Bin` adresáře.</span><span class="sxs-lookup"><span data-stu-id="a842a-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="a842a-321">V takovém případě `type` by byla hodnota atributu *Namespace*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="a842a-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="a842a-322">Po aktualizaci `Web.config`, věnujte chvíli zobrazení všech stránek z kurzů v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="a842a-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="a842a-323">Mějte na paměti, že rozhraní navigace na levé straně stále zobrazuje v částech a kurzy definované v `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="a842a-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="a842a-324">Důvodem je, že ponechali jsme `AspNetXmlSiteMapProvider` jako výchozího zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="a842a-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="a842a-325">Chcete-li vytvořit prvek navigace uživatelského rozhraní, který používá `NorthwindSiteMapProvider`, budeme muset explicitně zadat, že má být použita zprostředkovatele mapy webu Northwind.</span><span class="sxs-lookup"><span data-stu-id="a842a-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="a842a-326">Uvidíme, jak to provést v kroku 8.</span><span class="sxs-lookup"><span data-stu-id="a842a-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="a842a-327">Krok 8: Zobrazení informací o lokalitě mapy pomocí vlastního zprostředkovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="a842a-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="a842a-328">Vlastní web zprostředkovatele mapy vytvořené a registrované v `Web.config`, můžeme znovu připravení přidat ovládací prvky pro navigaci na `Default.aspx`, `ProductsByCategory.aspx`, a `ProductDetails.aspx` stránky v `SiteMapProvider` složky.</span><span class="sxs-lookup"><span data-stu-id="a842a-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="a842a-329">Začněte otevřením `Default.aspx` stránku a přetáhněte ji `SiteMapPath` z panelu nástrojů do návrháře.</span><span class="sxs-lookup"><span data-stu-id="a842a-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="a842a-330">Ovládací prvky SiteMapPath ovládací prvek se nachází v části navigace na panelu nástrojů.</span><span class="sxs-lookup"><span data-stu-id="a842a-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="a842a-331">[![Přidat ovládací prvky SiteMapPath Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="a842a-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span></span>

<span data-ttu-id="a842a-332">**Obrázek 16**: Přidat SiteMapPath k `Default.aspx` ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="a842a-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span></span>


<span data-ttu-id="a842a-333">Ovládací prvky SiteMapPath ovládací prvek zobrazuje navigace s popisem cesty, určující umístění s aktuální stránky v rámci mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="a842a-334">Přidali jsme do horní části stránky předlohy ovládací prvky SiteMapPath zpátky *stránky předlohy a navigace na webu* kurzu.</span><span class="sxs-lookup"><span data-stu-id="a842a-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="a842a-335">Za chvíli zobrazení této stránky prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a842a-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="a842a-336">Ovládací prvky SiteMapPath přidá obrázek 16 používá zprostředkovatele mapy webu výchozí načítání jeho dat ze `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="a842a-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="a842a-337">Proto tento navigační prvek určuje ukazuje Domů &gt; přizpůsobení mapy webu, stejně jako s popisem cesty v pravém horním rohu.</span><span class="sxs-lookup"><span data-stu-id="a842a-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="a842a-338">[![Tento navigační prvek určuje používá výchozí zprostředkovatele mapy webu](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="a842a-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span></span>

<span data-ttu-id="a842a-339">**Obrázek 17**: Tento navigační prvek určuje používá výchozí zprostředkovatele mapy webu ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="a842a-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span></span>


<span data-ttu-id="a842a-340">Pokud chcete, aby SiteMapPath přidá obrázek 16 použijte zprostředkovatele mapy vlastního webu, který jsme vytvořili v kroku 6, nastavte jeho [ `SiteMapProvider` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) Northwind, název jsme přiřazena k `NorthwindSiteMapProvider` v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="a842a-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="a842a-341">Bohužel návrháře i nadále používat výchozí zprostředkovatele mapy webu, ale pokud najdete na stránce prostřednictvím prohlížeče po provedení této změny vlastnosti uvidíte, že tento navigační prvek určuje teď používá vlastního zprostředkovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="a842a-342">[![Tento navigační prvek určuje teď používá NorthwindSiteMapProvider zprostředkovatele mapy vlastní web](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="a842a-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span></span>

<span data-ttu-id="a842a-343">**Obrázek 18**: Tento navigační prvek určuje teď používá vlastní zprostředkovatele mapy webu `NorthwindSiteMapProvider` ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="a842a-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span></span>


<span data-ttu-id="a842a-344">Ovládací prvky SiteMapPath ovládací prvek zobrazuje více funkcí uživatelského rozhraní v `ProductsByCategory.aspx` a `ProductDetails.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a842a-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="a842a-345">Přidání ovládací prvky SiteMapPath na tyto stránky nastavení `SiteMapProvider` vlastnost v obou, a Northwind.</span><span class="sxs-lookup"><span data-stu-id="a842a-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="a842a-346">Z `Default.aspx` klikněte na odkaz zobrazit produkty nápoje a potom na odkaz zobrazit podrobnosti pro Chai čaje.</span><span class="sxs-lookup"><span data-stu-id="a842a-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="a842a-347">Jak ukazuje obrázek 19, zahrnuje tento navigační prvek určuje aktuální části mapy webu (Chai čaje) a jeho nadřazenými prvky: nápoje a všechny kategorie.</span><span class="sxs-lookup"><span data-stu-id="a842a-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="a842a-348">[![Tento navigační prvek určuje teď používá NorthwindSiteMapProvider zprostředkovatele mapy vlastní web](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a842a-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span></span>

<span data-ttu-id="a842a-349">**Obrázek 19**: Tento navigační prvek určuje teď používá vlastní zprostředkovatele mapy webu `NorthwindSiteMapProvider` ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a842a-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span></span>


<span data-ttu-id="a842a-350">Další prvky uživatelského rozhraní navigace je možné kromě SiteMapPath, jako je například ovládací prvky nabídky a prvku TreeView.</span><span class="sxs-lookup"><span data-stu-id="a842a-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="a842a-351">`Default.aspx`, `ProductsByCategory.aspx`, A `ProductDetails.aspx` stránky soubor ke stažení pro účely tohoto kurzu, například všechny obsahují ovládací prvky nabídky (viz obrázek 20).</span><span class="sxs-lookup"><span data-stu-id="a842a-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="a842a-352">Naleznete v tématu [zkoumání ASP.NET 2.0 s funkcemi navigace na webu](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) a [ovládací prvky navigace pomocí lokality](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) část [ASP.NET 2.0 šablon rychlý Start](https://quickstarts.asp.net/QuickStartv20/aspnet/) podrobnější rozbor ovládací prvky pro navigaci a systému lokality mapy v technologii ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="a842a-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="a842a-353">[![Menu – ovládací prvek obsahuje seznam všech kategorií a produkty](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="a842a-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span></span>

<span data-ttu-id="a842a-354">**Obrázek 20**: nabídky ovládací prvek obsahuje seznam každý kategorií a produktů ([kliknutím ji zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="a842a-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span></span>


<span data-ttu-id="a842a-355">Jak už bylo zmíněno dříve v tomto kurzu, strukturu mapy webu je přístupná prostřednictvím kódu programu přes `SiteMap` třídy.</span><span class="sxs-lookup"><span data-stu-id="a842a-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="a842a-356">Následující kód vrátí kořen `SiteMapNode` výchozího zprostředkovatele:</span><span class="sxs-lookup"><span data-stu-id="a842a-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample8.vb)]

<span data-ttu-id="a842a-357">Vzhledem k tomu, `AspNetXmlSiteMapProvider` je výchozím zprostředkovatelem pro naši aplikaci výše uvedený kód vracel kořenový uzel definovaný ve `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="a842a-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="a842a-358">Chcete-li odkazovat na zprostředkovatele mapy webu jiné než výchozí, použijte `SiteMap` třída s [ `Providers` vlastnost](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) takto:</span><span class="sxs-lookup"><span data-stu-id="a842a-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample9.vb)]

<span data-ttu-id="a842a-359">Kde *název* je název zprostředkovatele mapy webu vlastní (pro naši webovou aplikaci Northwind).</span><span class="sxs-lookup"><span data-stu-id="a842a-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="a842a-360">Chcete-li přístup ke členu specifické pro zprostředkovatele mapy webu, použijte `SiteMap.Providers["name"]` načtení instance zprostředkovatele a pak ji přetypujte na typ odpovídající.</span><span class="sxs-lookup"><span data-stu-id="a842a-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="a842a-361">Například, chcete-li zobrazit `NorthwindSiteMapProvider` s `CachedDate` vlastnosti stránky technologie ASP.NET, použijte následující kód:</span><span class="sxs-lookup"><span data-stu-id="a842a-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample10.vb)]

> [!NOTE]
> <span data-ttu-id="a842a-362">Ujistěte se, k otestování funkce závislosti mezipaměti SQL.</span><span class="sxs-lookup"><span data-stu-id="a842a-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="a842a-363">Po najdete `Default.aspx`, `ProductsByCategory.aspx`, a `ProductDetails.aspx` stránky, přejděte do jednoho z kurzů v úpravy, vložení a odstranění oddílu a upravit název, kategorie nebo produktu.</span><span class="sxs-lookup"><span data-stu-id="a842a-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="a842a-364">Pak se vraťte do jedné stránky `SiteMapProvider` složky.</span><span class="sxs-lookup"><span data-stu-id="a842a-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="a842a-365">Za předpokladu, že uplynul dostatek času pro dotazovací mechanismus poznamenat změn do databáze, by měl být Mapa webu aktualizuje a zobrazí nový produkt nebo název kategorie.</span><span class="sxs-lookup"><span data-stu-id="a842a-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="a842a-366">Souhrn</span><span class="sxs-lookup"><span data-stu-id="a842a-366">Summary</span></span>

<span data-ttu-id="a842a-367">ASP.NET 2.0 obsahuje prvky mapy webu s `SiteMap` třídy, určuje řadu integrovaných navigační Web a výchozího zprostředkovatele mapy webu, který očekává, že informace mapy webu trvale uložena do souboru XML.</span><span class="sxs-lookup"><span data-stu-id="a842a-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="a842a-368">Chcete-li použít informace o lokalitě mapování z jiného zdroje, jako z databáze, architektura s aplikací nebo vzdálené webové služby je nutné vytvořit vlastního zprostředkovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="a842a-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="a842a-369">To zahrnuje vytvoření třídy, která je odvozena přímo nebo nepřímo ze `SiteMapProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="a842a-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="a842a-370">V tomto kurzu jsme viděli, jak vytvořit vlastního zprostředkovatele mapy webu, který mapy webu na základě produktů a kategorii informací vyřazeny z architektury aplikace.</span><span class="sxs-lookup"><span data-stu-id="a842a-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="a842a-371">Náš poskytovatel rozšířené `StaticSiteMapProvider` třídy a zavedením vytváření `BuildSiteMap` metodu, která načte data, mapování hierarchie lokality který je v mezipaměti výsledný struktury v proměnnou na úrovni.</span><span class="sxs-lookup"><span data-stu-id="a842a-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="a842a-372">Pomocí funkce zpětného volání jsme použili závislosti mezipaměti SQL zneplatnění mezipaměti strukturu, kdy základní `Categories` nebo `Products` byla změněna data.</span><span class="sxs-lookup"><span data-stu-id="a842a-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="a842a-373">Všechno nejlepší programování!</span><span class="sxs-lookup"><span data-stu-id="a842a-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="a842a-374">Další čtení</span><span class="sxs-lookup"><span data-stu-id="a842a-374">Further Reading</span></span>

<span data-ttu-id="a842a-375">Další informace o tématech, které jsou popsané v tomto kurzu najdete na následujících odkazech:</span><span class="sxs-lookup"><span data-stu-id="a842a-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="a842a-376">[Ukládání mapy webu v systému SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) a [zprostředkovatele mapy webu SQL jste již bylo čekání](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="a842a-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="a842a-377">Model poskytovatele s najdete v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="a842a-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="a842a-378">Sada nástrojů pro poskytovatele</span><span class="sxs-lookup"><span data-stu-id="a842a-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="a842a-379">Zkoumání ASP.NET 2.0 s funkcemi navigace na webu</span><span class="sxs-lookup"><span data-stu-id="a842a-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="a842a-380">O autorovi</span><span class="sxs-lookup"><span data-stu-id="a842a-380">About the Author</span></span>

<span data-ttu-id="a842a-381">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a Zakladatel [4GuysFromRolla.com](http://www.4guysfromrolla.com), má práce s Microsoft webových technologiích od roku 1998.</span><span class="sxs-lookup"><span data-stu-id="a842a-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a842a-382">Scott funguje jako nezávislý konzultant, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="a842a-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a842a-383">Jeho nejnovější knihy [ *Edice nakladatelství Sams naučit sami ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a842a-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a842a-384">Může být dosáhl v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a842a-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a842a-385">nebo prostřednictvím jeho blogu, který lze nalézt v [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a842a-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a842a-386">Speciální k</span><span class="sxs-lookup"><span data-stu-id="a842a-386">Special Thanks To</span></span>

<span data-ttu-id="a842a-387">V této sérii kurzů byl recenzován uživatelem mnoho užitečných revidující.</span><span class="sxs-lookup"><span data-stu-id="a842a-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a842a-388">Vedoucí revidující pro účely tohoto kurzu byly Dave Gardner, Zack Jones, Teresy Murphy a Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="a842a-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="a842a-389">Zajímat téma Moje nadcházejících článcích MSDN?</span><span class="sxs-lookup"><span data-stu-id="a842a-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a842a-390">Pokud ano, vyřaďte mě řádek na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a842a-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="a842a-391">Předchozí</span><span class="sxs-lookup"><span data-stu-id="a842a-391">Previous</span></span>](building-a-custom-database-driven-site-map-provider-cs.md)
