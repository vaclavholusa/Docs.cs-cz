---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
title: Dosažení maximálního výkonu se sadou Entity Framework 4.0 v ASP.NET 4 webové aplikace | Dokumentace Microsoftu
author: tdykstra
description: V této sérii kurzů staví na Contoso University webovou aplikaci, která se vytvořila Začínáme s Entity Framework 4.0 série kurzů. I...
ms.author: aspnetcontent
ms.date: 01/26/2011
ms.assetid: 4e43455e-dfa1-42db-83cb-c987703f04b5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: 2c5aa6c8a512ccd2ff4b94f5a8a60b31aaa39fc5
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/05/2018
ms.locfileid: "37828277"
---
<a name="maximizing-performance-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="a3e53-104">Dosažení maximálního výkonu se sadou Entity Framework 4.0 v ASP.NET 4 webové aplikace</span><span class="sxs-lookup"><span data-stu-id="a3e53-104">Maximizing Performance with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>
====================
<span data-ttu-id="a3e53-105">podle [Petr Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="a3e53-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="a3e53-106">V této sérii kurzů staví na Contoso University webovou aplikaci, která se vytvořila [Začínáme s Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) série kurzů.</span><span class="sxs-lookup"><span data-stu-id="a3e53-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="a3e53-107">Pokud nebyla dokončena v předchozích kurzech, jako výchozí bod pro účely tohoto kurzu můžete [stáhnout aplikaci](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) , kterou by jste vytvořili.</span><span class="sxs-lookup"><span data-stu-id="a3e53-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="a3e53-108">Můžete také [stáhnout aplikaci](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , který vytvoří kompletní série kurzů.</span><span class="sxs-lookup"><span data-stu-id="a3e53-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="a3e53-109">Pokud máte dotazy týkající se těchto kurzů, můžete je publikovat [fórum ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="a3e53-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="a3e53-110">V předchozím kurzu jste viděli, jak zpracování konfliktů souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="a3e53-110">In the previous tutorial, you saw how to handle concurrency conflicts.</span></span> <span data-ttu-id="a3e53-111">Tento kurz ukazuje možnosti pro zlepšení výkonu webové aplikace ASP.NET, která používá Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="a3e53-111">This tutorial shows options for improving the performance of an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="a3e53-112">Dozvíte několik metod pro dosažení maximálního výkonu, nebo pro diagnostiku problémů s výkonem.</span><span class="sxs-lookup"><span data-stu-id="a3e53-112">You'll learn several methods for maximizing performance or for diagnosing performance problems.</span></span>

<span data-ttu-id="a3e53-113">Informace uvedené v následujících částech by mohla být užitečná v širokou řadu scénářů:</span><span class="sxs-lookup"><span data-stu-id="a3e53-113">Information presented in the following sections is likely to be useful in a broad variety of scenarios:</span></span>

- <span data-ttu-id="a3e53-114">Efektivní načtěte související data.</span><span class="sxs-lookup"><span data-stu-id="a3e53-114">Efficiently load related data.</span></span>
- <span data-ttu-id="a3e53-115">Správa stavu zobrazení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-115">Manage view state.</span></span>

<span data-ttu-id="a3e53-116">Informace uvedené v následující části mohou být užitečné, pokud máte jednotlivé dotazy této k dispozici problémy s výkonem:</span><span class="sxs-lookup"><span data-stu-id="a3e53-116">Information presented in the following sections might be useful if you have individual queries that present performance problems:</span></span>

- <span data-ttu-id="a3e53-117">Použití `NoTracking` merge – možnost.</span><span class="sxs-lookup"><span data-stu-id="a3e53-117">Use the `NoTracking` merge option.</span></span>
- <span data-ttu-id="a3e53-118">Před kompilací dotazů LINQ.</span><span class="sxs-lookup"><span data-stu-id="a3e53-118">Pre-compile LINQ queries.</span></span>
- <span data-ttu-id="a3e53-119">Prozkoumejte query příkazy, odeslané do databáze.</span><span class="sxs-lookup"><span data-stu-id="a3e53-119">Examine query commands sent to the database.</span></span>

<span data-ttu-id="a3e53-120">Informace uvedené v následující části je potenciálně užitečné pro aplikace, které mají velmi velkých datových modelů:</span><span class="sxs-lookup"><span data-stu-id="a3e53-120">Information presented in the following section is potentially useful for applications that have extremely large data models:</span></span>

- <span data-ttu-id="a3e53-121">Předem vygenerujte zobrazení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-121">Pre-generate views.</span></span>

> [!NOTE]
> <span data-ttu-id="a3e53-122">Je celá řada faktorů, včetně řadí velikosti dat požadavků a odpovědí, rychlost databázových dotazů, kolik požadavků, že server lze zařadit do fronty a jak rychle můžete služby a dokonce efektivitu žádné vliv na výkon webové aplikace skript klienta knihovny, které je možné, že používáte.</span><span class="sxs-lookup"><span data-stu-id="a3e53-122">Web application performance is affected by many factors, including things like the size of request and response data, the speed of database queries, how many requests the server can queue and how quickly it can service them, and even the efficiency of any client-script libraries you might be using.</span></span> <span data-ttu-id="a3e53-123">Pokud výkon je velmi důležité ve vaší aplikaci nebo testování nebo role experience systému ukazuje, že není vyhovující výkon aplikace, měli byste postupovat podle normální protokol pro optimalizaci výkonu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-123">If performance is critical in your application, or if testing or experience shows that application performance isn't satisfactory, you should follow normal protocol for performance tuning.</span></span> <span data-ttu-id="a3e53-124">Měření k určení, kde dochází k kritické body výkonu a pak Adresujte oblastí, které budou mít největší vliv na výkon aplikací.</span><span class="sxs-lookup"><span data-stu-id="a3e53-124">Measure to determine where performance bottlenecks are occurring, and then address the areas that will have the greatest impact on overall application performance.</span></span>
> 
> <span data-ttu-id="a3e53-125">Toto téma se zaměřuje především na způsoby, ve kterém může potenciálně zvýšit výkon konkrétně Entity Framework v technologii ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a3e53-125">This topic focuses mainly on ways in which you can potentially improve the performance specifically of the Entity Framework in ASP.NET.</span></span> <span data-ttu-id="a3e53-126">Návrhy Zde jsou užitečné, pokud zjistíte, že přístup k datům je jedním z kritické body výkonu ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a3e53-126">The suggestions here are useful if you determine that data access is one of the performance bottlenecks in your application.</span></span> <span data-ttu-id="a3e53-127">S výjimkou toho, jak je uvedeno, je zde vysvětleno metody by neměly být zahrnuté &quot;osvědčené postupy&quot; obecně – řada z nich jsou vhodné pouze ve výjimečných případech nebo na adresu velmi konkrétní typy kritické body výkonu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-127">Except as noted, the methods explained here shouldn't be considered &quot;best practices&quot; in general — many of them are appropriate only in exceptional situations or to address very specific kinds of performance bottlenecks.</span></span>


<span data-ttu-id="a3e53-128">Zahájit kurz, spusťte sadu Visual Studio a otevřete webové aplikace Contoso University, kterým jste pracovali v předchozím kurzu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-128">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="efficiently-loading-related-data"></a><span data-ttu-id="a3e53-129">Efektivní načítání souvisejících dat</span><span class="sxs-lookup"><span data-stu-id="a3e53-129">Efficiently Loading Related Data</span></span>

<span data-ttu-id="a3e53-130">Existuje několik způsobů, Entity Framework mohou načíst související data do navigační vlastnosti entity:</span><span class="sxs-lookup"><span data-stu-id="a3e53-130">There are several ways that the Entity Framework can load related data into the navigation properties of an entity:</span></span>

- <span data-ttu-id="a3e53-131">*Opožděné načtení*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-131">*Lazy loading*.</span></span> <span data-ttu-id="a3e53-132">Pokud entita je nejdřív přečíst, související data nebude načten.</span><span class="sxs-lookup"><span data-stu-id="a3e53-132">When the entity is first read, related data isn't retrieved.</span></span> <span data-ttu-id="a3e53-133">Ale při prvním pokusu o přístup k vlastnosti navigace data požadovaná pro tuto navigační vlastnost je automaticky načte.</span><span class="sxs-lookup"><span data-stu-id="a3e53-133">However, the first time you attempt to access a navigation property, the data required for that navigation property is automatically retrieved.</span></span> <span data-ttu-id="a3e53-134">Výsledkem je více dotazy odeslané do databáze – jeden pro samotné entity a jeden pokaždé, když související data entity musí být načten.</span><span class="sxs-lookup"><span data-stu-id="a3e53-134">This results in multiple queries sent to the database — one for the entity itself and one each time that related data for the entity must be retrieved.</span></span> 

    <span data-ttu-id="a3e53-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="a3e53-136">*Předběžné načítání*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-136">*Eager loading*.</span></span> <span data-ttu-id="a3e53-137">Při čtení entity související data načíst společně.</span><span class="sxs-lookup"><span data-stu-id="a3e53-137">When the entity is read, related data is retrieved along with it.</span></span> <span data-ttu-id="a3e53-138">Obvykle v důsledku jednoho spojení dotaz, který zkopíruje všechna data, který je nezbytný.</span><span class="sxs-lookup"><span data-stu-id="a3e53-138">This typically results in a single join query that retrieves all of the data that's needed.</span></span> <span data-ttu-id="a3e53-139">Předběžné načítání určíte pomocí `Include` metodu, jak jste se seznámili s již v těchto kurzech.</span><span class="sxs-lookup"><span data-stu-id="a3e53-139">You specify eager loading by using the `Include` method, as you've seen already in these tutorials.</span></span>

<span data-ttu-id="a3e53-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

- <span data-ttu-id="a3e53-141">*Explicitní načtení*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-141">*Explicit loading*.</span></span> <span data-ttu-id="a3e53-142">To se podobá opožděné načtení, s tím rozdílem, že explicitně načíst související data v kódu. je tomu tak není automaticky při přístupu k vlastnosti navigace.</span><span class="sxs-lookup"><span data-stu-id="a3e53-142">This is similar to lazy loading, except that you explicitly retrieve the related data in code; it doesn't happen automatically when you access a navigation property.</span></span> <span data-ttu-id="a3e53-143">Načíst související data ručně pomocí `Load` metoda navigační vlastnost pro kolekce, nebo můžete použít `Load` metoda referenční vlastnosti pro vlastnosti, které obsahují jeden objekt.</span><span class="sxs-lookup"><span data-stu-id="a3e53-143">You load related data manually using the `Load` method of the navigation property for collections, or you use the `Load` method of the reference property for properties that hold a single object.</span></span> <span data-ttu-id="a3e53-144">(Například volání `PersonReference.Load` metodu pro načtení `Person` navigační vlastnost `Department` entity.)</span><span class="sxs-lookup"><span data-stu-id="a3e53-144">(For example, you call the `PersonReference.Load` method to load the `Person` navigation property of a `Department` entity.)</span></span>

    <span data-ttu-id="a3e53-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="a3e53-146">Protože jejich není okamžitě hodnoty vlastností, opožděné načtení a explicitní načtení se obě označují jako *odložené načítání*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-146">Because they don't immediately retrieve the property values, lazy loading and explicit loading are also both known as *deferred loading*.</span></span>

<span data-ttu-id="a3e53-147">Opožděné načtení je výchozí chování pro generovaný návrhářem kontextu objektu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-147">Lazy loading is the default behavior for an object context that has been generated by the designer.</span></span> <span data-ttu-id="a3e53-148">Pokud otevřete *SchoolModel.Designer.cs* soubor, který definuje třídu objektů kontextu, najdete tu tři metody konstruktoru a každý z nich obsahuje následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="a3e53-148">If you open the *SchoolModel.Designer.cs* file that defines the object context class, you'll find three constructor methods, and each of them includes the following statement:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="a3e53-149">Obecně platí Pokud víte, musíte souvisejících dat pro každou entitu, které načtené, nemůžou dočkat, až načítání nabízí nejlepší výkon, protože je obvykle efektivnější než samostatné dotazy pro každou entitu načíst jednoho dotazu odeslaného do databáze.</span><span class="sxs-lookup"><span data-stu-id="a3e53-149">In general, if you know you need related data for every entity retrieved, eager loading offers the best performance, because a single query sent to the database is typically more efficient than separate queries for each entity retrieved.</span></span> <span data-ttu-id="a3e53-150">Na druhou stranu, pokud potřebujete jenom zřídka přístup k navigační vlastnosti entity, nebo jenom pro malé sadu entit, opožděné načtení nebo explicitní načtení může být mnohem efektivnější, protože nemůžou dočkat, až načítání by byl načten více dat, než potřebujete.</span><span class="sxs-lookup"><span data-stu-id="a3e53-150">On the other hand, if you need to access an entity's navigation properties only infrequently or only for a small set of the entities, lazy loading or explicit loading may be more efficient, because eager loading would retrieve more data than you need.</span></span>

<span data-ttu-id="a3e53-151">Ve webové aplikaci opožděné načtení může být poměrně málo hodnota i přesto, protože provedou uživatelské akce, které ovlivňují potřebu souvisejících dat v prohlížeči, která nemá připojení ke kontextu objektu, který vykreslí stránku.</span><span class="sxs-lookup"><span data-stu-id="a3e53-151">In a web application, lazy loading may be of relatively little value anyway, because user actions that affect the need for related data take place in the browser, which has no connection to the object context that rendered the page.</span></span> <span data-ttu-id="a3e53-152">Na druhé straně když jste databind ovládací prvek, obvykle víte, jaká data potřebujete a proto je obvykle osvědčené zvolit předběžné načítání nebo odložené načítání na základě co je vhodné pro jednotlivé scénáře.</span><span class="sxs-lookup"><span data-stu-id="a3e53-152">On the other hand, when you databind a control, you typically know what data you need, and so it's generally best to choose eager loading or deferred loading based on what's appropriate in each scenario.</span></span>

<span data-ttu-id="a3e53-153">Kromě toho ovládací prvek databound použít objekt entity po vyřazení objektu kontextu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-153">In addition, a databound control might use an entity object after the object context is disposed.</span></span> <span data-ttu-id="a3e53-154">V takovém případě se pokus o opožděné načtení navigační vlastnost selže.</span><span class="sxs-lookup"><span data-stu-id="a3e53-154">In that case, an attempt to lazy-load a navigation property would fail.</span></span> <span data-ttu-id="a3e53-155">Je jasné, které se zobrazí chybová zpráva: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span><span class="sxs-lookup"><span data-stu-id="a3e53-155">The error message you receive is clear: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span></span>

<span data-ttu-id="a3e53-156">`EntityDataSource` Ovládacího prvku ve výchozím nastavení zakáže opožděné načtení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-156">The `EntityDataSource` control disables lazy loading by default.</span></span> <span data-ttu-id="a3e53-157">Pro `ObjectDataSource` ovládací prvek, že používáte aktuální kurzu (nebo Pokud přistupujete kontextu objektu z kódu stránky), existuje několik způsobů, jak můžete provést opožděné načtení ve výchozím nastavení zakázané.</span><span class="sxs-lookup"><span data-stu-id="a3e53-157">For the `ObjectDataSource` control that you're using for the current tutorial (or if you access the object context from page code), there are several ways you can make lazy loading disabled by default.</span></span> <span data-ttu-id="a3e53-158">Můžete jej zakázat při vytváření instance kontextu objektu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-158">You can disable it when you instantiate an object context.</span></span> <span data-ttu-id="a3e53-159">Například přidejte následující řádek na konstruktor metodu `SchoolRepository` třídy:</span><span class="sxs-lookup"><span data-stu-id="a3e53-159">For example, you can add the following line to the constructor method of the `SchoolRepository` class:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="a3e53-160">Aplikace Contoso University provede automaticky vypnout opožděné načtení, tak, aby tato vlastnost nebude muset nastavit vždy, když je vytvořena instance kontextu kontextu objektu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-160">For the Contoso University application, you'll make the object context automatically disable lazy loading so that this property doesn't have to be set whenever a context is instantiated.</span></span>

<span data-ttu-id="a3e53-161">Otevřít *SchoolModel.edmx* dat model, klikněte na návrhové ploše a potom v podokně vlastností nastavte **opožděné načtení povoleno** vlastnost `False`.</span><span class="sxs-lookup"><span data-stu-id="a3e53-161">Open the *SchoolModel.edmx* data model, click the design surface, and then in the properties pane set the **Lazy Loading Enabled** property to `False`.</span></span> <span data-ttu-id="a3e53-162">Uložte a zavřete datový model.</span><span class="sxs-lookup"><span data-stu-id="a3e53-162">Save and close the data model.</span></span>

<span data-ttu-id="a3e53-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

## <a name="managing-view-state"></a><span data-ttu-id="a3e53-164">Správa stavu zobrazení</span><span class="sxs-lookup"><span data-stu-id="a3e53-164">Managing View State</span></span>

<span data-ttu-id="a3e53-165">Aby bylo možné poskytovat aktualizace funkce, webové stránky ASP.NET uložit původní hodnoty vlastností entity při vykreslení stránky.</span><span class="sxs-lookup"><span data-stu-id="a3e53-165">In order to provide update functionality, an ASP.NET web page must store the original property values of an entity when a page is rendered.</span></span> <span data-ttu-id="a3e53-166">Během zpracování ovládací prvek postbacku můžete znovu vytvořit původní stav entity a volat entity `Attach` metody před použitím změn a volání `SaveChanges` metody.</span><span class="sxs-lookup"><span data-stu-id="a3e53-166">During postback processing the control can re-create the original state of the entity and call the entity's `Attach` method before applying changes and calling the `SaveChanges` method.</span></span> <span data-ttu-id="a3e53-167">Ve výchozím nastavení používají ovládací prvky webových formulářů ASP.NET dat zobrazení stavu k uložení původní hodnoty.</span><span class="sxs-lookup"><span data-stu-id="a3e53-167">By default, ASP.NET Web Forms data controls use view state to store the original values.</span></span> <span data-ttu-id="a3e53-168">Stav zobrazení však může ovlivnit výkon, protože je uložený v skrytá pole, které může významně zvětšit velikost stránky, která se odešle do a z prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a3e53-168">However, view state can affect performance, because it's stored in hidden fields that can substantially increase the size of the page that's sent to and from the browser.</span></span>

<span data-ttu-id="a3e53-169">Techniky pro správu stavu zobrazení, nebo alternativy, jako je například stav relace nejsou jedinečné Entity Framework, tak v tomto kurzu není přejít na toto téma podrobně.</span><span class="sxs-lookup"><span data-stu-id="a3e53-169">Techniques for managing view state, or alternatives such as session state, aren't unique to the Entity Framework, so this tutorial doesn't go into this topic in detail.</span></span> <span data-ttu-id="a3e53-170">Další informace najdete v odkazech na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-170">For more information see the links at the end of the tutorial.</span></span>

<span data-ttu-id="a3e53-171">Nicméně 4 verzi technologie ASP.NET poskytuje nový způsob práce se stav zobrazení, které byste měli vědět každý vývojář technologie ASP.NET webové formuláře aplikací: `ViewStateMode` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a3e53-171">However, version 4 of ASP.NET provides a new way of working with view state that every ASP.NET developer of Web Forms applications should be aware of: the `ViewStateMode` property.</span></span> <span data-ttu-id="a3e53-172">Tato vlastnost lze nastavit na úrovni stránky nebo ovládací prvek a umožňuje zakázat zobrazení stavu ve výchozím nastavení pro stránku a povolit pouze pro ovládací prvky, které potřebujete.</span><span class="sxs-lookup"><span data-stu-id="a3e53-172">This new property can be set at the page or control level, and it enables you to disable view state by default for a page and enable it only for controls that need it.</span></span>

<span data-ttu-id="a3e53-173">Vhodné pro aplikace, kde je nejdůležitější výkon, je vždy zakázat stav zobrazení na úrovni stránky a povolit pouze pro ovládací prvky, které je vyžadují.</span><span class="sxs-lookup"><span data-stu-id="a3e53-173">For applications where performance is critical, a good practice is to always disable view state at the page level and enable it only for controls that require it.</span></span> <span data-ttu-id="a3e53-174">Velikost zobrazení stavu na stránkách společnosti Contoso University nebude možné snížit podstatně touto metodou, ale pokud chcete zobrazit, jak to funguje, budete používat ho *Instructors.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="a3e53-174">The size of view state in the Contoso University pages wouldn't be substantially decreased by this method, but to see how it works, you'll do it for the *Instructors.aspx* page.</span></span> <span data-ttu-id="a3e53-175">Tuto stránku obsahuje mnoho ovládacích prvků, včetně `Label` ovládací prvek, který se má zobrazit stav Zakázáno.</span><span class="sxs-lookup"><span data-stu-id="a3e53-175">That page contains many controls, including a `Label` control that has view state disabled.</span></span> <span data-ttu-id="a3e53-176">Žádné ovládací prvky na této stránce ve skutečnosti je potřeba mít povolen stav zobrazení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-176">None of the controls on this page actually need to have view state enabled.</span></span> <span data-ttu-id="a3e53-177">( `DataKeyNames` Vlastnost `GridView` ovládací prvek určuje stav, který je třeba udržovat mezi jednotlivými zpětnými odesláními, ale tyto hodnoty jsou uloženy v stav ovládacího prvku, který nemá vliv `ViewStateMode` vlastnosti.)</span><span class="sxs-lookup"><span data-stu-id="a3e53-177">(The `DataKeyNames` property of the `GridView` control specifies state that must be maintained between postbacks, but these values are kept in control state, which isn't affected by the `ViewStateMode` property.)</span></span>

<span data-ttu-id="a3e53-178">`Page` Směrnice a `Label` aktuálně značky ovládacího prvku se podobá následujícímu příkladu:</span><span class="sxs-lookup"><span data-stu-id="a3e53-178">The `Page` directive and `Label` control markup currently resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="a3e53-179">Proveďte následující změny:</span><span class="sxs-lookup"><span data-stu-id="a3e53-179">Make the following changes:</span></span>

- <span data-ttu-id="a3e53-180">Přidat `ViewStateMode="Disabled"` k `Page` směrnice.</span><span class="sxs-lookup"><span data-stu-id="a3e53-180">Add `ViewStateMode="Disabled"` to the `Page` directive.</span></span>
- <span data-ttu-id="a3e53-181">Odebrat `ViewStateMode="Disabled"` z `Label` ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="a3e53-181">Remove `ViewStateMode="Disabled"` from the `Label` control.</span></span>

<span data-ttu-id="a3e53-182">Značky teď vypadá podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="a3e53-182">The markup now resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="a3e53-183">Stav zobrazení je teď zakázané pro všechny ovládací prvky.</span><span class="sxs-lookup"><span data-stu-id="a3e53-183">View state is now disabled for all controls.</span></span> <span data-ttu-id="a3e53-184">Pokud chcete později přidat ovládací prvek, který se musí použít stav zobrazení, všechno, co potřebujete udělat je zahrnout `ViewStateMode="Enabled"` atribut pro ovládací prvek.</span><span class="sxs-lookup"><span data-stu-id="a3e53-184">If you later add a control that does need to use view state, all you need to do is include the `ViewStateMode="Enabled"` attribute for that control.</span></span>

## <a name="using-the-notracking-merge-option"></a><span data-ttu-id="a3e53-185">Pomocí možnosti sloučení NoTracking</span><span class="sxs-lookup"><span data-stu-id="a3e53-185">Using The NoTracking Merge Option</span></span>

<span data-ttu-id="a3e53-186">Když kontextu objektu načte řádky databáze, vytvoří objekty entity, které představují je ve výchozím nastavení také sleduje tyto objekty entity pomocí jeho správce stavu objektu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-186">When an object context retrieves database rows and creates entity objects that represent them, by default it also tracks those entity objects using its object state manager.</span></span> <span data-ttu-id="a3e53-187">Tato data sledování funguje jako mezipaměť a používá se při aktualizaci entity.</span><span class="sxs-lookup"><span data-stu-id="a3e53-187">This tracking data acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="a3e53-188">Protože webová aplikace obvykle má instance kontextu krátkodobých objektů, dotazy často vracející data, která není nutné ke sledování, protože objekt kontextu, který čte je uvolní předtím, než se znovu použít některý z entity, které načte nebo aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="a3e53-188">Because a web application typically has short-lived object context instances, queries often return data that doesn't need to be tracked, because the object context that reads them will be disposed before any of the entities it reads are used again or updated.</span></span>

<span data-ttu-id="a3e53-189">V rozhraní Entity Framework, můžete určit, zda kontext objektu sleduje nastavením objekty entity *merge – možnost*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-189">In the Entity Framework, you can specify whether the object context tracks entity objects by setting a *merge option*.</span></span> <span data-ttu-id="a3e53-190">Můžete nastavit možnost sloučení pro jednotlivé dotazy nebo sady entit.</span><span class="sxs-lookup"><span data-stu-id="a3e53-190">You can set the merge option for individual queries or for entity sets.</span></span> <span data-ttu-id="a3e53-191">Pokud ji nastavíte pro sadu entit, to znamená, že nastavujete výchozí možnost sloučení pro všechny dotazy, které jsou vytvořeny pro tuto sadu entit.</span><span class="sxs-lookup"><span data-stu-id="a3e53-191">If you set it for an entity set, that means that you're setting the default merge option for all queries that are created for that entity set.</span></span>

<span data-ttu-id="a3e53-192">Aplikace Contoso University, není potřeba sledování pro všechny sady entit, které lze používat z úložiště, abyste mohli nastavit možnost sloučení `NoTracking` pro tyto sady entit, když vytvoříte instanci objektu kontextu v třídě úložiště.</span><span class="sxs-lookup"><span data-stu-id="a3e53-192">For the Contoso University application, tracking isn't needed for any of the entity sets that you access from the repository, so you can set the merge option to `NoTracking` for those entity sets when you instantiate the object context in the repository class.</span></span> <span data-ttu-id="a3e53-193">(Všimněte si, že v tomto kurzu se nastavení možnosti sloučení nemá znatelný vliv na výkon vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="a3e53-193">(Note that in this tutorial, setting the merge option won't have a noticeable effect on the application's performance.</span></span> <span data-ttu-id="a3e53-194">Tím `NoTracking` možnosti se budou pravděpodobně uskutečňovat zlepšení výkonu pozorovatelných pouze v určitých scénářích dat velkého.)</span><span class="sxs-lookup"><span data-stu-id="a3e53-194">The `NoTracking` option is likely to make an observable performance improvement only in certain high-data-volume scenarios.)</span></span>

<span data-ttu-id="a3e53-195">Ve složce DAL otevřete *SchoolRepository.cs* a přidejte metodu konstruktor, který nastaví možnost sloučení pro sady entit, nemá přístup k úložišti:</span><span class="sxs-lookup"><span data-stu-id="a3e53-195">In the DAL folder, open the *SchoolRepository.cs* file and add a constructor method that sets the merge option for the entity sets that the repository accesses:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

## <a name="pre-compiling-linq-queries"></a><span data-ttu-id="a3e53-196">Předem kompilaci dotazů LINQ</span><span class="sxs-lookup"><span data-stu-id="a3e53-196">Pre-Compiling LINQ Queries</span></span>

<span data-ttu-id="a3e53-197">Při prvním Entity Framework provede dotaz Entity SQL v rámci životnosti daný `ObjectContext` instance, bude trvat nějakou dobu kompilace dotazu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-197">The first time that the Entity Framework executes an Entity SQL query within the life of a given `ObjectContext` instance, it takes some time to compile the query.</span></span> <span data-ttu-id="a3e53-198">Výsledek kompilace je uložené v mezipaměti, což znamená, že jsou mnohem rychlejší, protože další spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-198">The result of compilation is cached, which means that subsequent executions of the query are much quicker.</span></span> <span data-ttu-id="a3e53-199">Dotazy LINQ podle podobný vzorec, s tím rozdílem, že určitou část práce potřebné ke kompilaci dotazu se provádí při každém spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-199">LINQ queries follow a similar pattern, except that some of the work required to compile the query is done every time the query is executed.</span></span> <span data-ttu-id="a3e53-200">Jinými slovy pro LINQ dotazy, ve výchozím nastavení všechny výsledky kompilace jsou uložené v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="a3e53-200">In other words, for LINQ queries, by default not all of the results of compilation are cached.</span></span>

<span data-ttu-id="a3e53-201">Pokud máte dotaz LINQ, který plánujete spouštět opakovaně běžný kontextu objektu, můžete napsat kód, který způsobí, že všechny výsledky kompilace do mezipaměti při prvním spuštění dotazu LINQ.</span><span class="sxs-lookup"><span data-stu-id="a3e53-201">If you have a LINQ query that you expect to run repeatedly in the life of an object context, you can write code that causes all of the results of compilation to be cached the first time the LINQ query is run.</span></span>

<span data-ttu-id="a3e53-202">Jako ukázku, provedete to pro dva `Get` metody v `SchoolRepository` tříd, z nichž jeden nepřijímá žádné parametry ( `GetInstructorNames` metoda) a ten, který vyžaduje parametr ( `GetDepartmentsByAdministrator` – metoda).</span><span class="sxs-lookup"><span data-stu-id="a3e53-202">As an illustration, you'll do this for two `Get` methods in the `SchoolRepository` class, one of which doesn't take any parameters (the `GetInstructorNames` method), and one that does require a parameter (the `GetDepartmentsByAdministrator` method).</span></span> <span data-ttu-id="a3e53-203">Tyto metody jak se stát nyní ve skutečnosti není potřeba kompilovat, protože nejsou dotazů LINQ:</span><span class="sxs-lookup"><span data-stu-id="a3e53-203">These methods as they stand now actually don't need to be compiled because they aren't LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

<span data-ttu-id="a3e53-204">Ale tak, aby si můžete vyzkoušet kompilované dotazy, které budete pokračovat, jako by tyto napsán jako následující dotazy LINQ:</span><span class="sxs-lookup"><span data-stu-id="a3e53-204">However, so that you can try out compiled queries, you'll proceed as if these had been written as the following LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="a3e53-205">Můžete změnit kód v těchto metodách na co má uvedené výše a spuštění aplikace pro ověření, zda funguje než budete pokračovat.</span><span class="sxs-lookup"><span data-stu-id="a3e53-205">You could change the code in these methods to what's shown above and run the application to verify that it works before continuing.</span></span> <span data-ttu-id="a3e53-206">Ale v následujících pokynech rovnou do vytváření Předkompilovaná verze.</span><span class="sxs-lookup"><span data-stu-id="a3e53-206">But the following instructions jump right into creating pre-compiled versions of them.</span></span>

<span data-ttu-id="a3e53-207">Vytvořit soubor třídy v *DAL* složky, pojmenujte ho *SchoolEntities.cs*a nahraďte existující kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="a3e53-207">Create a class file in the *DAL* folder, name it *SchoolEntities.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="a3e53-208">Tento kód vytvoří částečnou třídu, která rozšiřuje třídu automaticky generovaný kontext.</span><span class="sxs-lookup"><span data-stu-id="a3e53-208">This code creates a partial class that extends the automatically generated object context class.</span></span> <span data-ttu-id="a3e53-209">Částečné třídy obsahuje dvě kompilované dotazy LINQ pomocí `Compile` metodu `CompiledQuery` třídy.</span><span class="sxs-lookup"><span data-stu-id="a3e53-209">The partial class includes two compiled LINQ queries using the `Compile` method of the `CompiledQuery` class.</span></span> <span data-ttu-id="a3e53-210">Vytvoří také metody, které můžete použít k volání dotazy.</span><span class="sxs-lookup"><span data-stu-id="a3e53-210">It also creates methods that you can use to call the queries.</span></span> <span data-ttu-id="a3e53-211">Uložte a zavřete tento soubor.</span><span class="sxs-lookup"><span data-stu-id="a3e53-211">Save and close this file.</span></span>

<span data-ttu-id="a3e53-212">Dále v *SchoolRepository.cs*, změňte existující `GetInstructorNames` a `GetDepartmentsByAdministrator` metody v úložišti třídy tak, aby volání kompilované dotazy:</span><span class="sxs-lookup"><span data-stu-id="a3e53-212">Next, in *SchoolRepository.cs*, change the existing `GetInstructorNames` and `GetDepartmentsByAdministrator` methods in the repository class so that they call the compiled queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

<span data-ttu-id="a3e53-213">Spustit *Departments.aspx* stránku a zkontrolujte, jestli funguje stejně jako dříve.</span><span class="sxs-lookup"><span data-stu-id="a3e53-213">Run the *Departments.aspx* page to verify that it works as it did before.</span></span> <span data-ttu-id="a3e53-214">`GetInstructorNames` Metoda je volána k naplnění rozevíracího seznamu správce a `GetDepartmentsByAdministrator` metoda je volána při kliknutí na **aktualizace** ověří, že žádné kurzů vedených je správcem více než jednoho oddělení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-214">The `GetInstructorNames` method is called in order to populate the administrator drop-down list, and the `GetDepartmentsByAdministrator` method is called when you click **Update** in order to verify that no instructor is an administrator of more than one department.</span></span>

<span data-ttu-id="a3e53-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

<span data-ttu-id="a3e53-216">Jste předem kompilovaných dotazů v aplikaci Contoso University pouze se dozvíte, jak to provést, není, protože by mohly zlepšit zlepšení života na zemi výkonu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-216">You've pre-compiled queries in the Contoso University application only to see how to do it, not because it would measurably improve performance.</span></span> <span data-ttu-id="a3e53-217">Předkompilace dotazů LINQ přidat úroveň složitosti kódu, proto se ujistěte, že můžete provést pouze pro dotazy, které ve skutečnosti představují problémových míst výkonu v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a3e53-217">Pre-compiling LINQ queries does add a level of complexity to your code, so make sure you do it only for queries that actually represent performance bottlenecks in your application.</span></span>

## <a name="examining-queries-sent-to-the-database"></a><span data-ttu-id="a3e53-218">Zkoumání odeslání dotazů do databáze</span><span class="sxs-lookup"><span data-stu-id="a3e53-218">Examining Queries Sent to the Database</span></span>

<span data-ttu-id="a3e53-219">Pokud zkoumáte problémy s výkonem, někdy je užitečné vědět přesné příkazy SQL, které odesílá Entity Framework do databáze.</span><span class="sxs-lookup"><span data-stu-id="a3e53-219">When you're investigating performance issues, sometimes it's helpful to know the exact SQL commands that the Entity Framework is sending to the database.</span></span> <span data-ttu-id="a3e53-220">Pokud pracujete s `IQueryable` objektu, provedete to jedním ze způsobů je použít `ToTraceString` metody.</span><span class="sxs-lookup"><span data-stu-id="a3e53-220">If you're working with an `IQueryable` object, one way to do this is to use the `ToTraceString` method.</span></span>

<span data-ttu-id="a3e53-221">V *SchoolRepository.cs*, změňte kód v `GetDepartmentsByName` metoda odpovídat následujícímu příkladu:</span><span class="sxs-lookup"><span data-stu-id="a3e53-221">In *SchoolRepository.cs*, change the code in the `GetDepartmentsByName` method to match the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.cs)]

<span data-ttu-id="a3e53-222">`departments` Proměnná musí být přetypovat na `ObjectQuery` zadejte pouze, protože `Where` metoda na konci na každém řádku vždy vytvoří `IQueryable` objektu; bez `Where` metody přetypování by být nutné.</span><span class="sxs-lookup"><span data-stu-id="a3e53-222">The `departments` variable must be cast to an `ObjectQuery` type only because the `Where` method at the end of the preceding line creates an `IQueryable` object; without the `Where` method, the cast would not be necessary.</span></span>

<span data-ttu-id="a3e53-223">Nastavit zarážku na `return` řádek a spusťte *Departments.aspx* stránky v ladicím programu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-223">Set a breakpoint on the `return` line, and then run the *Departments.aspx* page in the debugger.</span></span> <span data-ttu-id="a3e53-224">Pokud dostanete k zarážce, podívejte se `commandText` proměnné v **lokální** okno a použijte vizualizátor textu (na lupu v **hodnotu** sloupce) zobrazíte její hodnotu **Vizualizátor textu** okna.</span><span class="sxs-lookup"><span data-stu-id="a3e53-224">When you hit the breakpoint, examine the `commandText` variable in the **Locals** window and use the text visualizer (the magnifying glass in the **Value** column) to display its value in the **Text Visualizer** window.</span></span> <span data-ttu-id="a3e53-225">Můžete zobrazit celý příkaz SQL, která je výsledkem tento kód:</span><span class="sxs-lookup"><span data-stu-id="a3e53-225">You can see the entire SQL command that results from this code:</span></span>

<span data-ttu-id="a3e53-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="a3e53-227">Jako alternativu funkcí technologie IntelliTrace v sadě Visual Studio Ultimate poskytuje způsob, jak zobrazit příkazy SQL vygenerovaným rozhraním Entity Framework, která nevyžaduje, můžete změnit váš kód nebo dokonce nastavit zarážku.</span><span class="sxs-lookup"><span data-stu-id="a3e53-227">As an alternative, the IntelliTrace feature in Visual Studio Ultimate provides a way to view SQL commands generated by the Entity Framework that doesn't require you to change your code or even set a breakpoint.</span></span>

> [!NOTE]
> <span data-ttu-id="a3e53-228">Následující postupy můžete provést pouze v případě, že máte Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="a3e53-228">You can perform the following procedures only if you have Visual Studio Ultimate.</span></span>


<span data-ttu-id="a3e53-229">Obnovit původní kód v `GetDepartmentsByName` metodu a poté spusťte *Departments.aspx* stránky v ladicím programu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-229">Restore the original code in the `GetDepartmentsByName` method, and then run the *Departments.aspx* page in the debugger.</span></span>

<span data-ttu-id="a3e53-230">V sadě Visual Studio, vyberte **ladění** nabídce a potom **IntelliTrace**a potom **události IntelliTrace**.</span><span class="sxs-lookup"><span data-stu-id="a3e53-230">In Visual Studio, select the **Debug** menu, then **IntelliTrace**, and then **IntelliTrace Events**.</span></span>

<span data-ttu-id="a3e53-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="a3e53-232">V **IntelliTrace** okna, klikněte na tlačítko **příkaz Pozastavit vše**.</span><span class="sxs-lookup"><span data-stu-id="a3e53-232">In the **IntelliTrace** window, click **Break All**.</span></span>

<span data-ttu-id="a3e53-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="a3e53-234">**IntelliTrace** okně se zobrazí seznam posledních událostí:</span><span class="sxs-lookup"><span data-stu-id="a3e53-234">The **IntelliTrace** window displays a list of recent events:</span></span>

<span data-ttu-id="a3e53-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="a3e53-236">Klikněte na tlačítko **ADO.NET** řádku.</span><span class="sxs-lookup"><span data-stu-id="a3e53-236">Click the **ADO.NET** line.</span></span> <span data-ttu-id="a3e53-237">Rozšiřuje zobrazit text příkazu:</span><span class="sxs-lookup"><span data-stu-id="a3e53-237">It expands to show you the command text:</span></span>

<span data-ttu-id="a3e53-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="a3e53-239">Celý příkaz textový řetězec můžete zkopírovat do schránky z **lokální** okna.</span><span class="sxs-lookup"><span data-stu-id="a3e53-239">You can copy the entire command text string to the clipboard from the **Locals** window.</span></span>

<span data-ttu-id="a3e53-240">Předpokládejme, že jste pracovali s databází s další tabulky, vztahy a sloupců, než jednoduché `School` databáze.</span><span class="sxs-lookup"><span data-stu-id="a3e53-240">Suppose you were working with a database with more tables, relationships, and columns than the simple `School` database.</span></span> <span data-ttu-id="a3e53-241">Můžete se setkat dotaz, který shromažďuje všechny informace potřebné v jediném `Select` příkazu, který obsahuje více `Join` klauzule stane příliš složitý k zajištění efektivní práce.</span><span class="sxs-lookup"><span data-stu-id="a3e53-241">You might find that a query that gathers all the information you need in a single `Select` statement containing multiple `Join` clauses becomes too complex to work efficiently.</span></span> <span data-ttu-id="a3e53-242">V takovém případě můžete přepnout z eager načítání pro explicitní načtení pro zjednodušení dotazu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-242">In that case you can switch from eager loading to explicit loading to simplify the query.</span></span>

<span data-ttu-id="a3e53-243">Například, zkuste změnit kód v `GetDepartmentsByName` metoda *SchoolRepository.cs*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-243">For example, try changing the code in the `GetDepartmentsByName` method in *SchoolRepository.cs*.</span></span> <span data-ttu-id="a3e53-244">Aktuálně v tom, že metoda máte dotaz objektu, který má `Include` metody `Person` a `Courses` navigační vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a3e53-244">Currently in that method you have an object query that has `Include` methods for the `Person` and `Courses` navigation properties.</span></span> <span data-ttu-id="a3e53-245">Nahradit `return` příkaz s kódem, který provádí explicitní načtení, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="a3e53-245">Replace the `return` statement with code that performs explicit loading, as shown in the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="a3e53-246">Spustit *Departments.aspx* stránce v ladicím programu a zkontrolujte **IntelliTrace** okno znovu jako jste to udělali dříve.</span><span class="sxs-lookup"><span data-stu-id="a3e53-246">Run the *Departments.aspx* page in the debugger and check the **IntelliTrace** window again as you did before.</span></span> <span data-ttu-id="a3e53-247">Nyní tam, kde byla jednoho dotazu, uvidíte dlouhá pořadí z nich.</span><span class="sxs-lookup"><span data-stu-id="a3e53-247">Now, where there was a single query before, you see a long sequence of them.</span></span>

<span data-ttu-id="a3e53-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="a3e53-249">Klikněte na první **ADO.NET** řádku naleznete v tématu co se stalo s komplexní dotaz můžete prohlížet dříve.</span><span class="sxs-lookup"><span data-stu-id="a3e53-249">Click the first **ADO.NET** line to see what has happened to the complex query you viewed earlier.</span></span>

<span data-ttu-id="a3e53-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

<span data-ttu-id="a3e53-251">Dotaz z oddělení stal jednoduchý `Select` dotazu bez `Join` klauzule, ale je následována samostatné dotazy, které načítají související kurzy a správce, používáte sadu dva dotazy pro každé oddělení vrácený původní dotaz.</span><span class="sxs-lookup"><span data-stu-id="a3e53-251">The query from Departments has become a simple `Select` query with no `Join` clause, but it's followed by separate queries that retrieve related courses and an administrator, using a set of two queries for each department returned by the original query.</span></span>

> [!NOTE]
> <span data-ttu-id="a3e53-252">Pokud opožděné načtení povoleno, vzor, který se zobrazí tady pomocí stejného dotazu opakuje tolikrát, kolikrát, může dojít z opožděné načtení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-252">If you leave lazy loading enabled, the pattern you see here, with the same query repeated many times, might result from lazy loading.</span></span> <span data-ttu-id="a3e53-253">Vzor, který obvykle chcete se vyhnout se opožděné načtení souvisejících dat pro každý řádek v primární tabulce.</span><span class="sxs-lookup"><span data-stu-id="a3e53-253">A pattern that you typically want to avoid is lazy-loading related data for every row of the primary table.</span></span> <span data-ttu-id="a3e53-254">Pokud jste ověřili, že jeden spojení dotazu je příliš složitý pro je efektivní, by obvykle mohli zlepšit výkon v takových případech změnou primární dotaz, který bude použit předběžné načítání.</span><span class="sxs-lookup"><span data-stu-id="a3e53-254">Unless you've verified that a single join query is too complex to be efficient, you'd typically be able to improve performance in such cases by changing the primary query to use eager loading.</span></span>


## <a name="pre-generating-views"></a><span data-ttu-id="a3e53-255">Předem generování zobrazení</span><span class="sxs-lookup"><span data-stu-id="a3e53-255">Pre-Generating Views</span></span>

<span data-ttu-id="a3e53-256">Když `ObjectContext` prvním vytvoření objektu v nové doméně aplikace, Entity Framework generuje sadu tříd, které používá pro přístup k databázi.</span><span class="sxs-lookup"><span data-stu-id="a3e53-256">When an `ObjectContext` object is first created in a new application domain, the Entity Framework generates a set of classes that it uses to access the database.</span></span> <span data-ttu-id="a3e53-257">Tyto třídy se nazývají *zobrazení*, a pokud máte velké datový model, generuje tato zobrazení zpozdit na webu odpověď na první žádost o stránku po inicializaci nové aplikační doméně.</span><span class="sxs-lookup"><span data-stu-id="a3e53-257">These classes are called *views*, and if you have a very large data model, generating these views can delay the web site's response to the first request for a page after a new application domain is initialized.</span></span> <span data-ttu-id="a3e53-258">Toto zpoždění první žádosti můžete snížit vytváření zobrazení v době kompilace místo v době běhu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-258">You can reduce this first-request delay by creating the views at compile time rather than at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="a3e53-259">Pokud aplikace nemá modelu velmi velkých objemů dat, nebo pokud ho máte modelu velkých objemů dat, ale nejste obavy o problém s výkonem, který má vliv pouze úplně první požadavek na stránku po recyklaci služby IIS, můžete tuto část přeskočit.</span><span class="sxs-lookup"><span data-stu-id="a3e53-259">If your application doesn't have an extremely large data model, or if it does have a large data model but you aren't concerned about a performance problem that affects only the very first page request after IIS is recycled, you can skip this section.</span></span> <span data-ttu-id="a3e53-260">Zobrazení vytváření nestane pokaždé, když vytvoříte instanci `ObjectContext` objektu, protože zobrazení jsou ukládány do mezipaměti v doméně aplikace.</span><span class="sxs-lookup"><span data-stu-id="a3e53-260">View creation doesn't happen every time you instantiate an `ObjectContext` object, because the views are cached in the application domain.</span></span> <span data-ttu-id="a3e53-261">Proto pokud se často recyklace aplikace ve službě IIS, velmi málo žádostí stránek je výhodná předem vygenerovaných zobrazení.</span><span class="sxs-lookup"><span data-stu-id="a3e53-261">Therefore, unless you're frequently recycling your application in IIS, very few page requests would benefit from pre-generated views.</span></span>


<span data-ttu-id="a3e53-262">Můžete předem vygenerovat zobrazení pomocí *EdmGen.exe* nástroj příkazového řádku nebo pomocí *Toolkit transformace šablony textu* šablony (T4).</span><span class="sxs-lookup"><span data-stu-id="a3e53-262">You can pre-generate views using the *EdmGen.exe* command-line tool or by using a *Text Template Transformation Toolkit* (T4) template.</span></span> <span data-ttu-id="a3e53-263">V tomto kurzu použijete šablonu T4.</span><span class="sxs-lookup"><span data-stu-id="a3e53-263">In this tutorial you'll use a T4 template.</span></span>

<span data-ttu-id="a3e53-264">V *DAL* složky, přidejte do souboru pomocí **textové šablony** šablony (je v části **Obecné** uzlu v **nainstalované šablony** seznamu), a pojmenujte ho *SchoolModel.Views.tt*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-264">In the *DAL* folder, add a file using the **Text Template** template (it's under the **General** node in the **Installed Templates** list), and name it *SchoolModel.Views.tt*.</span></span> <span data-ttu-id="a3e53-265">Nahraďte stávající kód v souboru následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="a3e53-265">Replace the existing code in the file with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

<span data-ttu-id="a3e53-266">Tento kód vytvoří zobrazení pro *edmx* soubor, který je umístěný ve stejné složce jako šablona a který má stejný název jako soubor šablony.</span><span class="sxs-lookup"><span data-stu-id="a3e53-266">This code generates views for an *.edmx* file that's located in the same folder as the template and that has the same name as the template file.</span></span> <span data-ttu-id="a3e53-267">Například, pokud je název souboru šablony *SchoolModel.Views.tt*, bude hledat soubor modelu dat s názvem *SchoolModel.edmx*.</span><span class="sxs-lookup"><span data-stu-id="a3e53-267">For example, if your template file is named *SchoolModel.Views.tt*, it will look for a data model file named *SchoolModel.edmx*.</span></span>

<span data-ttu-id="a3e53-268">Uložte soubor a pak klikněte pravým tlačítkem na soubor v **Průzkumníka řešení** a vyberte **spustit vlastní nástroj**.</span><span class="sxs-lookup"><span data-stu-id="a3e53-268">Save the file, then right-click the file in **Solution Explorer** and select **Run Custom Tool**.</span></span>

<span data-ttu-id="a3e53-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="a3e53-270">Visual Studio generuje soubor kódu, který vytvoří zobrazení, který se nazývá *SchoolModel.Views.cs* založený na šabloně.</span><span class="sxs-lookup"><span data-stu-id="a3e53-270">Visual Studio generates a code file that creates the views, which is named *SchoolModel.Views.cs* based on the template.</span></span> <span data-ttu-id="a3e53-271">(Možná jste si všimli, že soubor kódu se generuje ještě dřív, než vyberete **spustit vlastní nástroj**, co nejdříve uložte soubor šablony.)</span><span class="sxs-lookup"><span data-stu-id="a3e53-271">(You might have noticed that the code file is generated even before you select **Run Custom Tool**, as soon as you save the template file.)</span></span>

<span data-ttu-id="a3e53-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a3e53-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="a3e53-273">Teď můžete spustit aplikaci a zkontrolujte, jestli funguje stejně jako dříve.</span><span class="sxs-lookup"><span data-stu-id="a3e53-273">You can now run the application and verify that it works as it did before.</span></span>

<span data-ttu-id="a3e53-274">Další informace o předem vygenerovaných zobrazení naleznete na následujících odkazech:</span><span class="sxs-lookup"><span data-stu-id="a3e53-274">For more information about pre-generated views, see the following resources:</span></span>

- <span data-ttu-id="a3e53-275">[Postupy: předem vygenerovat zobrazení ke zlepšení výkonu dotazů](https://msdn.microsoft.com/library/bb896240.aspx) na webové stránce MSDN.</span><span class="sxs-lookup"><span data-stu-id="a3e53-275">[How to: Pre-Generate Views to Improve Query Performance](https://msdn.microsoft.com/library/bb896240.aspx) on the MSDN web site.</span></span> <span data-ttu-id="a3e53-276">Vysvětluje způsob používání `EdmGen.exe` předem vygenerovat zobrazení nástroje příkazového řádku.</span><span class="sxs-lookup"><span data-stu-id="a3e53-276">Explains how to use the `EdmGen.exe` command-line tool to pre-generate views.</span></span>
- <span data-ttu-id="a3e53-277">[Izolaci výkonu pomocí Předkompilovaná/Předprodukčním-generated zobrazení v rozhraní Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) na blogu Windows Server AppFabric zákaznického poradního týmu.</span><span class="sxs-lookup"><span data-stu-id="a3e53-277">[Isolating Performance with Precompiled/Pre-generated Views in the Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) on the Windows Server AppFabric Customer Advisory Team blog.</span></span>

<span data-ttu-id="a3e53-278">Dokončení tohoto postupu Úvod ke zlepšení výkonu ve webové aplikaci ASP.NET, která používá Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="a3e53-278">This completes the introduction to improving performance in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="a3e53-279">Další informace naleznete v následujících materiálech:</span><span class="sxs-lookup"><span data-stu-id="a3e53-279">For more information, see the following resources:</span></span>

- <span data-ttu-id="a3e53-280">[Důležité informace o výkonu (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) na webové stránce MSDN.</span><span class="sxs-lookup"><span data-stu-id="a3e53-280">[Performance Considerations (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) on the MSDN web site.</span></span>
- <span data-ttu-id="a3e53-281">[Související s výkonem příspěvky na blogu týmu Entity Framework](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span><span class="sxs-lookup"><span data-stu-id="a3e53-281">[Performance-related posts on the Entity Framework Team blog](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span></span>
- <span data-ttu-id="a3e53-282">[Možnosti a kompilované dotazy sloučit EF](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span><span class="sxs-lookup"><span data-stu-id="a3e53-282">[EF Merge Options and Compiled Queries](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span></span> <span data-ttu-id="a3e53-283">Blogový příspěvek, který vysvětluje neočekávané chování kompilované dotazy a sloučení možnosti, jako `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="a3e53-283">Blog post that explains unexpected behaviors of compiled queries and merge options such as `NoTracking`.</span></span> <span data-ttu-id="a3e53-284">Pokud máte v plánu použít kompilované dotazy nebo s nastavením možností sloučení v aplikaci, přečtěte si nejprve tuto.</span><span class="sxs-lookup"><span data-stu-id="a3e53-284">If you plan to use compiled queries or manipulate merge option settings in your application, read this first.</span></span>
- <span data-ttu-id="a3e53-285">[Entity Framework související příspěvky v blogu Data a modelování zákaznického poradního týmu](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span><span class="sxs-lookup"><span data-stu-id="a3e53-285">[Entity Framework-related posts in the Data and Modeling Customer Advisory Team blog](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span></span> <span data-ttu-id="a3e53-286">Zahrnuje příspěvky na kompilované dotazy a použít Visual Studio 2010 Profiler ke zjištění problémů s výkonem.</span><span class="sxs-lookup"><span data-stu-id="a3e53-286">Includes posts on compiled queries and using the Visual Studio 2010 Profiler to discover performance issues.</span></span>
- <span data-ttu-id="a3e53-287">[Vlákna ve fóru Entity Framework s Rady, jak ke zlepšení výkonu velice složitých dotazů](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span><span class="sxs-lookup"><span data-stu-id="a3e53-287">[Entity Framework forum thread with advice on improving performance of highly complex queries](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span></span>
- <span data-ttu-id="a3e53-288">[Doporučení pro řízení stavu ASP.NET](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span><span class="sxs-lookup"><span data-stu-id="a3e53-288">[ASP.NET State Management Recommendations](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span></span>
- <span data-ttu-id="a3e53-289">[Použití rozhraní Entity Framework a ObjectDataSource: vlastní stránkování](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span><span class="sxs-lookup"><span data-stu-id="a3e53-289">[Using the Entity Framework and the ObjectDataSource: Custom Paging](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span></span> <span data-ttu-id="a3e53-290">Blogový příspěvek, který staví na ContosoUniversity aplikace vytvořené v těchto kurzech vysvětlují, jak implementovat stránkování v *Departments.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="a3e53-290">Blog post that builds on the ContosoUniversity application created in these tutorials to explain how to implement paging in the *Departments.aspx* page.</span></span>

<span data-ttu-id="a3e53-291">V dalším kurzu kontroly některá důležitá vylepšení rozhraní Entity Framework, které jsou nové ve verzi 4.</span><span class="sxs-lookup"><span data-stu-id="a3e53-291">The next tutorial reviews some of the important enhancements to the Entity Framework that are new in version 4.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a3e53-292">[Předchozí](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
> [další](what-s-new-in-the-entity-framework-4.md)</span><span class="sxs-lookup"><span data-stu-id="a3e53-292">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Next](what-s-new-in-the-entity-framework-4.md)</span></span>
