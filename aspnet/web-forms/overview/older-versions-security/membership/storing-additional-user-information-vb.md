---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
title: Ukládání dalších informací o uživatelích (VB) | Dokumentace Microsoftu
author: rick-anderson
description: V tomto kurzu jsme tuto otázku odpovědět sestavením aplikace vyloženě návštěv. Přitom se podíváme na různé možnosti pro modeli...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: ee4b924e-8002-4dc3-819f-695fca1ff867
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
msc.type: authoredcontent
ms.openlocfilehash: 33e686cc3b977c6c740dfaf1057e1e399d5a298b
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/16/2018
ms.locfileid: "41755308"
---
<a name="storing-additional-user-information-vb"></a><span data-ttu-id="a2b38-104">Ukládání dalších informací o uživatelích (VB)</span><span class="sxs-lookup"><span data-stu-id="a2b38-104">Storing Additional User Information (VB)</span></span>
====================
<span data-ttu-id="a2b38-105">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a2b38-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a2b38-106">[Stáhněte si kód](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) nebo [stahovat PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="a2b38-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span></span>

> <span data-ttu-id="a2b38-107">V tomto kurzu jsme tuto otázku odpovědět sestavením aplikace vyloženě návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="a2b38-108">Současně jsme se podívá na různé možnosti pro modelování informace o uživateli v databázi a poté zjistit, jak tato data přidružit uživatelské účty vytvořené v rámci rozhraní členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>


## <a name="introduction"></a><span data-ttu-id="a2b38-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="a2b38-109">Introduction</span></span>

<span data-ttu-id="a2b38-110">ASP. . NET framework členství nabízí flexibilní rozhraní pro správu uživatelů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="a2b38-111">Toto rozhraní API členství zahrnuje metody ověřují se přihlašovací údaje, načítání informací o aktuálně přihlášeného uživatele, vytvoření nového uživatelského účtu a odstranění uživatelského účtu, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="a2b38-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="a2b38-112">Každý uživatelský účet v rámci členství obsahuje pouze vlastnosti, které jsou nutné pro ověření pověření a provádění úlohy související s účtem základní uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="a2b38-113">To svědčí metody a vlastnosti [ `MembershipUser` třída](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), který modeluje uživatelský účet v rámci členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="a2b38-114">Tato třída obsahuje vlastnosti, jako je [ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), a [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), a metody, jako jsou [ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) a [ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="a2b38-115">Aplikace často, třeba k ukládání dalších informací o uživatelích nejsou zahrnuty v rámci členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="a2b38-116">Online prodejce může být například nutné chcete, aby každý uživatel uložit své přenosů a fakturační adresu, platební údaje, předvolby doručování a kontaktní telefonní číslo.</span><span class="sxs-lookup"><span data-stu-id="a2b38-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="a2b38-117">Kromě toho jednotlivé objednávky v systému je přidružený určitého uživatelského účtu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="a2b38-118">`MembershipUser` Třídy nezahrnuje vlastnosti, jako je `PhoneNumber` nebo `DeliveryPreferences` nebo `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="a2b38-119">Jak jsme sledovat uživatelské informace potřebné pro aplikace a jeho integrovat členství v rámci?</span><span class="sxs-lookup"><span data-stu-id="a2b38-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="a2b38-120">V tomto kurzu jsme tuto otázku odpovědět sestavením aplikace vyloženě návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="a2b38-121">Současně jsme se podívá na různé možnosti pro modelování informace o uživateli v databázi a poté zjistit, jak tato data přidružit uživatelské účty vytvořené v rámci rozhraní členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="a2b38-122">Pusťme se do práce!</span><span class="sxs-lookup"><span data-stu-id="a2b38-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="a2b38-123">Krok 1: Vytvoření aplikace návštěv datového modelu</span><span class="sxs-lookup"><span data-stu-id="a2b38-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="a2b38-124">Existuje řada různých technik, které mohou být použity k zaznamenání informací o uživateli v databázi a přidružit ho k uživatelské účty vytvořené v rámci rozhraní členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="a2b38-125">Aby bylo možné tyto postupy ukazují, budeme muset rozšířit kurz webové aplikace tak, že zachytí nějaký druh uživatelská data.</span><span class="sxs-lookup"><span data-stu-id="a2b38-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="a2b38-126">(V současné době aplikace datový model obsahuje pouze aplikaci služby tabulky vyžadované `SqlMembershipProvider`.)</span><span class="sxs-lookup"><span data-stu-id="a2b38-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="a2b38-127">Vytvoříme aplikaci velmi jednoduché návštěv, ve kterém můžete ověřeného uživatele napište komentář.</span><span class="sxs-lookup"><span data-stu-id="a2b38-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="a2b38-128">Kromě ukládání návštěv komentáře, můžeme povolit každému uživateli ukládat své domácí města, domovskou stránku a podpisu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="a2b38-129">Pokud je zadán, uživatele domácí města, domovskou stránku a podpis se zobrazí v každá zpráva, že není dostupný v knize návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="a2b38-130">Přidávání`GuestbookComments`tabulky</span><span class="sxs-lookup"><span data-stu-id="a2b38-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="a2b38-131">Aby bylo možné zachytit návštěv komentáře, musíme vytvořit tabulku databáze s názvem `GuestbookComments` , který má sloupce jako `CommentId`, `Subject`, `Body`, a `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="a2b38-132">Je také potřeba mít každý záznam `GuestbookComments` uživatele, který zanechal komentář odkaz na tabulku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="a2b38-133">Chcete-li přidat tuto tabulku do databáze, přejít na Průzkumník databáze v sadě Visual Studio a k podrobnostem `SecurityTutorials` databáze.</span><span class="sxs-lookup"><span data-stu-id="a2b38-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="a2b38-134">Klikněte pravým tlačítkem na složku tabulky a zvolte Přidat novou tabulku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="a2b38-135">Tím se zobrazí rozhraní, která umožňuje definovat sloupců nové tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-135">This brings up an interface that allows us to define the columns for the new table.</span></span>


<span data-ttu-id="a2b38-136">[![Přidá novou tabulku SecurityTutorials databáze](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span></span>

<span data-ttu-id="a2b38-137">**Obrázek 1**: Přidat novou tabulku `SecurityTutorials` databáze ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-vb/_static/image3.png))</span></span>


<span data-ttu-id="a2b38-138">Dále definujte `GuestbookComments`na sloupce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="a2b38-139">Začněte přidáním sloupec s názvem `CommentId` typu `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="a2b38-140">V tomto sloupci se jednoznačně identifikovat každou komentář v knize návštěv, tak zakažte `NULL` s a označte ji jako primární klíč v tabulce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="a2b38-141">Místo zadání hodnoty pro `CommentId` pole v každém `INSERT`, jsme můžete určit, že nový `uniqueidentifier` hodnoty by měly být automaticky generovány pro toto pole na `INSERT` nastavením výchozí hodnotu sloupce na `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="a2b38-142">Po přidání tohoto prvního pole, jeho označení jako primární klíč a nastavení jeho výchozí hodnotu, vaše obrazovka by měla vypadat podobně jako obrazovky je vidět na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="a2b38-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>


<span data-ttu-id="a2b38-143">[![Přidejte primární sloupec s názvem CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span></span>

<span data-ttu-id="a2b38-144">**Obrázek 2**: přidejte primární sloupec s názvem `CommentId` ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-vb/_static/image6.png))</span></span>


<span data-ttu-id="a2b38-145">Dále přidejte sloupec s názvem `Subject` typu `nvarchar(50)` a sloupec s názvem `Body` typu `nvarchar(MAX)`, zákaz `NULL` s v obou sloupců.</span><span class="sxs-lookup"><span data-stu-id="a2b38-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="a2b38-146">Pod přidat sloupec s názvem `CommentDate` typu `datetime`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="a2b38-147">Zakázat `NULL` s a nastavte `CommentDate` výchozí hodnotu ve sloupci `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="a2b38-148">Už jen zbývá přidat sloupec, který přidruží účet uživatele každý návštěv komentář.</span><span class="sxs-lookup"><span data-stu-id="a2b38-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="a2b38-149">Jednou z možností je přidat sloupec s názvem `UserName` typu `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="a2b38-150">Toto je vhodnou volbou při používání poskytovatele členství jiné než `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="a2b38-151">Ale při použití `SqlMembershipProvider`, jak se v této řadě kurzů `UserName` sloupec v `aspnet_Users` tabulky nemusí být jedinečný.</span><span class="sxs-lookup"><span data-stu-id="a2b38-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="a2b38-152">`aspnet_Users` Primárního klíče tabulky je `UserId` a je typu `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="a2b38-153">Proto `GuestbookComments` tabulce musí sloupec s názvem `UserId` typu `uniqueidentifier` (Probíhá zakazování `NULL` hodnoty).</span><span class="sxs-lookup"><span data-stu-id="a2b38-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="a2b38-154">Pokračujte a přidat tento sloupec.</span><span class="sxs-lookup"><span data-stu-id="a2b38-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-155">Jak jsme probírali v [ *vytvoření schématu členství v SQL serveru* ](creating-the-membership-schema-in-sql-server-vb.md) výukový program, členství v rámci je navržená k umožnění více webových aplikací s různým uživatelským účtům sdílet stejné úložiště uživatelů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="a2b38-156">Dělá to tak, že dělení uživatelské účty do různých aplikací.</span><span class="sxs-lookup"><span data-stu-id="a2b38-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="a2b38-157">A při každé uživatelské jméno se musí být jedinečný v rámci aplikace, lze použít stejné uživatelské jméno v různých aplikací pomocí stejné úložiště uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="a2b38-158">Je složeného `UNIQUE` omezením v atributu `aspnet_Users` tabulky na `UserName` a `ApplicationId` pole, nikoli však na jenom `UserName` pole.</span><span class="sxs-lookup"><span data-stu-id="a2b38-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="a2b38-159">V důsledku toho je možné, aspnet\_tabulky uživatelé mít dva (nebo více) záznamů se stejným `UserName` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="a2b38-160">Existuje, ale `UNIQUE` omezení `aspnet_Users` tabulky `UserId` pole (protože představuje primární klíč).</span><span class="sxs-lookup"><span data-stu-id="a2b38-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="a2b38-161">A `UNIQUE` omezení je důležité, protože bez něho jsme nejde vytvořit omezení cizího klíče mezi `GuestbookComments` a `aspnet_Users` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>


<span data-ttu-id="a2b38-162">Po přidání `UserId` sloupce, uložte kliknutím na ikonu Uložit na panelu nástrojů v tabulce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="a2b38-163">Pojmenujte novou tabulku `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="a2b38-164">Máme jeden problém poslední věnovat se `GuestbookComments` tabulky: potřebujeme vytvořit [omezení cizího klíče](https://msdn.microsoft.com/library/ms175464.aspx) mezi `GuestbookComments.UserId` sloupce a `aspnet_Users.UserId` sloupce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="a2b38-165">K dosažení tohoto cíle, klikněte na ikonu vztah v panelu nástrojů můžete spustit dialogové okno vztahy cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="a2b38-166">(Alternativně můžete spustit toto dialogové okno tak, že přejdete do nabídky Návrháře tabulky a zvolíte relace.)</span><span class="sxs-lookup"><span data-stu-id="a2b38-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="a2b38-167">Klikněte na tlačítko Přidat v levém dolním rohu dialogu vztahy cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="a2b38-168">Tím se přidá nová omezení cizího klíče, i když ještě nutné definovat tabulek, které se účastní v relaci.</span><span class="sxs-lookup"><span data-stu-id="a2b38-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>


<span data-ttu-id="a2b38-169">[![Ke správě omezení cizího klíče tabulky pomocí dialogového okna cizího klíče](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span></span>

<span data-ttu-id="a2b38-170">**Obrázek 3**: cizí klíč relace dialogu umožňuje spravovat omezení cizího klíče tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-vb/_static/image9.png))</span></span>


<span data-ttu-id="a2b38-171">Klikněte na ikonu tří teček v řádku "Tabulky a sloupce specifikace" na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="a2b38-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="a2b38-172">Tím se spustí dialogovém okně tabulky a sloupce, ze kterého lze zadat primární klíč tabulky a sloupce a sloupce cizího klíče z `GuestbookComments` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="a2b38-173">Zejména `aspnet_Users` a `UserId` jako primární klíč tabulky a sloupce, a `UserId` z `GuestbookComments` tabulce jako sloupec cizího klíče (viz obrázek 4).</span><span class="sxs-lookup"><span data-stu-id="a2b38-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="a2b38-174">Po definování primární a cizí klíče tabulky a sloupce, klikněte na tlačítko OK se vraťte do dialogového okna vztahy cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>


<span data-ttu-id="a2b38-175">[![Vytvoření cizího klíče omezení mezi aspnet_Users a GuesbookComments tabulek](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span></span>

<span data-ttu-id="a2b38-176">**Obrázek 4**: zavést cizího klíče omezení `aspnet_Users` a `GuesbookComments` tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image12.png))</span></span>


<span data-ttu-id="a2b38-177">V tomto okamžiku se vytvořilo omezení cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="a2b38-178">Přítomnost tohoto omezení zajišťuje [relační integrity](http://en.wikipedia.org/wiki/Referential_integrity) mezi dvěma tabulkami ve zaručující, že nikdy bude návštěv položka odkazuje na neexistující uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="a2b38-179">Ve výchozím omezení cizího klíče zakážete nadřazený záznam odstranit, pokud existují odpovídající podřízené záznamy.</span><span class="sxs-lookup"><span data-stu-id="a2b38-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="a2b38-180">To znamená pokud uživatel provede jednu nebo více poznámek návštěv a pak jsme pokus o odstranění tohoto uživatelského účtu, odstranění se nezdaří, pokud jsou jako první smazány jeho návštěv komentáře.</span><span class="sxs-lookup"><span data-stu-id="a2b38-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="a2b38-181">Automaticky odstranit související podřízené záznamy při odstranění záznamu nadřazené lze nastavit omezení cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="a2b38-182">Omezení cizího klíče jsme jinými slovy, můžete nastavit tak, aby uživatele návštěv položky se automaticky odstraní při odstranění svůj uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="a2b38-183">K tomu, rozbalte v části "INSERT a UPDATE specifikace" a "Odstranit pravidlo" vlastnost nastavit na sebe.</span><span class="sxs-lookup"><span data-stu-id="a2b38-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>


<span data-ttu-id="a2b38-184">[![Konfigurace omezení cizího klíče k kaskádové odstranění](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span></span>

<span data-ttu-id="a2b38-185">**Obrázek 5**: Nakonfigurujte omezení pro cizí klíč k kaskádová ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-vb/_static/image15.png))</span></span>


<span data-ttu-id="a2b38-186">Uložit omezení cizího klíče, klikněte na tlačítko Zavřít ukončíte mimo vztahy cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="a2b38-187">Pak klikněte na ikonu Uložit na panelu nástrojů uložte tabulku a tento vztah.</span><span class="sxs-lookup"><span data-stu-id="a2b38-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="a2b38-188">Ukládání Domovská, domovskou stránku a podpis uživatele</span><span class="sxs-lookup"><span data-stu-id="a2b38-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="a2b38-189">`GuestbookComments` Tabulka ukazuje, jak ukládat informace, které sdílí vztah jeden mnoho s uživatelskými účty.</span><span class="sxs-lookup"><span data-stu-id="a2b38-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="a2b38-190">Protože každý uživatelský účet může mít libovolný počet komentářů, tento vztah je modelovaná vytvořením tabulky pro uložení sadu komentáře, která zahrnuje sloupce, odkazuje zpět všechny komentáře s určitým uživatelem.</span><span class="sxs-lookup"><span data-stu-id="a2b38-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="a2b38-191">Při použití `SqlMembershipProvider`, tento odkaz se nejlépe naváže vytvořením sloupec s názvem `UserId` typu `uniqueidentifier` a omezení cizího klíče mezi tento sloupec a `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="a2b38-192">Nyní potřebujeme přidružit každý uživatelský účet pro ukládání domácí města, domovskou stránku a podpis, který se zobrazí v jeho návštěv komentáře uživatele tři sloupce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="a2b38-193">Existuje řada způsobů, jak to provést:</span><span class="sxs-lookup"><span data-stu-id="a2b38-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="a2b38-194"><strong>Přidat nové sloupce</strong><strong>`aspnet_Users`</strong><strong>nebo</strong><strong>`aspnet_Membership`</strong><strong>tabulky.</strong></span><span class="sxs-lookup"><span data-stu-id="a2b38-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="a2b38-195">Můžu by doporučujeme tento přístup, protože upravuje schéma používané `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="a2b38-196">Toto rozhodnutí může vrátit haunt můžete snížit cestách.</span><span class="sxs-lookup"><span data-stu-id="a2b38-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="a2b38-197">Například v co když, budoucí verze technologie ASP.NET používá jiný `SqlMembershipProvider` schématu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="a2b38-198">Microsoft může obsahovat nástroj pro migraci ASP.NET 2.0 `SqlMembershipProvider` dat na nové schéma, ale pokud jste upravili technologii ASP.NET 2.0 `SqlMembershipProvider` schématu, takový převod nemusí být možné.</span><span class="sxs-lookup"><span data-stu-id="a2b38-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="a2b38-199">**Použití prostředí ASP. Profil rozhraní NET definuje vlastnost profilu pro domácí města, domovskou stránku a podpis.**</span><span class="sxs-lookup"><span data-stu-id="a2b38-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="a2b38-200">Technologie ASP.NET obsahuje profil architektura, která je navržená k ukládání další uživatelská data.</span><span class="sxs-lookup"><span data-stu-id="a2b38-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="a2b38-201">Jako jsou členství v rámci profilu framework propojitelnosti podle modelu poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="a2b38-202">Rozhraní .NET Framework se dodává se `SqlProfileProvider` , uloží profilová data v databázi serveru SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a2b38-202">The .NET Framework ships with a `SqlProfileProvider` that stores profile data in a SQL Server database.</span></span> <span data-ttu-id="a2b38-203">Ve skutečnosti naše databáze již obsahuje tabulky používané `SqlProfileProvider` (`aspnet_Profile`), jak byl přidán, když jsme přidali, aplikační služby zpět [ *vytvoření schématu členství v SQL serveru* ](creating-the-membership-schema-in-sql-server-vb.md)kurzu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial.</span></span>   
  <span data-ttu-id="a2b38-204">Hlavní výhodou služby rozhraní framework profilu je, že umožňuje vývojářům definovat vlastnosti profilu v `Web.config` – musí být napsaný pro serializaci dat profilu do a z základnímu úložišti dat. žádný kód.</span><span class="sxs-lookup"><span data-stu-id="a2b38-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="a2b38-205">Stručně řečeno je neuvěřitelně jednoduché definují sadu vlastností profilu a pracovat s nimi v kódu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="a2b38-206">Ale profil systému opustí mnoho dalších požadovaných, pokud jde o do správy verzí, takže pokud máte aplikaci, kde očekáváte, že nové vlastnosti specifické pro uživatele přidat na pozdější dobu, nebo existující aplikace do odebrat nebo změnit, a pak nemusí být v rámci profilu  nejlepší možností.</span><span class="sxs-lookup"><span data-stu-id="a2b38-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="a2b38-207">Kromě toho `SqlProfileProvider` ukládá vlastnosti profilu, které vysoce Nenormalizovaná způsobem, takže další možné ke spouštění dotazů přímo na data profilu (třeba na, kolik uživatelů domácí města v New Yorku).</span><span class="sxs-lookup"><span data-stu-id="a2b38-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="a2b38-208">Další informace o rozhraní profilu najdete v části "Další čtení" na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="a2b38-209"><strong>Tyto tři sloupce přidat do nové tabulky v databázi a vytvořit vztah 1: 1 mezi tuto tabulku a</strong><strong>`aspnet_Users`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="a2b38-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="a2b38-210">Tento přístup vyžaduje trochu více práce než s použitím rozhraní framework profilu, ale nabízí maximální flexibilitu v tom, jak jsou modelovány vlastnosti další uživatele v databázi.</span><span class="sxs-lookup"><span data-stu-id="a2b38-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="a2b38-211">Tato možnost, které používáme v tomto kurzu se.</span><span class="sxs-lookup"><span data-stu-id="a2b38-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="a2b38-212">Vytvoříme nové tabulky nazvané `UserProfiles` uložte domácí města, domovskou stránku a podpis pro každého uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="a2b38-213">Klikněte pravým tlačítkem na složku tabulky v okně Průzkumník databáze a zvolte možnost vytvořit novou tabulku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="a2b38-214">Pojmenujte první sloupec `UserId` a nastavte její typ `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="a2b38-215">Zakázat `NULL` hodnoty a označit jako primární klíč sloupec.</span><span class="sxs-lookup"><span data-stu-id="a2b38-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="a2b38-216">V dalším kroku přidejte sloupce s názvem: `HomeTown` typu `nvarchar(50)`; `HomepageUrl` typu `nvarchar(100)`; a podpis typu `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="a2b38-217">Každá z těchto tří sloupců může přijmout `NULL` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-217">Each of these three columns can accept a `NULL` value.</span></span>


<span data-ttu-id="a2b38-218">[![Vytvoření tabulky UserProfiles](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-218">[![Create the UserProfiles Table](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span></span>

<span data-ttu-id="a2b38-219">**Obrázek 6**: vytvořit `UserProfiles` tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image18.png))</span></span>


<span data-ttu-id="a2b38-220">Uložte tabulku a pojmenujte ho `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="a2b38-221">A konečně navázat omezení cizího klíče mezi `UserProfiles` tabulky `UserId` pole a `aspnet_Users.UserId` pole.</span><span class="sxs-lookup"><span data-stu-id="a2b38-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="a2b38-222">Jako jsme to udělali s omezení cizího klíče mezi `GuestbookComments` a `aspnet_Users` tabulkám, toto omezení kaskádovitě přenést na odstranění.</span><span class="sxs-lookup"><span data-stu-id="a2b38-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="a2b38-223">Protože `UserId` pole v `UserProfiles` je primární klíče, tím se zajistí, že bude existovat více než jeden záznam v `UserProfiles` tabulky pro každý uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="a2b38-224">Tento typ relace se označuje jako 1: 1.</span><span class="sxs-lookup"><span data-stu-id="a2b38-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="a2b38-225">Po vytvoření datového modelu, jsme ho můžete používat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="a2b38-226">V krocích 2 a 3 se podíváme na jak zobrazit a upravit domovského města, domovskou stránku a podpis informace aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="a2b38-227">V kroku 4 vytvoříme rozhraní pro ověření uživatelé posílat nové komentáře návštěv a zobrazení ty stávající.</span><span class="sxs-lookup"><span data-stu-id="a2b38-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="a2b38-228">Krok 2: Zobrazení Domovská, domovskou stránku a podpis uživatele</span><span class="sxs-lookup"><span data-stu-id="a2b38-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="a2b38-229">Existuje řada různých způsobů, jak povolit aktuálně přihlášenému uživateli zobrazit a upravit jeho domovského města, domovskou stránku a podpis informace.</span><span class="sxs-lookup"><span data-stu-id="a2b38-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="a2b38-230">Můžeme ručně vytvořit uživatelské rozhraní pomocí textového pole a ovládací prvky popisku nebo jsme použít jeden z dat webové ovládací prvky, jako je například ovládací prvek DetailsView.</span><span class="sxs-lookup"><span data-stu-id="a2b38-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="a2b38-231">K provedení databáze `SELECT` a `UPDATE` příkazy nám napsat ADO.NET kód ve třídě použití modelu code-behind naši stránku, nebo můžete také využívat deklarativní přístup s ovládacím prvkem SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a2b38-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="a2b38-232">V ideálním případě by naší aplikace obsahoval vrstvené architekturu, která jsme může buď vyvolat prostřednictvím kódu programu z třídy modelu code-behind na stránce nebo deklarativně pomocí ovládacího prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="a2b38-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="a2b38-233">Protože v této sérii kurzů se zaměřuje na ověřování pomocí formulářů, autorizace, uživatelských účtů a rolí, nesmí být vyčerpávající diskusi o tyto možnosti přístupu k datům různých nebo proč vrstvené architektury je upřednostňované nad provádění příkazů SQL přímo na stránce ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a2b38-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="a2b38-234">Teď předvedu provede pomocí prvku DetailsView a SqlDataSource – možnost nejrychlejší a nejjednodušší – ale uvedenou koncepci lze použít jistě alternativní webové ovládací prvky a datová logikou přístupu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="a2b38-235">Další informace o práci s daty v ASP.NET, najdete v mé *[pracovat s daty v ASP.NET 2.0](../../data-access/index.md)* série kurzů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="a2b38-236">Otevřít `AdditionalUserInfo.aspx` stránku `Membership` složky a přidat na stránku, nastavením jeho vlastnosti ID na ovládacím prvku DetailsView `UserProfile` a vymazání jeho `Width` a `Height` vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a2b38-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its ID property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="a2b38-237">Rozbalte ovládacím prvku DetailsView inteligentních značek a zvolte a vytvořte jeho vazbu nový ovládací prvek zdroje dat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="a2b38-238">Tím spustíte Průvodce konfigurací zdroje dat (viz obrázek 7).</span><span class="sxs-lookup"><span data-stu-id="a2b38-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="a2b38-239">Prvním krokem žádostí o zadání typu zdrojového data.</span><span class="sxs-lookup"><span data-stu-id="a2b38-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="a2b38-240">Protože jsme se chystáte připojit přímo `SecurityTutorials` databáze, zvolte ikonu databáze zadání `ID` jako `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>


<span data-ttu-id="a2b38-241">[![Přidat nový ovládací prvek SqlDataSource s názvem UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span></span>

<span data-ttu-id="a2b38-242">**Obrázek 7**: přidejte nový ovládací prvek SqlDataSource název `UserProfileDataSource` ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-vb/_static/image21.png))</span></span>


<span data-ttu-id="a2b38-243">Na další obrazovce zobrazí výzvu pro databáze, kterou chcete použít.</span><span class="sxs-lookup"><span data-stu-id="a2b38-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="a2b38-244">Už jsme definovali připojovacího řetězce v `Web.config` pro `SecurityTutorials` databáze.</span><span class="sxs-lookup"><span data-stu-id="a2b38-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="a2b38-245">Tento název připojovacího řetězce – `SecurityTutorialsConnectionString` – by měla být v rozevíracím seznamu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="a2b38-246">Vyberte tuto možnost a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="a2b38-246">Select this option and click Next.</span></span>


<span data-ttu-id="a2b38-247">[![Z rozevíracího seznamu zvolte SecurityTutorialsConnectionString](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span></span>

<span data-ttu-id="a2b38-248">**Obrázek 8**: Zvolte `SecurityTutorialsConnectionString` z rozevíracího seznamu ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-vb/_static/image24.png))</span></span>


<span data-ttu-id="a2b38-249">Na následující obrazovce se zobrazí výzva k určení tabulky a sloupce do dotazu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="a2b38-250">Zvolte `UserProfiles` tabulky z rozevíracího seznamu a zkontrolovat všechny sloupce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>


<span data-ttu-id="a2b38-251">[![Převést zpět všechny sloupce z tabulky UserProfiles](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span></span>

<span data-ttu-id="a2b38-252">**Obrázek 9**: přeneste zpět všechny sloupce `UserProfiles` tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image27.png))</span></span>


<span data-ttu-id="a2b38-253">Aktuální dotaz vrátí obrázek 9 *všechny* záznamů v `UserProfiles`, ale nás zajímá jenom v záznamu aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="a2b38-254">Chcete-li přidat `WHERE` klauzule, klikněte na tlačítko `WHERE` tlačítko Přidat zobrazíte `WHERE` klauzule dialogové okno (viz obrázek 10).</span><span class="sxs-lookup"><span data-stu-id="a2b38-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="a2b38-255">Tady můžete vybrat sloupec, který se filtrovat, operátor a zdroj daného parametru filtru.</span><span class="sxs-lookup"><span data-stu-id="a2b38-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="a2b38-256">Vyberte `UserId` jako sloupce a "=" jako operátor.</span><span class="sxs-lookup"><span data-stu-id="a2b38-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="a2b38-257">Bohužel neexistuje žádný zdroj integrované parametr vrátit aktuálně přihlášeného uživatele `UserId` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="a2b38-258">Budeme muset zkopírovat tuto hodnotu prostřednictvím kódu programu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="a2b38-259">Proto nastavte zdroj rozevíracího seznamu na "Žádný" klikněte na tlačítko Přidat parametr přidat a klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="a2b38-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>


<span data-ttu-id="a2b38-260">[![Přidání parametru filtr na sloupec UserId](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span></span>

<span data-ttu-id="a2b38-261">**Obrázek 10**: Přidání parametru filtru na `UserId` sloupec ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-vb/_static/image30.png))</span></span>


<span data-ttu-id="a2b38-262">Po kliknutí na tlačítko OK se vrátíte na obrazovku, je znázorněno na obrázku 9.</span><span class="sxs-lookup"><span data-stu-id="a2b38-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="a2b38-263">Tentokrát ale bude příkaz jazyka SQL v dolní části obrazovky by měl obsahovat `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="a2b38-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="a2b38-264">Klikněte na tlačítko Další přejděte obrazovku "Testovat dotaz".</span><span class="sxs-lookup"><span data-stu-id="a2b38-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="a2b38-265">Tady můžete spustit dotaz a zobrazit výsledky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="a2b38-266">Kliknutím na Dokončit dokončíte průvodce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="a2b38-267">Po dokončení Průvodce konfigurací zdroje dat, vytvoří Visual Studio SqlDataSource ovládacího prvku v závislosti na nastaveních určených v průvodci.</span><span class="sxs-lookup"><span data-stu-id="a2b38-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="a2b38-268">Kromě toho ručně přidá BoundFields na ovládacím prvku DetailsView. pro každý sloupec vrácené ovládacím prvkem SqlDataSource `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="a2b38-269">Není nutné zobrazíte `UserId` pole v ovládacím prvku DetailsView, protože uživatel není potřeba znát tuto hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="a2b38-270">Můžete odebrat toto pole přímo v ovládacím prvku DetailsView deklarativní nebo kliknutím na tlačítko "Upravit pole" propojení z jeho inteligentních značek.</span><span class="sxs-lookup"><span data-stu-id="a2b38-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="a2b38-271">Na stránce deklarativní v tuto chvíli by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="a2b38-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample1.aspx)]

<span data-ttu-id="a2b38-272">Budeme potřebovat programově nastavit ovládacím prvkem SqlDataSource `UserId` parametr pro aktuálně přihlášeného uživatele `UserId` předtím, než je vybraná data.</span><span class="sxs-lookup"><span data-stu-id="a2b38-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="a2b38-273">Toho můžete docílit tak, že vytvoříte obslužnou rutinu události pro ovládacím prvkem SqlDataSource `Selecting` událostí a přidáním následujícího kódu existuje:</span><span class="sxs-lookup"><span data-stu-id="a2b38-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample2.vb)]

<span data-ttu-id="a2b38-274">Výše uvedený kód spustí získat odkaz na aktuálně přihlášeného uživatele voláním `Membership` třídy `GetUser` metody.</span><span class="sxs-lookup"><span data-stu-id="a2b38-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="a2b38-275">Tím se vrátí `MembershipUser` objekt, jehož `ProviderUserKey` obsahuje vlastnost `UserId`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="a2b38-276">`UserId` Hodnota je poté přiřazen ve třídě SqlDataSource `@UserId` parametru.</span><span class="sxs-lookup"><span data-stu-id="a2b38-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-277">`Membership.GetUser()` Metoda vrátí informace o aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="a2b38-278">Pokud anonymního uživatele je na stránce, vrátí hodnotu `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-278">If an anonymous user is visiting the page, it will return a value of `Nothing`.</span></span> <span data-ttu-id="a2b38-279">V takovém případě se to bude mít `NullReferenceException` na následující řádek kódu při pokusu o čtení `ProviderUserKey` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a2b38-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="a2b38-280">Samozřejmě, nemáme se starat o `Membership.GetUser()` vrácení ustanovení `AdditionalUserInfo.aspx` stránce, protože jsme nakonfigurovali autorizace adres URL v předchozím kurzu tak, aby jenom ověření uživatelé můžou přistupovat k prostředkům ASP.NET v této složce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-280">Of course, we don't have to worry about `Membership.GetUser()` returning Nothing in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="a2b38-281">Pokud potřebujete přístup k informacím o aktuálně přihlášeného uživatele na stránce, kde je povolen anonymní přístup, ujistěte se, že zkontroluje, jestli `MembershipUser` objekt vrácený z `GetUser()` metoda není nic před odkazování na její vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a2b38-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that the `MembershipUser` object returned from the `GetUser()` method is not Nothing before referencing its properties.</span></span>


<span data-ttu-id="a2b38-282">Pokud navštívíte `AdditionalUserInfo.aspx` stránky prostřednictvím prohlížeče se zobrazí prázdnou stránku, protože musíme ještě přidat všechny řádky `UserProfiles` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="a2b38-283">V kroku 6 se podíváme na tom, jak přizpůsobit ovládacím prvku CreateUserWizard automaticky přidáte nový řádek `UserProfiles` tabulky, když se vytvoří nový uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="a2b38-284">Prozatím se však budeme muset ručně vytvořit záznam v tabulce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="a2b38-285">Přejděte do Průzkumníku databází v sadě Visual Studio a rozbalte složku tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="a2b38-286">Klikněte pravým tlačítkem na `aspnet_Users` tabulky a zvolte "Zobrazit Data tabulky" Pokud chcete zobrazit záznamy v tabulce; stejnou věc udělat `UserProfiles` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="a2b38-287">Obrázek 11 zobrazí tyto výsledky při svisle vedle sebe.</span><span class="sxs-lookup"><span data-stu-id="a2b38-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="a2b38-288">V databázi nejsou aktuálně `aspnet_Users` záznamy pro Bruce Fred a Tito, ale žádné záznamy v `UserProfiles` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>


<span data-ttu-id="a2b38-289">[![Zobrazí se obsah aspnet_Users a UserProfiles tabulek](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span></span>

<span data-ttu-id="a2b38-290">**Obrázek 11**: obsah `aspnet_Users` a `UserProfiles` tabulky se zobrazí ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-vb/_static/image33.png))</span></span>


<span data-ttu-id="a2b38-291">Přidání nového záznamu `UserProfiles` tabulky ručním zadáním hodnoty pro `HomeTown`, `HomepageUrl`, a `Signature` pole.</span><span class="sxs-lookup"><span data-stu-id="a2b38-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="a2b38-292">Nejjednodušší způsob, jak získat platný `UserId` hodnotu v novém `UserProfiles` záznamu je výběr `UserId` pole z určitého uživatelského účtu v `aspnet_Users` tabulky a zkopírujte a vložte ho do `UserId` pole `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="a2b38-293">Obrázek 12 se zobrazí `UserProfiles` tabulky po přidání nového záznamu pro Bruce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>


<span data-ttu-id="a2b38-294">[![Záznam byl přidán do UserProfiles pro Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span></span>

<span data-ttu-id="a2b38-295">**Obrázek 12**: záznam A přidal do `UserProfiles` pro Bruce ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-vb/_static/image36.png))</span></span>


<span data-ttu-id="a2b38-296">Vraťte se `AdditionalUserInfo.aspx page`, přihlášen jako Bruce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-296">Return to the `AdditionalUserInfo.aspx page`, logged in as Bruce.</span></span> <span data-ttu-id="a2b38-297">Jak ukazuje obrázek 13, se zobrazují Bruce jeho nastavení.</span><span class="sxs-lookup"><span data-stu-id="a2b38-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>


<span data-ttu-id="a2b38-298">[![Aktuálně návštěvě uživatele se zobrazí jeho nastavení](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span></span>

<span data-ttu-id="a2b38-299">**Obrázek 13**: aktuálně návštěvě uživatele se zobrazí jeho nastavení ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-vb/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a2b38-300">Přejít dopředu a ručně přidávat záznamy `UserProfiles` tabulky pro každého uživatele se členstvím.</span><span class="sxs-lookup"><span data-stu-id="a2b38-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="a2b38-301">V kroku 6 se podíváme na tom, jak přizpůsobit ovládacím prvku CreateUserWizard automaticky přidáte nový řádek `UserProfiles` tabulky, když se vytvoří nový uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>


## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="a2b38-302">Krok 3: Které uživateli umožňují upravit jeho Domovská stránka městě, domovskou stránku a podpis</span><span class="sxs-lookup"><span data-stu-id="a2b38-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="a2b38-303">V tomto okamžiku můžete zobrazit aktuálně přihlášeného uživatele jejich domovské města, domovskou stránku a podpis nastavení, ale ještě je nemohou upravovat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="a2b38-304">Umožňuje aktualizovat ovládacím prvku DetailsView tak, aby data lze upravovat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="a2b38-305">První věc musíme udělat, je přidat `UpdateCommand` pro ovládacím prvkem SqlDataSource zadání `UPDATE` příkazu ke spuštění a jeho odpovídající parametry.</span><span class="sxs-lookup"><span data-stu-id="a2b38-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="a2b38-306">Vyberte ve třídě SqlDataSource a v okně Vlastnosti klikněte na symbol tří teček vedle vlastnosti UpdateQuery zobrazíte dialogové okno Editor příkazů a parametrů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="a2b38-307">Zadejte následující `UPDATE` příkaz do textového pole:</span><span class="sxs-lookup"><span data-stu-id="a2b38-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-vb/samples/sample3.sql)]

<span data-ttu-id="a2b38-308">Klikněte na tlačítko "Aktualizovat parametry", který vytvoří parametr v ovládacím prvkem SqlDataSource `UpdateParameters` kolekce pro každý z parametrů v `UPDATE` příkazu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="a2b38-309">Ponechte na žádný zdroj pro všechny sady parametrů a klikněte na tlačítko OK se vyplňte dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="a2b38-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>


<span data-ttu-id="a2b38-310">[![Zadejte vlastnost UpdateCommand ve třídě SqlDataSource a UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span></span>

<span data-ttu-id="a2b38-311">**Obrázek 14**: zadejte ve třídě SqlDataSource `UpdateCommand` a `UpdateParameters` ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-vb/_static/image42.png))</span></span>


<span data-ttu-id="a2b38-312">Z důvodu dodatky jsme provedli SqlDataSource ovládacího prvku DetailsView ovládací prvek nyní podporuje úpravy.</span><span class="sxs-lookup"><span data-stu-id="a2b38-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="a2b38-313">V ovládacím prvku DetailsView inteligentních značek zaškrtněte políčko "Povolit úpravy".</span><span class="sxs-lookup"><span data-stu-id="a2b38-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="a2b38-314">Tento postup přidá ovládacího prvku CommandField `Fields` kolekce s jeho `ShowEditButton` nastavenou na hodnotu True.</span><span class="sxs-lookup"><span data-stu-id="a2b38-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="a2b38-315">Tím zkopírujete tlačítko pro úpravy v ovládacím prvku DetailsView je zobrazen v režimu jen pro čtení a aktualizace a tlačítka Storno při zobrazení v režimu úprav.</span><span class="sxs-lookup"><span data-stu-id="a2b38-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="a2b38-316">Místo by uživatel musel kliknout na upravit, ale můžeme nechat vykreslování prvku DetailsView. ve stavu "vždy upravitelné" tak, že nastavíte ovládacím prvku DetailsView [ `DefaultMode` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) k `Edit`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="a2b38-317">S těmito změnami prvku DetailsView deklarativní by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="a2b38-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample4.aspx)]

<span data-ttu-id="a2b38-318">Poznámka: Přidání CommandField a `DefaultMode` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a2b38-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="a2b38-319">Pokračujte a otestovat tuto stránku prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="a2b38-320">Při návštěvě jako uživatel, který nemá odpovídající záznam v `UserProfiles`, nastavení uživatele se zobrazí v upravitelné rozhraní.</span><span class="sxs-lookup"><span data-stu-id="a2b38-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>


<span data-ttu-id="a2b38-321">[![Vykreslí upravitelné rozhraní ovládacím prvku DetailsView.](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span></span>

<span data-ttu-id="a2b38-322">**Obrázek 15**: ovládacím prvku DetailsView. vykreslí upravitelné rozhraní ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-vb/_static/image45.png))</span></span>


<span data-ttu-id="a2b38-323">Zkuste změna hodnoty a kliknutím na tlačítko Aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="a2b38-324">Zdá se, jak je, že se nic nestalo.</span><span class="sxs-lookup"><span data-stu-id="a2b38-324">It appears as if nothing happens.</span></span> <span data-ttu-id="a2b38-325">Je zpětné volání a hodnoty se uloží do databáze, ale neexistuje žádný vizuální zpětnou vazbu, ke které došlo uložit.</span><span class="sxs-lookup"><span data-stu-id="a2b38-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="a2b38-326">Chcete-li to napravit, vraťte se do sady Visual Studio a přidejte ovládací prvek popisek nad ovládacím prvku DetailsView.</span><span class="sxs-lookup"><span data-stu-id="a2b38-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="a2b38-327">Nastavte jeho `ID` k `SettingsUpdatedMessage`, jeho `Text` vlastnost "vaše nastavení bylo aktualizováno," a jeho `Visible` a `EnableViewState` vlastností `False`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `False`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample5.aspx)]

<span data-ttu-id="a2b38-328">Potřebujeme zobrazíte `SettingsUpdatedMessage` popisek pokaždé, když se aktualizuje ovládacím prvku DetailsView.</span><span class="sxs-lookup"><span data-stu-id="a2b38-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="a2b38-329">K tomu vytvořit obslužnou rutinu události pro ovládacím prvku DetailsView `ItemUpdated` událostí a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="a2b38-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample6.vb)]

<span data-ttu-id="a2b38-330">Vraťte se `AdditionalUserInfo.aspx` stránce prostřednictvím prohlížeče a aktualizovat data.</span><span class="sxs-lookup"><span data-stu-id="a2b38-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="a2b38-331">Tentokrát, zobrazí se užitečné stavovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-331">This time, a helpful status message is displayed.</span></span>


<span data-ttu-id="a2b38-332">[![Krátký zpráva se zobrazí při nastavení jsou aktualizovány](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span></span>

<span data-ttu-id="a2b38-333">**Obrázek 16**: při aktualizaci nastavení, zobrazí se zpráva A krátký ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-vb/_static/image48.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a2b38-334">Ovládacím prvku DetailsView uživatele úpravy ponechá rozhraní být požadovaného mnoho dalších.</span><span class="sxs-lookup"><span data-stu-id="a2b38-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="a2b38-335">Používá standardní velikosti textová pole, ale podpis pole by měl pravděpodobně být ve víceřádkovém textovém poli.</span><span class="sxs-lookup"><span data-stu-id="a2b38-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="a2b38-336">RegularExpressionValidator by měla sloužit k zajištění, že adresa URL domovské stránky, je-li zadán, začne řetězcem "http://" nebo "https://".</span><span class="sxs-lookup"><span data-stu-id="a2b38-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="a2b38-337">Kromě toho od ovládacím prvku DetailsView. ovládací prvek má jeho `DefaultMode` nastavenou na `Edit`, tlačítko Storno nedělá.</span><span class="sxs-lookup"><span data-stu-id="a2b38-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="a2b38-338">Ji by měl buď odebrat nebo po kliknutí na přesměruje uživatele na jinou stránku (například `~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="a2b38-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="a2b38-339">Tato vylepšení opuštění jako cvičení pro čtečku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-339">I leave these enhancements as an exercise for the reader.</span></span>


### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="a2b38-340">Přidání odkazu`AdditionalUserInfo.aspx`stránky na stránce předlohy</span><span class="sxs-lookup"><span data-stu-id="a2b38-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="a2b38-341">V současné době webu neposkytuje žádné odkazy na `AdditionalUserInfo.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="a2b38-342">Jediný způsob, jak k němu přistoupit je zadejte adresu URL stránky přímo do panelu Adresa prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a2b38-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="a2b38-343">Přidáme odkaz na tuto stránku `Site.master` stránky předlohy.</span><span class="sxs-lookup"><span data-stu-id="a2b38-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="a2b38-344">Připomínáme, že hlavní stránka obsahuje ovládacího prvku LoginView Web v jeho `LoginContent` ContentPlaceHolder zobrazující různých značek pro návštěvníky ověřený a anonymní.</span><span class="sxs-lookup"><span data-stu-id="a2b38-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="a2b38-345">Aktualizovat ovládacího prvku LoginView `LoggedInTemplate` zahrnout odkaz `AdditionalUserInfo.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="a2b38-346">Po provedení těchto změn LoginView deklarativní ovládacího prvku by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="a2b38-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample7.aspx)]

<span data-ttu-id="a2b38-347">Poznámka: přidání `lnkUpdateSettings` ovládacího prvku hypertextový odkaz `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="a2b38-348">S tímto odkazem na místě ověřeným uživatelům rychle přejít na stránku lze zobrazit a upravit domovského města, domovskou stránku a podpis nastavení.</span><span class="sxs-lookup"><span data-stu-id="a2b38-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="a2b38-349">Krok 4: Přidání nových komentářů návštěv</span><span class="sxs-lookup"><span data-stu-id="a2b38-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="a2b38-350">`Guestbook.aspx` Je stránka, kde můžete ověřeným uživatelům zobrazit návštěv a napište komentář.</span><span class="sxs-lookup"><span data-stu-id="a2b38-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="a2b38-351">Začněme s vytvářením rozhraní pro přidání nového komentáře návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="a2b38-352">Otevřít `Guestbook.aspx` stránce v sadě Visual Studio a vytvořit uživatelské rozhraní, který se skládá ze dvou ovládacích prvků textového pole, jeden pro nový komentář předmětu a jeden pro jeho tělo.</span><span class="sxs-lookup"><span data-stu-id="a2b38-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="a2b38-353">Nastavení prvního textového pole ovládacího prvku `ID` vlastnost `Subject` a jeho `Columns` vlastnost 40; nastavit druhé `ID` k `Body`, jeho `TextMode` k `MultiLine`a jeho `Width` a `Rows` Vlastnosti "95 %", 8, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="a2b38-354">K dokončení uživatelského rozhraní, přidejte ovládací prvek tlačítko Web s názvem `PostCommentButton` a nastavte jeho `Text` vlastnost "Napsat svůj komentář".</span><span class="sxs-lookup"><span data-stu-id="a2b38-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="a2b38-355">Protože každý návštěv komentář vyžaduje předmět a text, přidáte RequiredFieldValidator pro každou z textových polí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="a2b38-356">Nastavte `ValidationGroup` vlastnosti těchto ovládacích prvků na "EnterComment"; nastavte `PostCommentButton` ovládacího prvku `ValidationGroup` vlastnost "EnterComment".</span><span class="sxs-lookup"><span data-stu-id="a2b38-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="a2b38-357">Další informace o ASP. Ovládací prvky ověřování NET společnosti, prohlédněte si [ověřování formuláře v technologii ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [rozbor validačních ovládacích prvků v technologii ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)a [kurzu ovládací prvky serveru ověřování](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) na [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="a2b38-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="a2b38-358">Po vytvoření uživatelského rozhraní na stránce deklarativní by měl vypadat přibližně takto:</span><span class="sxs-lookup"><span data-stu-id="a2b38-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample8.aspx)]

<span data-ttu-id="a2b38-359">Dokončení uživatelského rozhraní, naše dalším krokem je vložení nového záznamu do `GuestbookComments` tabulky, když `PostCommentButton` dojde ke kliknutí na.</span><span class="sxs-lookup"><span data-stu-id="a2b38-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="a2b38-360">To lze provést různými způsoby: jsme napsali kód, ADO.NET na tlačítku `Click` obslužné rutiny události; jsme můžete přidat ovládací prvek SqlDataSource na stránku, konfigurovat jeho `InsertCommand`a poté zavolejte jeho `Insert` metody z `Click` událostí Obslužná rutina; nebo může vytváříme střední vrstvy, která je zodpovědná za vkládání nových komentářů návštěv a vyvolání této funkce `Click` obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="a2b38-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="a2b38-361">Protože jsme se podívali na použití SqlDataSource v kroku 3, použijeme kódu ADO.NET tady.</span><span class="sxs-lookup"><span data-stu-id="a2b38-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-362">Třídy rozhraní ADO.NET pro programově přístup k datům z databáze Microsoft SQL serveru se nacházejí v `System.Data.SqlClient` oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="a2b38-363">Budete muset tento obor názvů naimportujte třída použití modelu code-behind na stránce (například `Imports System.Data.SqlClient`).</span><span class="sxs-lookup"><span data-stu-id="a2b38-363">You may need to import this namespace into your page's code-behind class (i.e., `Imports System.Data.SqlClient`).</span></span>


<span data-ttu-id="a2b38-364">Vytvořte obslužnou rutinu události pro `PostCommentButton`společnosti `Click` událostí a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="a2b38-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample9.vb)]

<span data-ttu-id="a2b38-365">`Click` Spustí obslužnou rutinu události tak, že zkontrolujete, že uživatelský data nejsou platná.</span><span class="sxs-lookup"><span data-stu-id="a2b38-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="a2b38-366">Pokud není, obslužná rutina události ukončí před vložení záznamu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="a2b38-367">Za předpokladu, že platnost zadaných dat aktuálně přihlášeného uživatele `UserId` hodnota je načtena a uložena v `currentUserId` místní proměnné.</span><span class="sxs-lookup"><span data-stu-id="a2b38-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="a2b38-368">Tato hodnota je potřeba, proto jsme musí zadat `UserId` hodnotu, pokud vložení záznamu do `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="a2b38-369">Pod připojovacího řetězce pro `SecurityTutorials` databáze je načten z `Web.config` a `INSERT` zadaný příkaz jazyka SQL.</span><span class="sxs-lookup"><span data-stu-id="a2b38-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="a2b38-370">A `SqlConnection` objekt je pak vytvořit a otevřít.</span><span class="sxs-lookup"><span data-stu-id="a2b38-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="a2b38-371">Další, `SqlCommand` objekt je vytvořen a hodnoty pro parametry používané `INSERT` dotazu jsou přiřazeny.</span><span class="sxs-lookup"><span data-stu-id="a2b38-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="a2b38-372">`INSERT` Poté je proveden příkaz a připojení ukončeno.</span><span class="sxs-lookup"><span data-stu-id="a2b38-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="a2b38-373">Na konci obslužná rutina události `Subject` a `Body` textová pole `Text` vlastnosti jsou odstraněné tak, aby uživatele hodnoty se zachová pro zpětné volání.</span><span class="sxs-lookup"><span data-stu-id="a2b38-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="a2b38-374">Pokračujte a otestovat na této stránce v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="a2b38-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="a2b38-375">Vzhledem k tomu, že se tato stránka `Membership` složky není přístupná pro anonymní návštěvníky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="a2b38-376">Proto je potřeba nejdřív přihlásit (Pokud nemáte).</span><span class="sxs-lookup"><span data-stu-id="a2b38-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="a2b38-377">Zadejte hodnotu do `Subject` a `Body` textová pole a klikněte na tlačítko `PostCommentButton` tlačítko.</span><span class="sxs-lookup"><span data-stu-id="a2b38-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="a2b38-378">To způsobí, že nový záznam přidat do `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="a2b38-379">Na zpětné volání předmět a text, který jste zadali vymažou z textových polí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="a2b38-380">Po kliknutí `PostCommentButton` tlačítko zde není žádný vizuální zpětnou vazbu, který byl komentář přidán do návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="a2b38-381">Stále potřebujeme aktualizovat tuto stránku a zobrazovat existující návštěv komentáře, které budeme provádět v kroku 5.</span><span class="sxs-lookup"><span data-stu-id="a2b38-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="a2b38-382">Jakmile jsme to udělat, jen přidat komentář se zobrazí v seznamu komentářů, zajištění adekvátní vizuální zpětnou vazbu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="a2b38-383">Teď, potvrďte, že byla uložena komentář návštěv prozkoumáním obsah `GuestbookComments` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="a2b38-384">Obrázek 17 zobrazí obsah `GuestbookComments` tabulky po zbývá dvě komentáře.</span><span class="sxs-lookup"><span data-stu-id="a2b38-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>


<span data-ttu-id="a2b38-385">[![Zobrazí se návštěv komentáře v tabulce GuestbookComments](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span></span>

<span data-ttu-id="a2b38-386">**Obrázek 17**: Zobrazí se návštěv komentáře v `GuestbookComments` tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image51.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a2b38-387">Pokud se uživatel pokusí vložit návštěv komentář, který obsahuje potenciálně nebezpečné – například kód HTML – ASP.NET vyvolá `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="a2b38-388">Další informace o této výjimky, proč je vyvolána, a jak povolit uživatelům odesílat potenciálně nebezpečné hodnoty, najdete [dokument White Paper žádost o ověření](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="a2b38-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>


## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="a2b38-389">Krok 5: Výpis existující komentáře návštěv</span><span class="sxs-lookup"><span data-stu-id="a2b38-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="a2b38-390">Kromě zanechání komentáře, může uživatel navštívit `Guestbook.aspx` stránka také měl zobrazit existující komentáře návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="a2b38-391">Chcete-li to provést, přidejte ovládací prvek ListView s názvem `CommentList` do dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-392">Ovládací prvek ListView je nová technologie ASP.NET, verze 3.5.</span><span class="sxs-lookup"><span data-stu-id="a2b38-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="a2b38-393">Je určená k zobrazení seznamu položek ve vysoce přizpůsobitelné a flexibilní rozložení, ale stále nabízet integrované úprava, vkládání, odstraňování, stránkování a řazení funkce, jako jsou prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="a2b38-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="a2b38-394">Pokud používáte technologii ASP.NET 2.0, musíte místo toho pomocí ovládacího prvku DataList nebo Repeater.</span><span class="sxs-lookup"><span data-stu-id="a2b38-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="a2b38-395">Další informace o použití ListView, naleznete v tématu [Scott Guthrie](https://weblogs.asp.net/scottgu/)na blogu, [asp: ListView ovládací prvek](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)a my článku [zobrazení dat pomocí ovládacího prvku ListView](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>


<span data-ttu-id="a2b38-396">Otevřít inteligentní značky prvku ListView a z rozevíracího seznamu zvolit zdroj dat vazbu ovládacího prvku na nový zdroj dat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="a2b38-397">Jak jsme viděli v kroku 2, tím spustíte Průvodce konfigurací zdroje dat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="a2b38-398">Vyberte ikonu databáze, název výsledný SqlDataSource `CommentsDataSource`a klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="a2b38-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="a2b38-399">V dalším kroku vyberte `SecurityTutorialsConnectionString` připojovací řetězec z rozevíracího seznamu a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="a2b38-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="a2b38-400">V tomto okamžiku v kroku 2 jsme zadali data dotazu podle výběru `UserProfiles` tabulky z rozevíracího seznamu a vyberte sloupce, které chcete vrátit (vrátit zpět k obrázek 9).</span><span class="sxs-lookup"><span data-stu-id="a2b38-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="a2b38-401">Tentokrát, ale chceme vytvořit příkaz SQL, který si vyžádá zpět nejen záznamy ze `GuestbookComments`, ale také komentátor domácí města, domovskou stránku, podpisu a uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="a2b38-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="a2b38-402">Proto vyberte přepínač "Zadejte vlastní příkaz SQL nebo uloženou proceduru" a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="a2b38-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="a2b38-403">Tím se otevře na obrazovce "Definovat vlastní příkazy nebo uložené procedury".</span><span class="sxs-lookup"><span data-stu-id="a2b38-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="a2b38-404">Kliknutím na tlačítko Tvůrce dotazů graficky sestavení dotazu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="a2b38-405">Tvůrce dotazů spustí s výzvou k určení, které chceme dotaz z tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="a2b38-406">Vyberte `GuestbookComments`, `UserProfiles`, a `aspnet_Users` tabulky a klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="a2b38-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="a2b38-407">Tím přidáte všechny tři tabulky na návrhovou plochu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="a2b38-408">Protože existují omezení cizího klíče mezi `GuestbookComments`, `UserProfiles`, a `aspnet_Users` tabulky, Tvůrce dotazů automaticky `JOIN` s těchto tabulek.</span><span class="sxs-lookup"><span data-stu-id="a2b38-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="a2b38-409">Už jen zbývá určit sloupce, které chcete vrátit.</span><span class="sxs-lookup"><span data-stu-id="a2b38-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="a2b38-410">Z `GuestbookComments` tabulce vyberte `Subject`, `Body`, a `CommentDate` sloupce; vrátit `HomeTown`, `HomepageUrl`, a `Signature` sloupce z `UserProfiles` tabulky; a vrátit `UserName` z `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="a2b38-411">Přidejte také "`ORDER BY CommentDate DESC`" na konci `SELECT` dotaz tak, aby nejnovější příspěvky jsou vrácena jako první.</span><span class="sxs-lookup"><span data-stu-id="a2b38-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="a2b38-412">Po provedení tento výběr, vypadat podobně jako na snímek v 18 obrázek obrazovky rozhraní Tvůrce dotazů.</span><span class="sxs-lookup"><span data-stu-id="a2b38-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>


<span data-ttu-id="a2b38-413">[![Constructed dotaz spojí GuestbookComments, UserProfiles a aspnet_Users tabulky](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span></span>

<span data-ttu-id="a2b38-414">**Obrázek 18**: dotaz vytvořený `JOIN` s `GuestbookComments`, `UserProfiles`, a `aspnet_Users` tabulky ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image54.png))</span></span>


<span data-ttu-id="a2b38-415">Kliknutím na OK zavřete okno editoru dotazů a návrat na obrazovku "Definovat vlastní příkazy nebo uložené procedury".</span><span class="sxs-lookup"><span data-stu-id="a2b38-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="a2b38-416">Klikněte na tlačítko vedle záloh na obrazovku "Testovat dotaz", kde můžete zobrazit výsledky dotazu po kliknutí na tlačítko Testovat dotaz.</span><span class="sxs-lookup"><span data-stu-id="a2b38-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="a2b38-417">Jakmile budete připraveni, klikněte na tlačítko Dokončit dokončete průvodce pro zdroj dat nakonfigurovat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="a2b38-418">Když jsme dokončili Průvodce konfigurace zdroje dat v kroku 2, přiřazeném ovládacím prvku DetailsView `Fields` kolekce bylo aktualizováno, aby zahrnovalo Vlastnost BoundField pro každý sloupec vrácený `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="a2b38-419">ListView, ale zůstávají beze změn; stále potřebujeme definovat jeho rozložení.</span><span class="sxs-lookup"><span data-stu-id="a2b38-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="a2b38-420">Rozložení ListView lze sestavit ručně prostřednictvím jeho deklarativním označení nebo z možnosti "ListView konfigurace" v jeho inteligentních značek.</span><span class="sxs-lookup"><span data-stu-id="a2b38-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="a2b38-421">Můžu obvykle raději ručně definování značky, ale pomocí libovolné metody je nejvíce přirozené pro vás.</span><span class="sxs-lookup"><span data-stu-id="a2b38-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="a2b38-422">Můžu skončila pomocí následujících `LayoutTemplate`, `ItemTemplate`, a `ItemSeparatorTemplate` pro ovládací prvek ListView:</span><span class="sxs-lookup"><span data-stu-id="a2b38-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample10.aspx)]

<span data-ttu-id="a2b38-423">`LayoutTemplate` Definuje kód, protože ho vygeneroval ovládacího prvku, zatímco `ItemTemplate` vykreslí každé položky vrácené ovládacím prvkem SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a2b38-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="a2b38-424">`ItemTemplate`Výsledný kód je umístěn v `LayoutTemplate`společnosti `itemPlaceholder` ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="a2b38-425">Kromě `itemPlaceholder`, `LayoutTemplate` obsahuje ovládací prvek DataPager, který omezuje ListView zobrazuje jenom 10 návštěv komentáře na jedné stránce (výchozí) a vykreslí je stránkovací rozhraní.</span><span class="sxs-lookup"><span data-stu-id="a2b38-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="a2b38-426">Moje `ItemTemplate` zobrazí subjekt každý návštěv komentář `<h4>` element s text nacházející se pod předmět.</span><span class="sxs-lookup"><span data-stu-id="a2b38-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="a2b38-427">Mějte na paměti, že syntaxe pro zobrazení textu trvá dat vrácených `Eval("Body")` příkaz vázání dat, převede ho na řetězec a nahradí konců řádků s `<br />` elementu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="a2b38-428">Chcete-li zobrazit konce řádků zadaný při odesílání komentáře, protože prázdné znaky je ignorován v HTML je potřeba tento převod.</span><span class="sxs-lookup"><span data-stu-id="a2b38-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="a2b38-429">Podpis uživatele se zobrazí pod text kurzívou, za nímž následuje uživatele domácí města, odkaz na jeho domovské stránky, datum a čas, který byl proveden komentář a uživatelské jméno osoby, který zanechal komentář.</span><span class="sxs-lookup"><span data-stu-id="a2b38-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="a2b38-430">Pokud chcete zobrazit stránku prostřednictvím prohlížeče chvíli trvat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="a2b38-431">Měli byste vidět poznámky, které jste přidali do návštěv v kroku 5, tady zobrazí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>


<span data-ttu-id="a2b38-432">[![Guestbook.aspx pak zobrazí návštěv komentáře](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span></span>

<span data-ttu-id="a2b38-433">**Obrázek 19**: `Guestbook.aspx` se teď zobrazují poznámky návštěv ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-vb/_static/image57.png))</span></span>


<span data-ttu-id="a2b38-434">Zkuste přidat nový komentář návštěv.</span><span class="sxs-lookup"><span data-stu-id="a2b38-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="a2b38-435">Po kliknutí `PostCommentButton` tlačítko stránce odešle zpět a přidá komentář do databáze, ale ovládací prvek ListView se aktualizuje a zobrazí nový komentář.</span><span class="sxs-lookup"><span data-stu-id="a2b38-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="a2b38-436">To je možné vyřešit buď:</span><span class="sxs-lookup"><span data-stu-id="a2b38-436">This can be fixed by either:</span></span>

- <span data-ttu-id="a2b38-437">Aktualizuje `PostCommentButton` tlačítka `Click` obslužná rutina události tak, že vyvolá ovládacího prvku ListView `DataBind()` metoda po vložení nového komentáře do databáze, nebo</span><span class="sxs-lookup"><span data-stu-id="a2b38-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="a2b38-438">Nastavení ovládacího prvku ListView `EnableViewState` vlastnost `False`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-438">Setting the ListView control's `EnableViewState` property to `False`.</span></span> <span data-ttu-id="a2b38-439">Tento přístup funguje, protože tím, že zakážete stav zobrazení ovládacího prvku, třeba rebind na podkladová data při každém postbacku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="a2b38-440">Ke stažení z tohoto kurzu na webu kurz ukazuje obě tyto metody.</span><span class="sxs-lookup"><span data-stu-id="a2b38-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="a2b38-441">Ovládací prvek ListView `EnableViewState` vlastnost `False` a je k dispozici v kódu potřeby prostřednictvím kódu programu znovu připojit data, která mají ListView `Click` obslužná rutina události, ale je zakomentovaný.</span><span class="sxs-lookup"><span data-stu-id="a2b38-441">The ListView control's `EnableViewState` property to `False` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-442">Aktuálně `AdditionalUserInfo.aspx` stránky umožňuje uživateli zobrazit a upravit domovského města, domovskou stránku a podpis nastavení.</span><span class="sxs-lookup"><span data-stu-id="a2b38-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="a2b38-443">Může být dobré si aktualizovat `AdditionalUserInfo.aspx` zobrazíte přihlášeného uživatele návštěv komentáře.</span><span class="sxs-lookup"><span data-stu-id="a2b38-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="a2b38-444">To znamená, kromě přezkoumání a úprava její informace, může uživatel navštívit `AdditionalUserInfo.aspx` stránku, abyste viděli, jaké návštěv komentáře, které se provádí v minulosti.</span><span class="sxs-lookup"><span data-stu-id="a2b38-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="a2b38-445">Můžu ponechte toto cvičení pro dotčené čtečku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-445">I leave this as an exercise for the interested reader.</span></span>


## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="a2b38-446">Krok 6: Přizpůsobení ovládacího prvku CreateUserWizard zahrnout rozhraní pro Domovská, domovskou stránku a podpis</span><span class="sxs-lookup"><span data-stu-id="a2b38-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="a2b38-447">`SELECT` Dotazu použitého `Guestbook.aspx` stránce používá `INNER JOIN` kombinování souvisejících záznamů mimo `GuestbookComments`, `UserProfiles`, a `aspnet_Users` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="a2b38-448">Pokud uživatel, který nemá žádný záznam v `UserProfiles` bude návštěv připomínky, komentáře se nezobrazí ListView, protože `INNER JOIN` vrátí jenom `GuestbookComments` záznamů, pokud jsou k dispozici odpovídající záznamy v `UserProfiles` a `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="a2b38-449">A jak jsme viděli v kroku 3, pokud uživatel nemá záznamu `UserProfiles` si nemůžete zobrazit nebo upravit jeho nastavení v `AdditionalUserInfo.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="a2b38-450">Needless znamená kvůli náš návrh rozhodnutí je důležité, aby měly všechny uživatelské účty v systému členství odpovídající záznam v `UserProfiles` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="a2b38-451">Rádi bychom je pro odpovídající záznam přidat do `UserProfiles` vždy, když se vytvoří nový členský účet uživatele prostřednictvím CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="a2b38-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="a2b38-452">Jak je popsáno v [ *vytváření uživatelských účtů* ](creating-user-accounts-vb.md) kurz, po vytvoření nového uživatelského účtu členství v ovládacím prvku CreateUserWizard vyvolá jeho [ `CreatedUser` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="a2b38-453">Abychom mohli vytvořit obslužnou rutinu události pro tuto událost, získejte ID uživatele pro uživatele nově vytvořené a vložte záznam do `UserProfiles` tabulky s použitím výchozích hodnot pro `HomeTown`, `HomepageUrl`, a `Signature` sloupce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="a2b38-454">A co víc je možné zobrazit výzvu uživateli pro tyto hodnoty úpravou ovládacího prvku CreateUserWizard rozhraní zahrnout další textová pole.</span><span class="sxs-lookup"><span data-stu-id="a2b38-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="a2b38-455">Nejprve se podíváme na to, jak přidat nový řádek `UserProfiles` tabulku v `CreatedUser` obslužné rutiny události s výchozími hodnotami.</span><span class="sxs-lookup"><span data-stu-id="a2b38-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="a2b38-456">Pod uvidíme, jak přizpůsobit aplikaci prvku CreateUserWizard uživatelské rozhraní pro zahrnutí polí další formuláře ke shromažďování domácí města, domovskou stránku a podpis nového uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="a2b38-457">Přidání výchozí řádek`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="a2b38-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="a2b38-458">V [ *vytváření uživatelských účtů* ](creating-user-accounts-vb.md) kurzu jsme přidali ovládacím prvku CreateUserWizard k `CreatingUserAccounts.aspx` stránku `Membership` složky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-458">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="a2b38-459">Abyste měli CreateUserWizard ovládacího prvku, přidejte záznam do `UserProfiles` tabulky při vytváření uživatelských účtů, musíme aktualizovat funkce ovládacího prvku CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="a2b38-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="a2b38-460">Místo provedení těchto změn na `CreatingUserAccounts.aspx` stránce, můžeme místo toho přidejte nového ovládacího prvku CreateUserWizard k `EnhancedCreateUserWizard.aspx` stránce a provést změny pro účely tohoto kurzu existuje.</span><span class="sxs-lookup"><span data-stu-id="a2b38-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="a2b38-461">Otevřít `EnhancedCreateUserWizard.aspx` stránce v sadě Visual Studio a přetáhněte z panelu nástrojů na stránku ovládacím prvku CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="a2b38-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="a2b38-462">Nastavení ovládacího prvku CreateUserWizard `ID` vlastnost `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="a2b38-463">Jak jsme probírali v [ *vytváření uživatelských účtů* ](creating-user-accounts-vb.md) kurz, CreateUserWizard výchozí uživatelské rozhraní výzvy návštěvníka potřebné informace.</span><span class="sxs-lookup"><span data-stu-id="a2b38-463">As we discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="a2b38-464">Jakmile tyto informace není zadaný, ovládací prvek interně vytvoří nový uživatelský účet v rámci členství bez nám museli psát jediný řádek kódu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="a2b38-465">Počet událostí ovládacím prvku CreateUserWizard vyvolá během jejího pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="a2b38-466">Poté, co návštěvník poskytuje informace o požadavku a formulář odešle, ovládacím prvku CreateUserWizard zpočátku aktivuje její [ `CreatingUser` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="a2b38-467">Pokud dojde k potížím během procesu vytvoření [ `CreateUserError` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) se aktivuje; ale, pokud je uživatel vytvořen úspěšně, pak bude [ `CreatedUser` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) je vyvolána.</span><span class="sxs-lookup"><span data-stu-id="a2b38-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="a2b38-468">V [ *vytváření uživatelských účtů* ](creating-user-accounts-vb.md) kurzu jsme vytvořili obslužnou rutinu události pro `CreatingUser` události a ujistěte se, že zadané uživatelské jméno neobsahovala počáteční nebo koncové mezery a který uživatelské jméno neobjevil kdekoli v hesle.</span><span class="sxs-lookup"><span data-stu-id="a2b38-468">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="a2b38-469">Chcete-li přidat řádek v `UserProfiles` tabulky pro nově vytvořené uživatelem, potřebujeme vytvořit obslužnou rutinu události pro `CreatedUser` událostí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="a2b38-470">Časem `CreatedUser` událost se aktivuje, uživatelský účet už byl vytvořen v rámci členství, umožňuje nám k načtení hodnoty ID uživatele účtu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="a2b38-471">Vytvořte obslužnou rutinu události pro `NewUserWizard`společnosti `CreatedUser` událostí a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="a2b38-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample11.vb)]

<span data-ttu-id="a2b38-472">Výše uvedené kód bytostí načtením UserId právě přidaný uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="a2b38-473">To lze provést pomocí `Membership.GetUser(username)` metoda vrací informace o konkrétní uživatele a poté použijete `ProviderUserKey` vlastnost pro načtení jejich ID uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="a2b38-474">Uživatelské jméno zadané uživatelem v ovládacím prvku CreateUserWizard je k dispozici prostřednictvím jeho [ `UserName` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="a2b38-475">V dalším kroku se načte připojovací řetězec z `Web.config` a `INSERT` zadaný příkaz.</span><span class="sxs-lookup"><span data-stu-id="a2b38-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="a2b38-476">ADO.NET objekty jsou vytvořeny a příkaz provést.</span><span class="sxs-lookup"><span data-stu-id="a2b38-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="a2b38-477">Kód přiřadí [ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx) instance na `@HomeTown`, `@HomepageUrl`, a `@Signature` parametry, které má za následek vložení databáze `NULL` hodnoty `HomeTown`, `HomepageUrl`, a `Signature` pole.</span><span class="sxs-lookup"><span data-stu-id="a2b38-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="a2b38-478">Přejděte `EnhancedCreateUserWizard.aspx` stránce prostřednictvím prohlížeče a vytvořit nový uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="a2b38-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="a2b38-479">Až to uděláte, vraťte se do sady Visual Studio a zkontrolovat obsah `aspnet_Users` a `UserProfiles` tabulky (jak jsme to udělali v obrázek 12).</span><span class="sxs-lookup"><span data-stu-id="a2b38-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="a2b38-480">Měli byste vidět nový uživatelský účet v `aspnet_Users` a odpovídající `UserProfiles` řádek (s `NULL` hodnoty `HomeTown`, `HomepageUrl`, a `Signature`).</span><span class="sxs-lookup"><span data-stu-id="a2b38-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>


<span data-ttu-id="a2b38-481">[![Byly přidány nového uživatelského účtu a UserProfiles záznamu](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span></span>

<span data-ttu-id="a2b38-482">**Obrázek 20**: A nový uživatelský účet a `UserProfiles` přidali záznam ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-vb/_static/image60.png))</span></span>


<span data-ttu-id="a2b38-483">Poté, co má návštěvníka zadaná jeho nové informace o účtu a kliknutí na tlačítko "Create User", je vytvořen uživatelský účet a řádek přidán do `UserProfiles` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="a2b38-484">Pak zobrazí CreateUserWizard jeho `CompleteWizardStep`, který se zobrazí zpráva o úspěchu a tlačítko pro pokračování.</span><span class="sxs-lookup"><span data-stu-id="a2b38-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="a2b38-485">Kliknutím na tlačítko Pokračovat vyvolá zpětné volání, ale nebyla provedena žádná akce, byste museli opustit uživatel zablokován na `EnhancedCreateUserWizard.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="a2b38-486">Lze zadat adresu URL pro uživatele poslat na po kliknutí na tlačítko Pokračovat pomocí ovládacího prvku CreateUserWizard na [ `ContinueDestinationPageUrl` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="a2b38-487">Nastavte `ContinueDestinationPageUrl` vlastnost "~ / Membership/AdditionalUserInfo.aspx".</span><span class="sxs-lookup"><span data-stu-id="a2b38-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="a2b38-488">Tato akce trvá nového uživatele, aby `AdditionalUserInfo.aspx`, kde můžete zobrazit a aktualizovat svoje nastavení.</span><span class="sxs-lookup"><span data-stu-id="a2b38-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="a2b38-489">Přizpůsobení rozhraní CreateUserWizard výzvu k Domovská, domovskou stránku a podpis nového uživatele</span><span class="sxs-lookup"><span data-stu-id="a2b38-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="a2b38-490">Pro scénáře vytvoření jednoduchého účtu kde potřebujete shromažďovat pouze základní informace o uživatelském účtu jako uživatelské jméno, heslo a e-mailu stačí výchozí rozhraní prvku CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="a2b38-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="a2b38-491">Ale co když jsme chtěli výzvu musí návštěvníka zadejte svůj domácí města, domovskou stránku a podpis při vytváření svého účtu?</span><span class="sxs-lookup"><span data-stu-id="a2b38-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="a2b38-492">Je možné přizpůsobit prvku CreateUserWizard rozhraní ke sběru dalších informací při registraci, a tyto informace slouží v `CreatedUser` obslužnou rutinu události pro vkládání dalších záznamů do databáze.</span><span class="sxs-lookup"><span data-stu-id="a2b38-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="a2b38-493">Ovládacím prvku CreateUserWizard rozšiřuje ovládací prvek ASP.NET průvodce, který je ovládací prvek, který umožňuje vývojářům definovat řadu seřazený `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="a2b38-494">Průvodce ovládací prvek vykreslí aktivního kroku a poskytuje rozhraní navigace, které umožňuje přesunout tyto kroky musí návštěvníka.</span><span class="sxs-lookup"><span data-stu-id="a2b38-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="a2b38-495">Ovládací prvek Průvodce je ideální pro rozdělení dlouhé úkolů v několika krocích.</span><span class="sxs-lookup"><span data-stu-id="a2b38-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="a2b38-496">Další informace o ovládacím prvku průvodce najdete v tématu [vytvoření uživatelského rozhraní pro krok za krokem s ovládacím prvkem ASP.NET 2.0 průvodce](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b38-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="a2b38-497">Výchozí značky prvku CreateUserWizard definuje dva `WizardSteps`: `CreateUserWizardStep` a `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample12.aspx)]

<span data-ttu-id="a2b38-498">První `WizardStep`, `CreateUserWizardStep`, vykreslí rozhraní, které vyzve k zadání uživatelského jména, hesla, e-mailu a tak dále.</span><span class="sxs-lookup"><span data-stu-id="a2b38-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="a2b38-499">Po návštěvníka poskytne tyto údaje a klikne na tlačítko "Create User", které se zobrazí `CompleteWizardStep`, která zobrazuje zprávy o úspěchu a tlačítko Pokračovat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="a2b38-500">Přizpůsobení ovládacího prvku CreateUserWizard rozhraní pro zahrnutí polí další formuláře, můžeme:</span><span class="sxs-lookup"><span data-stu-id="a2b38-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="a2b38-501"><strong>Vytvořit jednu nebo více nových</strong><strong>`WizardStep`</strong><strong>s tak, aby obsahovala další prvky uživatelského rozhraní</strong>.</span><span class="sxs-lookup"><span data-stu-id="a2b38-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="a2b38-502">Chcete-li přidat nový `WizardStep` chcete CreateUserWizard, klikněte na tlačítko "Přidat nebo odebrat `WizardStep` s" odkaz z jeho inteligentních značek ke spuštění `WizardStep` Editor kolekce.</span><span class="sxs-lookup"><span data-stu-id="a2b38-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardStep` s" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="a2b38-503">Odtud můžete přidat, odebrat nebo změnit pořadí kroků v průvodci.</span><span class="sxs-lookup"><span data-stu-id="a2b38-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="a2b38-504">Jedná se o postup, který budeme používat pro účely tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="a2b38-505"><strong>Převést</strong><strong>`CreateUserWizardStep`</strong><strong>do upravitelné</strong><strong>`WizardStep`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="a2b38-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="a2b38-506">Tím se nahradí `CreateUserWizardStep` s ekvivalentní `WizardStep` jehož značky definují uživatelské rozhraní, která odpovídá `CreateUserWizardStep`"s.</span><span class="sxs-lookup"><span data-stu-id="a2b38-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="a2b38-507">Převedením `CreateUserWizardStep` do `WizardStep` jsme přemístění ovládací prvky nebo přidat další prvky uživatelského rozhraní k tomuto kroku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="a2b38-508">Chcete-li převést `CreateUserWizardStep` nebo `CompleteWizardStep` do upravovat `WizardStep`, klikněte "uživatele vytvořit vlastní krok" nebo "Upravit krok dokončení" propojit inteligentní značky ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="a2b38-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="a2b38-509">**Použijte kombinaci výše uvedených dvou možností.**</span><span class="sxs-lookup"><span data-stu-id="a2b38-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="a2b38-510">Jeden důležité brát v úvahu je, že ovládacím prvku CreateUserWizard spustí jeho procesu vytvoření účtu uživatele při kliknutí na tlačítko "Create User" v rámci jeho `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="a2b38-511">Nebude vadit, když existují další `WizardStep` s po `CreateUserWizardStep` nebo ne.</span><span class="sxs-lookup"><span data-stu-id="a2b38-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="a2b38-512">Při přidávání vlastní `WizardStep` do ovládacího prvku CreateUserWizard ke shromažďování vstupu pro další uživatele, vlastní `WizardStep` lze umístit před nebo po `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="a2b38-513">Pokud byla zaslána před `CreateUserWizardStep` potom jsou shromažďovány další uživatelský vstup z vlastního `WizardStep` je k dispozici pro `CreatedUser` obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="a2b38-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="a2b38-514">Ale pokud vlastní `WizardStep` , přichází po `CreateUserWizardStep` potom podle času vlastní `WizardStep` se zobrazí nový uživatelský účet má již vytvořené a `CreatedUser` již byla aktivována událost.</span><span class="sxs-lookup"><span data-stu-id="a2b38-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="a2b38-515">Obrázek 21 ukazuje pracovní postup při přidaného `WizardStep` předchází `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="a2b38-516">Protože byla shromážděna dalších informací o uživatelích čas `CreatedUser` událost je aktivována, všechny musíme udělat, je aktualizace `CreatedUser` obslužná rutina události načtení tyto vstupy a pro použití `INSERT` hodnoty parametru příkazu (spíše než `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="a2b38-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>


<span data-ttu-id="a2b38-517">[![Pracovní postup CreateUserWizard, když Třída CreateUserWizardStep předchází další prvek WizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span></span>

<span data-ttu-id="a2b38-518">**Obrázek 21**: The CreateUserWizard pracovního postupu při další `WizardStep` Precedes `CreateUserWizardStep` ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image63.png))</span></span>


<span data-ttu-id="a2b38-519">Pokud vlastní `WizardStep` nachází *po* `CreateUserWizardStep`, ale proces vytváření účtu uživatele dojde k předtím, než uživatel má využili příležitost dobře se zadejte svůj domácí města, domovská stránka nebo podpis.</span><span class="sxs-lookup"><span data-stu-id="a2b38-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="a2b38-520">V takovém případě musí být vložena do databáze po vytvoření uživatelského účtu, jak ukazuje obrázek 22 tyto další informace.</span><span class="sxs-lookup"><span data-stu-id="a2b38-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>


<span data-ttu-id="a2b38-521">[![Při další prvek WizardStep, přichází po třídu CreateUserWizardStep CreateUserWizard pracovního postupu](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span></span>

<span data-ttu-id="a2b38-522">**Obrázek 22**: The CreateUserWizard pracovního postupu při další `WizardStep` dodává po `CreateUserWizardStep` ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image66.png))</span></span>


<span data-ttu-id="a2b38-523">Pracovní postup znázorňuje obrázek 22 čeká k vložení záznamu do `UserProfiles` tabulky až po dokončení kroku 2.</span><span class="sxs-lookup"><span data-stu-id="a2b38-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="a2b38-524">Pokud návštěvníka zavře svém webovém prohlížeči po kroku 1, ale spojili jsme se bude mít stav, kdy byl uživatelský účet vytvořen, ale žádný záznam se přidal do `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="a2b38-525">Jeden alternativním řešením je záznam obsahuje `NULL` nebo výchozí hodnoty, které jsou vloženy do `UserProfiles` v `CreatedUser` obslužné rutiny události (která se vyvolá po kroku 1) a aktualizujete tento záznam po dokončení kroku 2.</span><span class="sxs-lookup"><span data-stu-id="a2b38-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="a2b38-526">To zajistí, že `UserProfiles` pro uživatelský účet se přidá záznam, i když uživatel ukončí uprostřed proces registrace prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="a2b38-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="a2b38-527">Pro účely tohoto kurzu vytvoříme novou `WizardStep` , která nastane po `CreateUserWizardStep` ale předtím, než `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="a2b38-528">První get WizardStep v umístění a nakonfigurovaný a potom nám budete Podívejme se na kód.</span><span class="sxs-lookup"><span data-stu-id="a2b38-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="a2b38-529">V prvku CreateUserWizard inteligentní značky, vyberte "Přidat nebo odebrat `WizardStep` s", která se vyvolá `WizardStep` dialogové okno Editor kolekcí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="a2b38-530">Přidat nový `WizardStep`a nastavte jeho `ID` k `UserSettings`, jeho `Title` na "Nastavení" a jeho `StepType` k `Step`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="a2b38-531">Umístěte ho tak, že jde o po `CreateUserWizardStep` ("zaregistrujte vašeho nového účtu služby") a před `CompleteWizardStep` ("dokončených"), jak ukazuje obrázek 23.</span><span class="sxs-lookup"><span data-stu-id="a2b38-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>


<span data-ttu-id="a2b38-532">[![Přidejte nový prvek WizardStep ovládacího prvku CreateUserWizard](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="a2b38-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span></span>

<span data-ttu-id="a2b38-533">**Obrázek 23**: Přidání nový `WizardStep` do ovládacího prvku CreateUserWizard ([kliknutím ji zobrazíte obrázek v plné velikosti](storing-additional-user-information-vb/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="a2b38-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-vb/_static/image69.png))</span></span>


<span data-ttu-id="a2b38-534">Kliknutím na OK zavřete `WizardStep` dialogové okno Editor kolekcí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="a2b38-535">Nové `WizardStep` svědčí prvku CreateUserWizard aktualizované deklarativní:</span><span class="sxs-lookup"><span data-stu-id="a2b38-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample13.aspx)]

<span data-ttu-id="a2b38-536">Všimněte si, nové `<asp:WizardStep>` elementu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="a2b38-537">Potřebujeme přidat uživatelské rozhraní pro shromažďování domácí města, domovskou stránku a podpis zde nového uživatele.</span><span class="sxs-lookup"><span data-stu-id="a2b38-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="a2b38-538">Tento obsah můžete zadat v deklarativní syntaxe nebo prostřednictvím návrháře.</span><span class="sxs-lookup"><span data-stu-id="a2b38-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="a2b38-539">Použití návrháře, vyberte z rozevíracího seznamu v inteligentních značek k přejděte ke kroku v Návrháři krok "Nastavení".</span><span class="sxs-lookup"><span data-stu-id="a2b38-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-540">Výběr krok prostřednictvím inteligentních značek rozevíracího seznamu aktualizuje prvku CreateUserWizard [ `ActiveStepIndex` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), která určuje index počáteční krok.</span><span class="sxs-lookup"><span data-stu-id="a2b38-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="a2b38-541">Proto pokud tohoto rozevíracího seznamu můžete upravit krok "Nastavení" v návrháři, nezapomeňte nastavit zpět na "Přihlašování až pro svůj nový účet" tak, aby tento krok se zobrazí, když uživatelé navštíví nejprve `EnhancedCreateUserWizard.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>


<span data-ttu-id="a2b38-542">Vytvoření uživatelského rozhraní v rámci kroku "Nastavení", který obsahuje tři ovládací prvky textového pole s názvem `HomeTown`, `HomepageUrl`, a `Signature`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="a2b38-543">Po vytváření toto rozhraní, CreateUserWizard deklarativní by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="a2b38-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample14.aspx)]

<span data-ttu-id="a2b38-544">Pokračujte a tuto stránku prostřednictvím prohlížeče a vytvořit nový uživatelský účet, zadávání hodnot pro domácí města, domovskou stránku a podpisu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="a2b38-545">Po dokončení `CreateUserWizardStep` uživatelský účet je vytvořen v rámci členství a `CreatedUser` spustí obslužnou rutinu události, které přidá nový řádek do `UserProfiles`, ale s databází `NULL` hodnota `HomeTown`, `HomepageUrl`, a `Signature`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="a2b38-546">Hodnoty zadané pro domácí města, domovskou stránku a podpis se nikdy nepoužívá.</span><span class="sxs-lookup"><span data-stu-id="a2b38-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="a2b38-547">Net výsledkem je nový uživatelský účet se `UserProfiles` záznam, jehož `HomeTown`, `HomepageUrl`, a `Signature` pole ještě nutné zadat.</span><span class="sxs-lookup"><span data-stu-id="a2b38-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="a2b38-548">Potřebujeme ke spuštění kódu po kroku "Nastavení", který má domácí města, honepage a podpis hodnoty zadané uživatelem a aktualizuje odpovídající `UserProfiles` záznamu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="a2b38-549">Pokaždé, když uživatel přesune mezi kroky v Průvodci ovládacích prvků, průvodce [ `ActiveStepChanged` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) aktivována.</span><span class="sxs-lookup"><span data-stu-id="a2b38-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="a2b38-550">Můžeme vytvořit obslužnou rutinu události pro tuto událost a aktualizace `UserProfiles` tabulky po dokončení kroku "Nastavení".</span><span class="sxs-lookup"><span data-stu-id="a2b38-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="a2b38-551">Přidat obslužnou rutinu události pro CreateUserWizard `ActiveStepChanged` událostí a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="a2b38-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample15.vb)]

<span data-ttu-id="a2b38-552">Výše uvedený kód se spustí na zjištění, zda právě jsme dosáhli krok "Dokončit".</span><span class="sxs-lookup"><span data-stu-id="a2b38-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="a2b38-553">Vzhledem k tomu, že v kroku "Dokončit" se nachází hned za krok "Nastavení", pak dosáhne návštěvníka "Dokončených" krok, to znamená, že uživatel právě dokončili krok "Nastavení".</span><span class="sxs-lookup"><span data-stu-id="a2b38-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="a2b38-554">V takovém případě budeme potřebovat programově odkazovat na ovládací prvky textového pole v rámci `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="a2b38-555">To lze provést pomocí `FindControl` metoda programově odkazující `UserSettings WizardStep`a pak odkazovat textových polí v rámci `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="a2b38-556">Když neodkazujete textových polí jsme připraveni spustit `UPDATE` příkazu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="a2b38-557">`UPDATE` Příkaz má stejný počet parametrů jako `INSERT` příkaz v `CreatedUser` obslužná rutina události, ale zde použijeme domácí města, domovskou stránku a podpis hodnoty poskytnuté uživatelem.</span><span class="sxs-lookup"><span data-stu-id="a2b38-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="a2b38-558">Pomocí této obslužné rutiny události na místě, přejděte `EnhancedCreateUserWizard.aspx` stránce prostřednictvím prohlížeče a vytvořit nový uživatelský účet zadávání hodnot pro domácí města, domovskou stránku a podpisu.</span><span class="sxs-lookup"><span data-stu-id="a2b38-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="a2b38-559">Po vytvoření nového účtu měli byste být přesměrovaní na `AdditionalUserInfo.aspx` stránku, kde právě zadali domácí města, domovskou stránku a podpis se zobrazují informace.</span><span class="sxs-lookup"><span data-stu-id="a2b38-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b38-560">Náš web aktuálně obsahuje dvě stránky, ze kterých návštěvník můžete vytvořit nový účet: `CreatingUserAccounts.aspx` a `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="a2b38-561">Přejděte na přihlašovací stránce a mapy webu na webu `CreatingUserAccounts.aspx` stránky, ale `CreatingUserAccounts.aspx` stránky není vyzve uživatele k domácí města, domovskou stránku a podpis informace a nedojde k přidání odpovídající řádek `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="a2b38-562">Proto, aktualizujte `CreatingUserAccounts.aspx` stránce tak, aby tato funkce nabízí nebo aktualizujte stránku mapy webu a přihlaste se k odkazování `EnhancedCreateUserWizard.aspx` místo `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="a2b38-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="a2b38-563">Pokud se rozhodnete druhou možnost, nezapomeňte aktualizovat `Membership` složky `Web.config` tak, aby umožňoval anonymním uživatelům přístup k souboru `EnhancedCreateUserWizard.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="a2b38-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>


## <a name="summary"></a><span data-ttu-id="a2b38-564">Souhrn</span><span class="sxs-lookup"><span data-stu-id="a2b38-564">Summary</span></span>

<span data-ttu-id="a2b38-565">V tomto kurzu jsme se podívali na techniky pro modelování dat, která souvisí s účty uživatelů v rámci členství.</span><span class="sxs-lookup"><span data-stu-id="a2b38-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="a2b38-566">Konkrétně jsme se podívali na modelování entity, které sdílejí vztah jeden mnoho se uživatelské účty, jakož i data, která sdílí vztah 1: 1.</span><span class="sxs-lookup"><span data-stu-id="a2b38-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="a2b38-567">Kromě toho jsme viděli, jak to související informace může zobrazit, Vložit a aktualizovány, některé příklady použití ovládacím prvkem SqlDataSource a ostatní pomocí kódu ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2b38-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="a2b38-568">V tomto kurzu dokončíte naše pohled na uživatelské účty.</span><span class="sxs-lookup"><span data-stu-id="a2b38-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="a2b38-569">Spouští se k dalšímu kurzu Změníme naši pozornost k rolím.</span><span class="sxs-lookup"><span data-stu-id="a2b38-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="a2b38-570">Příštích několika kurzy se podíváme na rozhraní role zjistit, jak vytvořit nové role přiřazení rolí uživatelům, jak určit, ke kterým rolím uživatel patří do a jak se autorizace na základě rolí.</span><span class="sxs-lookup"><span data-stu-id="a2b38-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="a2b38-571">Všechno nejlepší programování!</span><span class="sxs-lookup"><span data-stu-id="a2b38-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="a2b38-572">Další čtení</span><span class="sxs-lookup"><span data-stu-id="a2b38-572">Further Reading</span></span>

<span data-ttu-id="a2b38-573">Další informace o tématech, které jsou popsané v tomto kurzu najdete na následujících odkazech:</span><span class="sxs-lookup"><span data-stu-id="a2b38-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a2b38-574">Přístup k a aktualizace dat v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="a2b38-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="a2b38-575">Ovládací prvek ASP.NET 2.0 Průvodce</span><span class="sxs-lookup"><span data-stu-id="a2b38-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="a2b38-576">Vytvoření pomocí ovládacího prvku ASP.NET 2.0 průvodce krok za krokem uživatelského rozhraní</span><span class="sxs-lookup"><span data-stu-id="a2b38-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="a2b38-577">Vytváří se vlastní zdroj dat řídicí parametry</span><span class="sxs-lookup"><span data-stu-id="a2b38-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="a2b38-578">Přizpůsobení ovládacího prvku CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="a2b38-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="a2b38-579">Ovládací prvek DetailsView šablon rychlý start</span><span class="sxs-lookup"><span data-stu-id="a2b38-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="a2b38-580">Zobrazení dat pomocí ovládacího prvku ListView</span><span class="sxs-lookup"><span data-stu-id="a2b38-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="a2b38-581">Rozbor validačních ovládacích prvků v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="a2b38-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="a2b38-582">Úpravy vložení a odstranění dat</span><span class="sxs-lookup"><span data-stu-id="a2b38-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="a2b38-583">Ověření formuláře v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a2b38-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="a2b38-584">Shromažďování informací o registraci vlastního uživatele</span><span class="sxs-lookup"><span data-stu-id="a2b38-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="a2b38-585">Profily v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="a2b38-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="a2b38-586">Asp: ListView ovládacího prvku</span><span class="sxs-lookup"><span data-stu-id="a2b38-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="a2b38-587">Rychlý start profily uživatelů</span><span class="sxs-lookup"><span data-stu-id="a2b38-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="a2b38-588">O autorovi</span><span class="sxs-lookup"><span data-stu-id="a2b38-588">About the Author</span></span>

<span data-ttu-id="a2b38-589">Scott Meisnerová, Autor více ASP/ASP.NET knih a zakladatelem 4GuysFromRolla.com, má pracovali Microsoft webových technologiích od roku 1998.</span><span class="sxs-lookup"><span data-stu-id="a2b38-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a2b38-590">Scott funguje jako nezávislý konzultant, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="a2b38-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a2b38-591">Jeho nejnovější knihy  *[Edice nakladatelství Sams naučit sami ASP.NET 2.0 za 24 hodin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="a2b38-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="a2b38-592">Scott může být dostupný na adrese [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) nebo prostřednictvím na svém blogu [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="a2b38-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="a2b38-593">Speciální k...</span><span class="sxs-lookup"><span data-stu-id="a2b38-593">Special Thanks To…</span></span>

<span data-ttu-id="a2b38-594">V této sérii kurzů byl recenzován uživatelem mnoho užitečných revidující.</span><span class="sxs-lookup"><span data-stu-id="a2b38-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a2b38-595">Zajímat téma Moje nadcházejících článcích MSDN?</span><span class="sxs-lookup"><span data-stu-id="a2b38-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a2b38-596">Pokud ano, vyřaďte mě řádek na [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="a2b38-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="a2b38-597">Předchozí</span><span class="sxs-lookup"><span data-stu-id="a2b38-597">Previous</span></span>](user-based-authorization-vb.md)
