---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Představení rozhraní ASP.NET Web Pages – aktualizace databázových dat | Dokumentace Microsoftu
author: tfitzmac
description: V tomto kurzu se dozvíte, jak aktualizovat záznam (změnit) existující databáze při použití webových stránek ASP.NET (Razor). Předpokládá, že jste dokončili řady th...
ms.author: aspnetcontent
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 948f5b5933669a43bf37dc0317ad644660dc67e9
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/05/2018
ms.locfileid: "37842899"
---
<a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="43140-104">Úvod do webových stránek ASP.NET – aktualizace databázových dat</span><span class="sxs-lookup"><span data-stu-id="43140-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>
====================
<span data-ttu-id="43140-105">podle [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="43140-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="43140-106">V tomto kurzu se dozvíte, jak aktualizovat záznam (změnit) existující databáze při použití webových stránek ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="43140-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="43140-107">Předpokládá, že jste dokončili řady prostřednictvím [vstupní Data podle používání Forms pomocí rozhraní ASP.NET Web Pages](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="43140-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="43140-108">Co se dozvíte:</span><span class="sxs-lookup"><span data-stu-id="43140-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="43140-109">Jak vybrat jednotlivý záznam v `WebGrid` pomocné rutiny.</span><span class="sxs-lookup"><span data-stu-id="43140-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="43140-110">Jak si jeden záznam z databáze.</span><span class="sxs-lookup"><span data-stu-id="43140-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="43140-111">Postup předběžné načtení formuláře s hodnotami ze záznamu v databázi.</span><span class="sxs-lookup"><span data-stu-id="43140-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="43140-112">Jak aktualizovat stávající záznam v databázi.</span><span class="sxs-lookup"><span data-stu-id="43140-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="43140-113">Jak ukládat informace na stránce bez zobrazení.</span><span class="sxs-lookup"><span data-stu-id="43140-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="43140-114">Jak používat skrytého pole k ukládání informací.</span><span class="sxs-lookup"><span data-stu-id="43140-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="43140-115">Popsané funkce a technologie:</span><span class="sxs-lookup"><span data-stu-id="43140-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="43140-116">`WebGrid` Pomocné rutiny.</span><span class="sxs-lookup"><span data-stu-id="43140-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="43140-117">SQL `Update` příkazu.</span><span class="sxs-lookup"><span data-stu-id="43140-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="43140-118">`Database.Execute` Metody.</span><span class="sxs-lookup"><span data-stu-id="43140-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="43140-119">Skryté pole (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="43140-119">Hidden fields (`<input type="hidden">`).</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="43140-120">Co budete vytvářet</span><span class="sxs-lookup"><span data-stu-id="43140-120">What You'll Build</span></span>

<span data-ttu-id="43140-121">V předchozím kurzu jste zjistili, jak přidat záznam do databáze.</span><span class="sxs-lookup"><span data-stu-id="43140-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="43140-122">Tady se dozvíte, jak zobrazit záznam pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="43140-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="43140-123">V *filmy* stránky, budete aktualizovat `WebGrid` pomocné rutiny, takže se zobrazí **upravit** odkaz vedle každý film:</span><span class="sxs-lookup"><span data-stu-id="43140-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![Zobrazit WebGrid včetně odkaz pro "Úpravy" pro každý film](updating-data/_static/image1.png)

<span data-ttu-id="43140-125">Když kliknete **upravit** odkaz, tím přejdete na jinou stránku, kde je video informace již ve formě:</span><span class="sxs-lookup"><span data-stu-id="43140-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Upravit video stránky zobrazující film bude upravován](updating-data/_static/image2.png)

<span data-ttu-id="43140-127">Můžete změnit libovolné hodnoty.</span><span class="sxs-lookup"><span data-stu-id="43140-127">You can change any of the values.</span></span> <span data-ttu-id="43140-128">Když odešlete změny kódu na stránce aktualizuje databázi a přejde zpět do seznamu video.</span><span class="sxs-lookup"><span data-stu-id="43140-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="43140-129">Tato část procesu funguje skoro stejně jako *AddMovie.cshtml* stránky, kterou jste vytvořili v předchozím kurzu, tak velkou část tohoto kurzu bude známé.</span><span class="sxs-lookup"><span data-stu-id="43140-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="43140-130">Je možné implementovat způsob, jak upravit jednotlivé film několika způsoby.</span><span class="sxs-lookup"><span data-stu-id="43140-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="43140-131">Tento přístup je znázorněno byla vybrána, protože je snadno pochopitelný a snadno se implementuje.</span><span class="sxs-lookup"><span data-stu-id="43140-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="43140-132">Přidání odkaz pro úpravy seznamu Movie</span><span class="sxs-lookup"><span data-stu-id="43140-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="43140-133">Pokud chcete začít, budete aktualizovat *filmy* stránce tak, že každý film výpis také obsahuje **upravit** odkaz.</span><span class="sxs-lookup"><span data-stu-id="43140-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="43140-134">Otevřít *Movies.cshtml* souboru.</span><span class="sxs-lookup"><span data-stu-id="43140-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="43140-135">V těle stránky, změňte `WebGrid` kód tak, že přidáte sloupec.</span><span class="sxs-lookup"><span data-stu-id="43140-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="43140-136">Tady je upravený kód:</span><span class="sxs-lookup"><span data-stu-id="43140-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="43140-137">Nový sloupec se tohle:</span><span class="sxs-lookup"><span data-stu-id="43140-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="43140-138">Bod v tomto sloupci se má zobrazit odkaz (`<a>` element) jejichž text říká "Upravit".</span><span class="sxs-lookup"><span data-stu-id="43140-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="43140-139">Co jsme po je vytvořit odkaz, který vypadá podobně jako následující při spuštění stránky s `id` hodnotu pro každý film:</span><span class="sxs-lookup"><span data-stu-id="43140-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="43140-140">Tento odkaz se vyvolat stránku s názvem *EditMovie*, a předá řetězec dotazu `?id=7` na tuto stránku.</span><span class="sxs-lookup"><span data-stu-id="43140-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="43140-141">Syntaxe pro nového sloupce, který může vypadat trochu složité, ale pouze důvodem umístí společně několik elementů je.</span><span class="sxs-lookup"><span data-stu-id="43140-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="43140-142">Každý jednotlivý prvek je jednoduché.</span><span class="sxs-lookup"><span data-stu-id="43140-142">Each individual element is straightforward.</span></span> <span data-ttu-id="43140-143">Pokud se můžete soustředit na jenom `<a>` elementu, zobrazí tento kód:</span><span class="sxs-lookup"><span data-stu-id="43140-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="43140-144">Základní informace o tom, jak funguje mřížky: v mřížce zobrazené řádky, jeden pro každý záznam v databázi, a zobrazuje sloupce pro každé pole v záznamu v databázi.</span><span class="sxs-lookup"><span data-stu-id="43140-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="43140-145">Zatímco každý řádek mřížky se vytváří, `item` záznamu v databázi (položky) pro tento řádek obsahuje objekt.</span><span class="sxs-lookup"><span data-stu-id="43140-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="43140-146">Toto uspořádání poskytuje způsob, jak získat data pro tento řádek kódu.</span><span class="sxs-lookup"><span data-stu-id="43140-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="43140-147">Který se zobrazí zde: výraz `item.ID` je stále hodnotu ID aktuální položky databáze.</span><span class="sxs-lookup"><span data-stu-id="43140-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="43140-148">Vám může získat některé z hodnot v databázi (title, rozšířením podle tematických nebo rok) stejným způsobem jako pomocí `item.Title`, `item.Genre`, nebo `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="43140-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="43140-149">Výraz `"~/EditMovie?id=@item.ID` kombinuje pevně zakódované část cílové adrese URL (`~/EditMovie?id=`) s číslem ID této dynamicky odvozené.</span><span class="sxs-lookup"><span data-stu-id="43140-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="43140-150">(Jste viděli `~` operátor v předchozím kurzu; je operátor technologie ASP.NET, který představuje aktuální kořenové složky webu.)</span><span class="sxs-lookup"><span data-stu-id="43140-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="43140-151">Výsledkem je, že tuto část kódu ve sloupci jednoduše vytvoří něco jako následující kód za běhu:</span><span class="sxs-lookup"><span data-stu-id="43140-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="43140-152">Přirozeně, skutečné hodnoty `id` se bude lišit pro každý řádek.</span><span class="sxs-lookup"><span data-stu-id="43140-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="43140-153">Vytváření vlastních zobrazení pro sloupec mřížky</span><span class="sxs-lookup"><span data-stu-id="43140-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="43140-154">Vraťme se k sloupci mřížky.</span><span class="sxs-lookup"><span data-stu-id="43140-154">Now back to the grid column.</span></span> <span data-ttu-id="43140-155">Tři sloupce jste původně měli v mřížce se zobrazí pouze hodnoty dat (název, rozšířením podle tematických a roku).</span><span class="sxs-lookup"><span data-stu-id="43140-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="43140-156">Toto zobrazení určený název sloupce databáze &mdash; například `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="43140-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="43140-157">Tato nová **upravit** sloupec propojení se liší.</span><span class="sxs-lookup"><span data-stu-id="43140-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="43140-158">Místo určení názvu sloupce, které předávání `format` parametru.</span><span class="sxs-lookup"><span data-stu-id="43140-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="43140-159">Tento parametr umožňuje definovat kód, který `WebGrid` pomocné rutiny vykreslí spolu s `item` hodnota pro zobrazení dat sloupců jako tučný nebo zelenou nebo ve formátu, který má být.</span><span class="sxs-lookup"><span data-stu-id="43140-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="43140-160">Například pokud byste chtěli název se zobrazí tučně, můžete například vytvořit sloupec jako v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="43140-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="43140-161">(Různé `@` znaků, které se zobrazí v `format` vlastnost označit přechod mezi značky a hodnoty kódu.)</span><span class="sxs-lookup"><span data-stu-id="43140-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="43140-162">Jakmile budete vědět o `format` vlastnost, je lze snáze pochopit jak nové **upravit** odkaz sloupce dohromady:</span><span class="sxs-lookup"><span data-stu-id="43140-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="43140-163">Sloupec obsahuje *pouze* z kódu, který vykreslí na odkaz, a navíc několik informací (ID), které jsou extrahovány ze záznamu v databázi pro řádek.</span><span class="sxs-lookup"><span data-stu-id="43140-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="43140-164">**Pojmenované parametry a poziční parametry pro metodu**</span><span class="sxs-lookup"><span data-stu-id="43140-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="43140-165">V mnoha případech když jste volali metodu a předat parametry, můžete jednoduše uvedli hodnoty parametrů oddělených čárkami.</span><span class="sxs-lookup"><span data-stu-id="43140-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="43140-166">Tady je několik příkladů:</span><span class="sxs-lookup"><span data-stu-id="43140-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="43140-167">Pokud znáte tento kód, ale v obou případech se předávání parametrů k metodám v určitém pořadí jsme neměli zmiňovat problém &mdash; konkrétně, pořadí, ve kterém jsou parametry definované v této metodě.</span><span class="sxs-lookup"><span data-stu-id="43140-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="43140-168">Pro `db.Execute` a `Validation.RequireFields`, pokud se promíchají pořadí hodnot předáte byste získali chybová zpráva při spuštění stránky nebo alespoň nějaké neobvyklé výsledky.</span><span class="sxs-lookup"><span data-stu-id="43140-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="43140-169">Je zřejmé budete muset vědět předávat parametry v pořadí.</span><span class="sxs-lookup"><span data-stu-id="43140-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="43140-170">(V nástroji WebMatrix, IntelliSense vám můžou pomoct při zjistit název, typ a pořadí parametrů.)</span><span class="sxs-lookup"><span data-stu-id="43140-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="43140-171">Jako alternativu k předávání hodnot v pořadí, můžete použít *pojmenované parametry*.</span><span class="sxs-lookup"><span data-stu-id="43140-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="43140-172">(V pořadí předávání parametrů se označuje jako pomocí *poziční parametry*.) Pro pojmenované parametry explicitně zahrnete název parametru předává jeho hodnotu.</span><span class="sxs-lookup"><span data-stu-id="43140-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="43140-173">Využili jste pojmenované parametry již s počtem opakování v těchto kurzech.</span><span class="sxs-lookup"><span data-stu-id="43140-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="43140-174">Příklad:</span><span class="sxs-lookup"><span data-stu-id="43140-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="43140-175">and</span><span class="sxs-lookup"><span data-stu-id="43140-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="43140-176">Pojmenované parametry jsou užitečné pro několik situací, zejména v případě, že metoda přijímá velký počet parametrů.</span><span class="sxs-lookup"><span data-stu-id="43140-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="43140-177">Jeden je, když chcete předat pouze jeden nebo dva parametry, ale nejsou hodnoty, které chcete předat mezi první pozice v seznamu parametrů.</span><span class="sxs-lookup"><span data-stu-id="43140-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="43140-178">Je jiné situace, kdy mají být váš kód lépe čitelný předáním parametry v pořadí, ve kterém je pro vás nejvhodnější.</span><span class="sxs-lookup"><span data-stu-id="43140-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="43140-179">Samozřejmě pokud chcete použít pojmenované parametry, budete muset znát názvy parametrů.</span><span class="sxs-lookup"><span data-stu-id="43140-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="43140-180">Služba WebMatrix IntelliSense můžete *zobrazit* názvy, ale nemůžete vyplnit aktuálně je pro vás.</span><span class="sxs-lookup"><span data-stu-id="43140-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>


## <a name="creating-the-edit-page"></a><span data-ttu-id="43140-181">Vytvoření stránky pro úpravu</span><span class="sxs-lookup"><span data-stu-id="43140-181">Creating the Edit Page</span></span>

<span data-ttu-id="43140-182">Nyní můžete vytvořit *EditMovie* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="43140-183">Když uživatelé kliknou **upravit** odkaz, na této stránce se zobrazí skončit.</span><span class="sxs-lookup"><span data-stu-id="43140-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="43140-184">Vytvoření stránky s názvem *EditMovie.cshtml* a nahradit, co je v souboru následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="43140-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="43140-185">Tento kód a kód se podobá mít *AddMovie* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="43140-186">Je malý rozdíl v textu tlačítka pro odeslání.</span><span class="sxs-lookup"><span data-stu-id="43140-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="43140-187">Stejně jako u *AddMovie* stránce, dojde `Html.ValidationSummary` volání, které se zobrazí chyby ověření, pokud tam nějaké jsou.</span><span class="sxs-lookup"><span data-stu-id="43140-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="43140-188">Nyní jsme se přitom volání `Validation.Message`, protože chyby se zobrazí v souhrnu ověření.</span><span class="sxs-lookup"><span data-stu-id="43140-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="43140-189">Jak je uvedeno v předchozím kurzu, můžete použít v různých kombinacích Souhrn ověření a jednotlivé chybové zprávy.</span><span class="sxs-lookup"><span data-stu-id="43140-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="43140-190">Všimněte si, že znovu, který `method` atribut `<form>` prvek je nastaven na `post`.</span><span class="sxs-lookup"><span data-stu-id="43140-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="43140-191">Stejně jako u *AddMovie.cshtml* stránky, tato stránka provádí změny v databázi.</span><span class="sxs-lookup"><span data-stu-id="43140-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="43140-192">Proto by měl provádět tento formulář `POST` operace.</span><span class="sxs-lookup"><span data-stu-id="43140-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="43140-193">(Další informace o rozdílech mezi `GET` a `POST` operací, najdete v článku [GET, POST a HTTP příkaz bezpečnosti](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) boční panel v tomto kurzu ve formulářích HTML.)</span><span class="sxs-lookup"><span data-stu-id="43140-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="43140-194">Jak už jste viděli v předchozí kurzu `value` textových polí se nastavují atributy s kódem Razor k jejich předběžné načtení.</span><span class="sxs-lookup"><span data-stu-id="43140-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="43140-195">Tentokrát ale používáte proměnné jako `title` a `genre` pro tuto úlohu místo `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="43140-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="43140-196">Jako dříve, tento kód bude předběžné načtení textové hodnoty pole s hodnotami video.</span><span class="sxs-lookup"><span data-stu-id="43140-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="43140-197">Zobrazí se vám za chvíli důvody, proč je užitečný použít proměnné pro tuto chvíli namísto použití `Request` objektu.</span><span class="sxs-lookup"><span data-stu-id="43140-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="43140-198">K dispozici je také `<input type="hidden">` prvek na této stránce.</span><span class="sxs-lookup"><span data-stu-id="43140-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="43140-199">Tento prvek ukládá ID film bez zviditelnění na stránce.</span><span class="sxs-lookup"><span data-stu-id="43140-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="43140-200">ID původně předána na stránku pomocí hodnoty řetězce dotazu (`?id=7` nebo podobné v adrese URL).</span><span class="sxs-lookup"><span data-stu-id="43140-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="43140-201">Vložením hodnoty ID do skryté pole, abyste měli jistotu, že je k dispozici při odeslání formuláře, i když už nebude mít přístup k původní adresu URL, které stránky se vyvolala s.</span><span class="sxs-lookup"><span data-stu-id="43140-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="43140-202">Na rozdíl od *AddMovie* stránce kód *EditMovie* stránka má dva různé funkce.</span><span class="sxs-lookup"><span data-stu-id="43140-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="43140-203">První funkce je, že když stránka se zobrazí první (a *pouze* pak), kód získá ID video z řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="43140-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="43140-204">Kód pak používá ID na odpovídající videa z databáze pro čtení a zobrazení (přednačtení) ji do textových polí.</span><span class="sxs-lookup"><span data-stu-id="43140-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="43140-205">Druhá funkce je, že když uživatel klikne **odeslat změny** tlačítko, kód má číst hodnoty do textových polí a ověřit je.</span><span class="sxs-lookup"><span data-stu-id="43140-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="43140-206">Kód má také k aktualizaci položky databáze s novými hodnotami.</span><span class="sxs-lookup"><span data-stu-id="43140-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="43140-207">Tato technika je podobné jako přidání záznamu, protože jste viděli v *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="43140-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="43140-208">Přidání kódu pro čtení jednoho videa</span><span class="sxs-lookup"><span data-stu-id="43140-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="43140-209">K provedení první funkce, tento kód vložte do horní části stránky:</span><span class="sxs-lookup"><span data-stu-id="43140-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="43140-210">Většina tento kód je uvnitř bloku, který se spustí `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="43140-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="43140-211">`!` Operátor znamená "not", takže znamená, že výraz *Pokud tento požadavek není odeslání příspěvku*, což je o tom, že to nepřímé způsob *Pokud tento požadavek je při prvním spuštění této stránce*.</span><span class="sxs-lookup"><span data-stu-id="43140-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="43140-212">Jak je uvedeno výše, tento kód spustit *pouze* při prvním spuštění stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="43140-213">Pokud zadáte nepovedlo kód v `if(!IsPost)`, by spustit pokaždé, když se na stránce je vyvolána, zda poprvé nebo v reakci na tlačítku klikněte na tlačítko.</span><span class="sxs-lookup"><span data-stu-id="43140-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="43140-214">Všimněte si, že tento kód obsahuje `else` blokovat této doby.</span><span class="sxs-lookup"><span data-stu-id="43140-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="43140-215">Jak jsme už uvedli, když jsme představili `if` bloky, někdy chcete spustit alternativní kódu, pokud neplatí stavu testování.</span><span class="sxs-lookup"><span data-stu-id="43140-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="43140-216">Je to tento případ tady.</span><span class="sxs-lookup"><span data-stu-id="43140-216">That's the case here.</span></span> <span data-ttu-id="43140-217">Pokud bude podmínka splněna (tj. Pokud předané na stránku ID je v pořádku), čtení řádku z databáze.</span><span class="sxs-lookup"><span data-stu-id="43140-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="43140-218">Nicméně, pokud podmínka není úspěšný, `else` bloku spuštěn a kód nastaví chybovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="43140-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="43140-219">Ověřuje se hodnota předána na stránku</span><span class="sxs-lookup"><span data-stu-id="43140-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="43140-220">Tento kód použije `Request.QueryString["id"]` k získání ID, která je předána na stránku.</span><span class="sxs-lookup"><span data-stu-id="43140-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="43140-221">Kód zajišťuje, že hodnotu byl předán ve skutečnosti identifikátor.</span><span class="sxs-lookup"><span data-stu-id="43140-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="43140-222">Pokud byla předána žádná hodnota, nastaví kód chyby ověřování.</span><span class="sxs-lookup"><span data-stu-id="43140-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="43140-223">Tento kód ukazuje různé způsob, jak ověřit informace.</span><span class="sxs-lookup"><span data-stu-id="43140-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="43140-224">V předchozím kurzu, kterou jste pracovali `Validation` pomocné rutiny.</span><span class="sxs-lookup"><span data-stu-id="43140-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="43140-225">Jste zaregistrovali pole k ověření a ASP.NET automaticky nebyla ověření a zobrazí chyby pomocí `Html.ValidationMessage` a `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="43140-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="43140-226">V takovém případě však je už ověřování není ve skutečnosti uživatelského vstupu.</span><span class="sxs-lookup"><span data-stu-id="43140-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="43140-227">Místo toho že ověřování hodnotu, která byla předána na stránku odjinud.</span><span class="sxs-lookup"><span data-stu-id="43140-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="43140-228">`Validation` Pomocné rutiny, která neumí za vás.</span><span class="sxs-lookup"><span data-stu-id="43140-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="43140-229">Proto byste zkontrolovat hodnotu sami, testováním s `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="43140-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="43140-230">Pokud je nějaký problém, můžete zobrazit chyba s použitím `Html.ValidationSummary`, stejně jako `Validation` pomocné rutiny.</span><span class="sxs-lookup"><span data-stu-id="43140-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="43140-231">Chcete-li to mohli udělat, zavolejte `Validation.AddFormError` a předejte jí zprávu zobrazit.</span><span class="sxs-lookup"><span data-stu-id="43140-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="43140-232">`Validation.AddFormError` je integrovaná metoda, která umožňuje definovat vlastní zprávy, které jsou ověřování systému, kterou jste již obeznámeni s.</span><span class="sxs-lookup"><span data-stu-id="43140-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="43140-233">(Dále v tomto kurzu budeme mluvit o tom, aby tento proces ověření trochu výkonnější.)</span><span class="sxs-lookup"><span data-stu-id="43140-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="43140-234">Jakmile ověříte, že je ID videa, kód čte databázi, hledá jenom položky izolované databáze.</span><span class="sxs-lookup"><span data-stu-id="43140-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="43140-235">(Pravděpodobně jste si všimli obecný vzor databázových operací: Otevřete databázi, definujte příkaz SQL a spuštění příkazu.) Tentokrát SQL `Select` výpis obsahuje `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="43140-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="43140-236">Protože ID je jedinečný, může být vrácen pouze jeden záznam.</span><span class="sxs-lookup"><span data-stu-id="43140-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="43140-237">Dotaz se provádí pomocí `db.QuerySingle` (není `db.Query`, jako jste použili pro výpis film), a vloží kód do výsledku `row` proměnné.</span><span class="sxs-lookup"><span data-stu-id="43140-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="43140-238">Název `row` libovolný; můžete pojmenovat proměnné, jakkoli chcete.</span><span class="sxs-lookup"><span data-stu-id="43140-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="43140-239">Proměnné inicializovány v horní části se pak naplní se podrobnosti o filmu tak, aby tyto hodnoty lze zobrazit v textových polích.</span><span class="sxs-lookup"><span data-stu-id="43140-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="43140-240">Testování stránky pro úpravu (zatím)</span><span class="sxs-lookup"><span data-stu-id="43140-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="43140-241">Pokud chcete otestovat stránku, spusťte *filmy* stránce teď a klikněte na tlačítko **upravit** odkaz vedle libovolné video.</span><span class="sxs-lookup"><span data-stu-id="43140-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="43140-242">Zobrazí se vám *EditMovie* stránky s podrobnostmi o vyplňují za video, které jste vybrali:</span><span class="sxs-lookup"><span data-stu-id="43140-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Upravit video stránky zobrazující film bude upravován](updating-data/_static/image3.png)

<span data-ttu-id="43140-244">Všimněte si, že adresa URL stránky obsahuje něco jako `?id=10` (nebo jiné telefonní číslo).</span><span class="sxs-lookup"><span data-stu-id="43140-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="43140-245">Zatím jste otestovali, který **upravit** odkazů v *film* stránce práce, že vaše stránka je čtení ID z řetězce dotazu a pracuje, že databáze dotaz pro získání film jeden záznam.</span><span class="sxs-lookup"><span data-stu-id="43140-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="43140-246">Můžete změnit informace film, ale nic se nestane po kliknutí na **odeslat změny**.</span><span class="sxs-lookup"><span data-stu-id="43140-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="43140-247">Přidání kódu k aktualizaci videa pomocí změny uživatele</span><span class="sxs-lookup"><span data-stu-id="43140-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="43140-248">V *EditMovie.cshtml* implementovat druhou funkci (ukládají se změny), přidejte následující kód jenom složené závorce `@` bloku.</span><span class="sxs-lookup"><span data-stu-id="43140-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="43140-249">(Pokud si nejste jistí, přesně, kde chcete změnit kód, můžete si prohlédnout [dokončení kódu pro stránku Upravit video](#Complete_Page_Listing_for_EditMovie) , který se zobrazí na konci tohoto kurzu.)</span><span class="sxs-lookup"><span data-stu-id="43140-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="43140-250">Znovu, je podobný kód v tomto značek a kódu *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="43140-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="43140-251">Kód je v `if(IsPost)` blokovat, protože tento kód se spustí pouze v případě, že uživatel klikne **odeslat změny** tlačítko &mdash; to znamená, pokud (a pouze tehdy, když) byl odeslán formulář.</span><span class="sxs-lookup"><span data-stu-id="43140-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="43140-252">V tomto případě, že nepoužíváte testu jako `if(IsPost && Validation.IsValid())`– to znamená, nejsou kombinování oba testy s použitím AND.</span><span class="sxs-lookup"><span data-stu-id="43140-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="43140-253">Na této stránce, je nejprve určit, zda je odeslání formuláře (`if(IsPost)`) a teprve pak zaregistrujte pole pro ověřování.</span><span class="sxs-lookup"><span data-stu-id="43140-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="43140-254">Pak můžete testovat výsledky ověření (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="43140-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="43140-255">Tok je mírně odlišná v porovnání s *AddMovie.cshtml* stránky, ale efekt je stejný.</span><span class="sxs-lookup"><span data-stu-id="43140-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="43140-256">Získat hodnoty do textových polí pomocí `Request.Form["title"]` a podobné pro druhý `<input>` elementy.</span><span class="sxs-lookup"><span data-stu-id="43140-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="43140-257">Všimněte si, že tentokrát kód získá ID film mimo skryté pole (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="43140-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="43140-258">Při provádění na stránce první, je kód teď ID mimo řetězec dotazu.</span><span class="sxs-lookup"><span data-stu-id="43140-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="43140-259">Získat hodnotu z skryté pole, abyste měli jistotu, že se zobrazuje ID videa, která byla původně zobrazí v případě, že řetězec dotazu byla nějakým způsobem změněna od té doby.</span><span class="sxs-lookup"><span data-stu-id="43140-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="43140-260">Velmi důležitý rozdíl mezi *AddMovie* kódu a tento kód je, že v tomto kódu můžete použít SQL `Update` příkaz místo `Insert Into` příkazu.</span><span class="sxs-lookup"><span data-stu-id="43140-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="43140-261">Následující příklad ukazuje syntaxi SQL `Update` – příkaz:</span><span class="sxs-lookup"><span data-stu-id="43140-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="43140-262">Všechny sloupce, můžete zadat v libovolném pořadí a není nutné nutně aktualizovat každý sloupec během `Update` operace.</span><span class="sxs-lookup"><span data-stu-id="43140-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="43140-263">(ID, nelze aktualizovat, protože záznam, který by ve skutečnosti uložit jako nový záznam a, který není povolen pro `Update` operace.)</span><span class="sxs-lookup"><span data-stu-id="43140-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="43140-264">**Důležité** `Where` klauzule s ID je velmi důležité, protože to je, jak databáze pozná, kterou databázi záznamů, které chcete aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="43140-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="43140-265">Pokud jste minule přestali `Where` klauzule, aktualizovali byste databázi *každý* záznamů v databázi.</span><span class="sxs-lookup"><span data-stu-id="43140-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="43140-266">Ve většině případů, které by byly havárii.</span><span class="sxs-lookup"><span data-stu-id="43140-266">In most cases, that would be a disaster.</span></span>


<span data-ttu-id="43140-267">V kódu jsou předány aktualizaci hodnot pro příkaz jazyka SQL s použitím zástupných symbolů.</span><span class="sxs-lookup"><span data-stu-id="43140-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="43140-268">Opakovat, co jsme řekli před: z bezpečnostních důvodů *pouze* použít zástupné znaky pro předání hodnot pro příkaz jazyka SQL.</span><span class="sxs-lookup"><span data-stu-id="43140-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="43140-269">Jakmile tento kód použije `db.Execute` ke spuštění `Update` příkaz, je přesměrován zpět na stránku seznam, kde můžete sledovat změny.</span><span class="sxs-lookup"><span data-stu-id="43140-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="43140-270">**Různé SQL příkazy, různé metody**</span><span class="sxs-lookup"><span data-stu-id="43140-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="43140-271">Jste si možná všimli, že používáte mírně odlišné metody spouští různé příkazy SQL.</span><span class="sxs-lookup"><span data-stu-id="43140-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="43140-272">Ke spuštění `Select` dotaz, který potenciálně vrací více záznamů, je použít `Query` metody.</span><span class="sxs-lookup"><span data-stu-id="43140-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="43140-273">Ke spuštění `Select` dotaz, který vrátí pouze jednu položku databáze, je použít `QuerySingle` metody.</span><span class="sxs-lookup"><span data-stu-id="43140-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="43140-274">Ke spuštění příkazů, provést změny, ale který nevracejte položky databáze, můžete použít `Execute` metody.</span><span class="sxs-lookup"><span data-stu-id="43140-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="43140-275">Je třeba mít různé metody, protože každá z nich vrací různé výsledky, jak jste už viděli v rozdílu mezi `Query` a `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="43140-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="43140-276">( `Execute` Ve skutečnosti vrátí metoda hodnotu také &mdash; konkrétně, počet řádky databáze, které byly ovlivněny příkaz &mdash; ale můžete jste byla ignorována, který zatím.)</span><span class="sxs-lookup"><span data-stu-id="43140-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="43140-277">Samozřejmě `Query` metoda může vrátit pouze jeden řádek.</span><span class="sxs-lookup"><span data-stu-id="43140-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="43140-278">Ale ASP.NET vždy zpracovává výsledky `Query` metoda jako kolekce.</span><span class="sxs-lookup"><span data-stu-id="43140-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="43140-279">I v případě, že metoda vrátí pouze jeden řádek, budete muset extrahovat tento jeden řádek z kolekce.</span><span class="sxs-lookup"><span data-stu-id="43140-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="43140-280">Proto v situacích, kde jste *vědět* získáte zpět pouze jeden řádek, je vhodnější použít trochu `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="43140-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="43140-281">Existuje několik metod, které provádějí konkrétní typy databázových operací.</span><span class="sxs-lookup"><span data-stu-id="43140-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="43140-282">Můžete najít seznam metod databáze [Stručná referenční rozhraní API technologie ASP.NET Web Pages](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="43140-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>


## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="43140-283">Aby ověřování pro ID více robustní</span><span class="sxs-lookup"><span data-stu-id="43140-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="43140-284">Při prvním spuštění stránky ID video z řetězce dotazu, které získáte můžete přejít z databáze získat tento film.</span><span class="sxs-lookup"><span data-stu-id="43140-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="43140-285">Je ověřeno, že ve skutečnosti došlo hodnotu k vyhledání, které jste provedli pomocí tohoto kódu:</span><span class="sxs-lookup"><span data-stu-id="43140-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="43140-286">Ujistěte se, že pokud se uživatel dostane do pomocí tohoto kódu *EditMovies* stránky bez první video ve výběru *filmy* stránky, na stránce zobrazí popisnou chybovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="43140-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="43140-287">(V opačném případě uživatelé uvidí chybu, která je pravděpodobně právě zmást.)</span><span class="sxs-lookup"><span data-stu-id="43140-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="43140-288">Toto ověření se však nepříliš robustní.</span><span class="sxs-lookup"><span data-stu-id="43140-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="43140-289">Na stránce může být vyvoláno také s těmito chybami:</span><span class="sxs-lookup"><span data-stu-id="43140-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="43140-290">Identifikátor není číslo.</span><span class="sxs-lookup"><span data-stu-id="43140-290">The ID isn't a number.</span></span> <span data-ttu-id="43140-291">Například může vyvolat na stránce s adresou URL jako `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="43140-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="43140-292">ID je číslo, ale odkazuje na film, který neexistuje (třeba `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="43140-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="43140-293">Pokud jste zvědaví, pokud chcete zobrazit chyby, které vzniknou z těchto adres URL, spusťte *filmy* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="43140-294">Vyberte video chcete upravit a potom změňte adresu URL *EditMovie* stránky na adresu URL, která obsahuje abecední ID nebo ID neexistující videa.</span><span class="sxs-lookup"><span data-stu-id="43140-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="43140-295">Tak co byste měli dělat?</span><span class="sxs-lookup"><span data-stu-id="43140-295">So what should you do?</span></span> <span data-ttu-id="43140-296">Abyste měli jistotu, že není pouze ID předána na stránku, ale, že ID je celé číslo je první opravu.</span><span class="sxs-lookup"><span data-stu-id="43140-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="43140-297">Změňte kód `!IsPost` testu, aby vypadala jako v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="43140-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="43140-298">Na druhou podmínku, která jste přidali `IsEmpty` testu, propojené s `&&` (logický operátor a):</span><span class="sxs-lookup"><span data-stu-id="43140-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="43140-299">Může nezapomeňte z [Úvod do programování webových stránek ASP.NET](../introducing-razor-syntax-c.md) kurz, který metody, jako jsou `AsBool` `AsInt` převést na jiný datový typ řetězec znaků.</span><span class="sxs-lookup"><span data-stu-id="43140-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="43140-300">`IsInt` – Metoda (a jiné, jako například `IsBool` a `IsDateTime`) jsou podobné.</span><span class="sxs-lookup"><span data-stu-id="43140-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="43140-301">Však jsou jen pro testování, zda jste *můžete* převést řetězec bez samotnému provedení převodu.</span><span class="sxs-lookup"><span data-stu-id="43140-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="43140-302">Takže tady v podstatě říkáte *Pokud hodnotu řetězce dotazu lze převést na celé...* .</span><span class="sxs-lookup"><span data-stu-id="43140-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="43140-303">Možný problém hledá videa, která neexistuje.</span><span class="sxs-lookup"><span data-stu-id="43140-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="43140-304">Kód slouží k získání filmu vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="43140-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="43140-305">Pokud předáte `movieId` hodnota, která se `QuerySingle` metodě, která neodpovídá skutečné film, nevrátí a příkazy, které následují (například `title=row.Title`) dojít k chybám.</span><span class="sxs-lookup"><span data-stu-id="43140-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="43140-306">Znovu se to snadno napravit.</span><span class="sxs-lookup"><span data-stu-id="43140-306">Again there's an easy fix.</span></span> <span data-ttu-id="43140-307">Pokud `db.QuerySingle` metoda nebyly vráceny žádné výsledky `row` proměnná bude mít hodnotu null.</span><span class="sxs-lookup"><span data-stu-id="43140-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="43140-308">Proto můžete zkontrolovat, zda `row` proměnná má hodnotu null, než se pokusíte získat hodnoty z něj.</span><span class="sxs-lookup"><span data-stu-id="43140-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="43140-309">Následující kód přidává `if` bloku kolem příkazy, které získávají hodnoty z celkového počtu `row` objektu:</span><span class="sxs-lookup"><span data-stu-id="43140-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="43140-310">Na stránce se tyto dvě další ověřovací testy, stane odrážky testování.</span><span class="sxs-lookup"><span data-stu-id="43140-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="43140-311">Kompletní kód `!IsPost` větev teď vypadá jako v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="43140-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="43140-312">Jsme Všimněte ještě jednou, že tato úloha je vhodné využít pro `else` bloku.</span><span class="sxs-lookup"><span data-stu-id="43140-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="43140-313">Pokud nejsou testy úspěšné, `else` bloky nastavení chybové zprávy.</span><span class="sxs-lookup"><span data-stu-id="43140-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="43140-314">Přidání propojení se vrátíte na stránku filmy</span><span class="sxs-lookup"><span data-stu-id="43140-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="43140-315">Konečné a užitečné podrobností je můžete přidat odkaz zpět *filmy* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="43140-316">V běžném toku událostí bude uživatele začíná už na *filmy* stránky a klikněte na tlačítko **upravit** odkaz.</span><span class="sxs-lookup"><span data-stu-id="43140-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="43140-317">Který přináší do *EditMovie* stránku, kde můžete upravit video a klikněte na tlačítko.</span><span class="sxs-lookup"><span data-stu-id="43140-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="43140-318">Po kód zpracovává změny, je přesměrován zpět *filmy* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="43140-319">Ale:</span><span class="sxs-lookup"><span data-stu-id="43140-319">However:</span></span>

- <span data-ttu-id="43140-320">Uživatel se mohli rozhodnot něco změnit.</span><span class="sxs-lookup"><span data-stu-id="43140-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="43140-321">Uživatel může jste získali na tuto stránku bez nejdříve kliknutím **upravit** odkaz v *filmy* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="43140-322">V obou případech budete chtít umožňují snadno vrátit na hlavní výpis.</span><span class="sxs-lookup"><span data-stu-id="43140-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="43140-323">Jde to snadno napravit &mdash; přidejte následující kód bezprostředně po zavření `</form>` značky v kódu:</span><span class="sxs-lookup"><span data-stu-id="43140-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="43140-324">Tento kód používá stejnou syntaxi pro `<a>` element, který jste se seznámili jinde.</span><span class="sxs-lookup"><span data-stu-id="43140-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="43140-325">Adresa URL obsahuje `~` rozumí "kořenový adresář webu."</span><span class="sxs-lookup"><span data-stu-id="43140-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="43140-326">Testování procesu aktualizace Movie</span><span class="sxs-lookup"><span data-stu-id="43140-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="43140-327">Nyní můžete otestovat.</span><span class="sxs-lookup"><span data-stu-id="43140-327">Now you can test.</span></span> <span data-ttu-id="43140-328">Spustit *filmy* stránce a klikněte na tlačítko **upravit** vedle videa.</span><span class="sxs-lookup"><span data-stu-id="43140-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="43140-329">Když *EditMovie* se zobrazí stránka, provést změny filmů a klikněte na tlačítko **odeslat změny**.</span><span class="sxs-lookup"><span data-stu-id="43140-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="43140-330">Jakmile se zobrazí výpis film, ujistěte se, že změny jsou zobrazeny.</span><span class="sxs-lookup"><span data-stu-id="43140-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="43140-331">Chcete-li mít jistotu, že funguje ověřování, klikněte na tlačítko **upravit** pro jiné video.</span><span class="sxs-lookup"><span data-stu-id="43140-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="43140-332">Když se zobrazí *EditMovie* zrušte **žánr** pole (nebo **rok** pole nebo obojí) a odeslat provedené změny.</span><span class="sxs-lookup"><span data-stu-id="43140-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="43140-333">Zobrazí se vám chyby dle očekávání:</span><span class="sxs-lookup"><span data-stu-id="43140-333">You'll see an error, as you'd expect:</span></span>

![Upravit video stránky zobrazující chyby ověření](updating-data/_static/image4.png)

<span data-ttu-id="43140-335">Klikněte na tlačítko **vrátit seznam film** odkaz opustit změny a vraťte se do *filmy* stránky.</span><span class="sxs-lookup"><span data-stu-id="43140-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="43140-336">Chystá se další</span><span class="sxs-lookup"><span data-stu-id="43140-336">Coming Up Next</span></span>

<span data-ttu-id="43140-337">V dalším kurzu zobrazí se vám odstranění záznamu video.</span><span class="sxs-lookup"><span data-stu-id="43140-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="43140-338">Úplný seznam pro stránku Movie (aktualizován odkazů pro úpravy)</span><span class="sxs-lookup"><span data-stu-id="43140-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="43140-339">Úplný výpis stránky pro stránku Upravit video</span><span class="sxs-lookup"><span data-stu-id="43140-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="43140-340">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="43140-340">Additional Resources</span></span>

- [<span data-ttu-id="43140-341">Úvod k programování v prostředí ASP.NET pomocí syntaxe Razor</span><span class="sxs-lookup"><span data-stu-id="43140-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="43140-342">[Prohlášení aktualizace SQL](http://www.w3schools.com/sql/sql_update.asp) na webu W3Schools</span><span class="sxs-lookup"><span data-stu-id="43140-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="43140-343">[Předchozí](entering-data.md)
> [další](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="43140-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
