---
title: Hostitele ASP.NET Core ve webové farmě
author: guardrex
description: Zjistěte, jak hostovat několik instancí aplikace ASP.NET Core se sdílenými prostředky v prostředí webové farmy.
ms.author: riande
ms.custom: mvc
ms.date: 07/16/2018
uid: host-and-deploy/web-farm
ms.openlocfilehash: 2435c24bc205486331c828337ca81c43e6e60448
ms.sourcegitcommit: 3ca527f27c88cfc9d04688db5499e372fbc2c775
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/17/2018
ms.locfileid: "39096101"
---
# <a name="host-aspnet-core-in-a-web-farm"></a><span data-ttu-id="93f58-103">Hostitele ASP.NET Core ve webové farmě</span><span class="sxs-lookup"><span data-stu-id="93f58-103">Host ASP.NET Core in a web farm</span></span>

<span data-ttu-id="93f58-104">Podle [Luke Latham](https://github.com/guardrex) a [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="93f58-104">By [Luke Latham](https://github.com/guardrex) and [Chris Ross](https://github.com/Tratcher)</span></span>

<span data-ttu-id="93f58-105">A *webové farmy* je skupina dva nebo víc webových serverů (nebo *uzly*), které hostovat několik instancí aplikace.</span><span class="sxs-lookup"><span data-stu-id="93f58-105">A *web farm* is a group of two or more web servers (or *nodes*) that host multiple instances of an app.</span></span> <span data-ttu-id="93f58-106">Při obdržení požadavků od uživatelů do webové farmy *nástroj pro vyrovnávání zatížení* distribuuje požadavky na uzly webové farmy.</span><span class="sxs-lookup"><span data-stu-id="93f58-106">When requests from users arrive to a web farm, a *load balancer* distributes the requests to the web farm's nodes.</span></span> <span data-ttu-id="93f58-107">Zlepšení webových farem:</span><span class="sxs-lookup"><span data-stu-id="93f58-107">Web farms improve:</span></span>

* <span data-ttu-id="93f58-108">**Spolehlivost a dostupnost** &ndash; když dojde k selhání jednoho nebo více uzlů, nástroje pro vyrovnávání zatížení může směrovat požadavky do dalších uzlů funkční pokračovat ve zpracování žádosti.</span><span class="sxs-lookup"><span data-stu-id="93f58-108">**Reliability/availability** &ndash; When one or more nodes fail, the load balancer can route requests to other functioning nodes to continue processing requests.</span></span>
* <span data-ttu-id="93f58-109">**Kapacity a výkonu** &ndash; více uzlů může zpracovávat žádosti více než jeden server.</span><span class="sxs-lookup"><span data-stu-id="93f58-109">**Capacity/performance** &ndash; Multiple nodes can process more requests than a single server.</span></span> <span data-ttu-id="93f58-110">Nástroje pro vyrovnávání zatížení vyrovnává zatížení díky distribuci požadavků na uzly.</span><span class="sxs-lookup"><span data-stu-id="93f58-110">The load balancer balances the workload by distributing requests to the nodes.</span></span>
* <span data-ttu-id="93f58-111">**Škálovatelnost** &ndash; když více nebo méně kapacity se vyžaduje, počet aktivních uzlů může být zvýší nebo sníží tak, aby odpovídaly zatížení.</span><span class="sxs-lookup"><span data-stu-id="93f58-111">**Scalability** &ndash; When more or less capacity is required, the number of active nodes can be increased or decreased to match the workload.</span></span> <span data-ttu-id="93f58-112">Webové farmy technologií platformy, například [služby Azure App Service](https://azure.microsoft.com/services/app-service/), můžete automaticky přidávat nebo odebírat uzly na žádost správce systému nebo automaticky bez zásahu člověka.</span><span class="sxs-lookup"><span data-stu-id="93f58-112">Web farm platform technologies, such as [Azure App Service](https://azure.microsoft.com/services/app-service/), can automatically add or remove nodes at the request of the system administrator or automatically without human intervention.</span></span>
* <span data-ttu-id="93f58-113">**Udržovatelnost** &ndash; uzly webové farmy se můžete spolehnout na sadu sdílených služeb, což vede k jednodušší správu systému.</span><span class="sxs-lookup"><span data-stu-id="93f58-113">**Maintainability** &ndash; Nodes of a web farm can rely on a set of shared services, which results in easier system management.</span></span> <span data-ttu-id="93f58-114">Například uzly webové farmy, můžete spoléhat na jednoho databázového serveru a běžné umístění v síti pro statické prostředky, jako jsou obrázky a soubory ke stažení.</span><span class="sxs-lookup"><span data-stu-id="93f58-114">For example, the nodes of a web farm can rely upon a single database server and a common network location for static resources, such as images and downloadable files.</span></span>

<span data-ttu-id="93f58-115">Toto téma popisuje konfiguraci a závislostech v ASP.NET core aplikacím hostovaným ve webové farmě, které spoléhají na sdílené prostředky.</span><span class="sxs-lookup"><span data-stu-id="93f58-115">This topic describes configuration and dependencies for ASP.NET core apps hosted in a web farm that rely upon shared resources.</span></span>

## <a name="general-configuration"></a><span data-ttu-id="93f58-116">Obecná konfigurace</span><span class="sxs-lookup"><span data-stu-id="93f58-116">General configuration</span></span>

<xref:host-and-deploy/index>  
<span data-ttu-id="93f58-117">Zjistěte, jak nastavit hostitelská prostředí a nasazení aplikace ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="93f58-117">Learn how to set up hosting environments and deploy ASP.NET Core apps.</span></span> <span data-ttu-id="93f58-118">Nakonfiguruje správce procesu v každém uzlu webovou farmu k automatizaci aplikace se spustí a restartuje.</span><span class="sxs-lookup"><span data-stu-id="93f58-118">Configure a process manager on each node of the web farm to automate app starts and restarts.</span></span> <span data-ttu-id="93f58-119">Každý uzel vyžaduje modul runtime ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="93f58-119">Each node requires the ASP.NET Core runtime.</span></span> <span data-ttu-id="93f58-120">Další informace najdete v tématech v [hostitele a nasadit](xref:host-and-deploy/index) oblasti dokumentace.</span><span class="sxs-lookup"><span data-stu-id="93f58-120">For more information, see the topics in the [Host and deploy](xref:host-and-deploy/index) area of the documentation.</span></span>

<xref:host-and-deploy/proxy-load-balancer>  
<span data-ttu-id="93f58-121">Další informace o konfiguraci aplikací hostovaných za službou proxy servery a nástroje pro vyrovnávání zatížení, které často skryl důležité vyžádat informace.</span><span class="sxs-lookup"><span data-stu-id="93f58-121">Learn about configuration for apps hosted behind proxy servers and load balancers, which often obscure important request information.</span></span>

<xref:host-and-deploy/azure-apps/index>  
<span data-ttu-id="93f58-122">[Azure App Service](https://azure.microsoft.com/services/app-service/) je [Microsoft cloud computingu platformová služba](https://azure.microsoft.com/) pro hostování webových aplikací, včetně ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="93f58-122">[Azure App Service](https://azure.microsoft.com/services/app-service/) is a [Microsoft cloud computing platform service](https://azure.microsoft.com/) for hosting web apps, including ASP.NET Core.</span></span> <span data-ttu-id="93f58-123">App Service je plně spravovaná platforma, která poskytuje automatické škálování, Vyrovnávání zatížení, použití dílčích oprav a průběžné nasazování.</span><span class="sxs-lookup"><span data-stu-id="93f58-123">App Service is a fully managed platform that provides automatic scaling, load balancing, patching, and continuous deployment.</span></span>

## <a name="app-data"></a><span data-ttu-id="93f58-124">Data aplikací</span><span class="sxs-lookup"><span data-stu-id="93f58-124">App data</span></span>

<span data-ttu-id="93f58-125">Když je aplikace škálovat do několika instancí, může být stav aplikace, která vyžaduje sdílení mezi uzly.</span><span class="sxs-lookup"><span data-stu-id="93f58-125">When an app is scaled to multiple instances, there might be app state that requires sharing across nodes.</span></span> <span data-ttu-id="93f58-126">Pokud stav není přechodná, vezměte v úvahu pro sdílení obsahu [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span><span class="sxs-lookup"><span data-stu-id="93f58-126">If the state is transient, consider sharing an [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span></span> <span data-ttu-id="93f58-127">Pokud sdílený stav vyžaduje trvalost, zvažte uložení sdílený stav do databáze.</span><span class="sxs-lookup"><span data-stu-id="93f58-127">If the shared state requires persistence, consider storing the shared state in a database.</span></span>

## <a name="required-configuration"></a><span data-ttu-id="93f58-128">Požadované konfigurace</span><span class="sxs-lookup"><span data-stu-id="93f58-128">Required configuration</span></span>

<span data-ttu-id="93f58-129">Ochrana dat a ukládání do mezipaměti vyžadují konfiguraci pro aplikace nasazené do webové farmy.</span><span class="sxs-lookup"><span data-stu-id="93f58-129">Data Protection and Caching require configuration for apps deployed to a web farm.</span></span>

### <a name="data-protection"></a><span data-ttu-id="93f58-130">Ochrana dat</span><span class="sxs-lookup"><span data-stu-id="93f58-130">Data Protection</span></span>

<span data-ttu-id="93f58-131">[Systému ochrany dat ASP.NET Core](xref:security/data-protection/introduction) aplikací používají k ochraně dat.</span><span class="sxs-lookup"><span data-stu-id="93f58-131">The [ASP.NET Core Data Protection system](xref:security/data-protection/introduction) is used by apps to protect data.</span></span> <span data-ttu-id="93f58-132">Ochrana dat závisí na sadu kryptografických klíčů uložených v *klíč prstenec*.</span><span class="sxs-lookup"><span data-stu-id="93f58-132">Data Protection relies upon a set of cryptographic keys stored in a *key ring*.</span></span> <span data-ttu-id="93f58-133">Při inicializaci systému ochrany dat, se vztahuje [výchozí nastavení](xref:security/data-protection/configuration/default-settings) , který ukládat klíče aktualizační kanál, který místně.</span><span class="sxs-lookup"><span data-stu-id="93f58-133">When the Data Protection system is initialized, it applies [default settings](xref:security/data-protection/configuration/default-settings) that store the key ring locally.</span></span> <span data-ttu-id="93f58-134">Pod výchozí konfigurace je jedinečný klíč kanál uložen na každém uzlu webové farmy.</span><span class="sxs-lookup"><span data-stu-id="93f58-134">Under the default configuration, a unique key ring is stored on each node of the web farm.</span></span> <span data-ttu-id="93f58-135">V důsledku toho každý uzel webové serverové farmy nelze dešifrovat data, která se šifrují aplikace na libovolném uzlu.</span><span class="sxs-lookup"><span data-stu-id="93f58-135">Consequently, each web farm node can't decrypt data that's encrypted by an app on any other node.</span></span> <span data-ttu-id="93f58-136">Výchozí konfigurace není obvykle vhodné pro hostování aplikací ve webové farmě.</span><span class="sxs-lookup"><span data-stu-id="93f58-136">The default configuration isn't generally appropriate for hosting apps in a web farm.</span></span> <span data-ttu-id="93f58-137">Alternativa k implementaci sdílený klíč kanál je vždy směrovat požadavky uživatelů na stejném uzlu.</span><span class="sxs-lookup"><span data-stu-id="93f58-137">An alternative to implementing a shared key ring is to always route user requests to the same node.</span></span> <span data-ttu-id="93f58-138">Další informace o konfiguraci ochrany dat systému pro nasazení webové farmy najdete v tématu <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="93f58-138">For more information on Data Protection system configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span>

### <a name="caching"></a><span data-ttu-id="93f58-139">Ukládání do mezipaměti</span><span class="sxs-lookup"><span data-stu-id="93f58-139">Caching</span></span>

<span data-ttu-id="93f58-140">V prostředí webové farmy musejí sdílet mechanizmus ukládání do mezipaměti položek v mezipaměti napříč uzly webové farmy.</span><span class="sxs-lookup"><span data-stu-id="93f58-140">In a web farm environment, the caching mechanism must share cached items across the web farm's nodes.</span></span> <span data-ttu-id="93f58-141">Ukládání do mezipaměti musí buď spoléhat na běžné mezipaměti redis cache, sdílenou databázi systému SQL Server nebo vlastní implementaci ukládání do mezipaměti, která sdílí položek v mezipaměti ve webové farmě.</span><span class="sxs-lookup"><span data-stu-id="93f58-141">Caching must either rely upon a common Redis cache, a shared SQL Server database, or a custom caching implementation that shares cached items across the web farm.</span></span> <span data-ttu-id="93f58-142">Další informace naleznete v tématu <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="93f58-142">For more information, see <xref:performance/caching/distributed>.</span></span>

## <a name="dependent-components"></a><span data-ttu-id="93f58-143">Závislé součásti</span><span class="sxs-lookup"><span data-stu-id="93f58-143">Dependent components</span></span>

<span data-ttu-id="93f58-144">Následující scénáře nevyžadují další konfiguraci, ale jsou závislé na technologie, které vyžadují konfiguraci pro farmy webových serverů.</span><span class="sxs-lookup"><span data-stu-id="93f58-144">The following scenarios don't require additional configuration, but they depend on technologies that require configuration for web farms.</span></span>

| <span data-ttu-id="93f58-145">Scénář</span><span class="sxs-lookup"><span data-stu-id="93f58-145">Scenario</span></span> | <span data-ttu-id="93f58-146">Závisí na &hellip;</span><span class="sxs-lookup"><span data-stu-id="93f58-146">Depends on &hellip;</span></span> |
| -------- | ------------------- |
| <span data-ttu-id="93f58-147">Ověřování</span><span class="sxs-lookup"><span data-stu-id="93f58-147">Authentication</span></span> | <span data-ttu-id="93f58-148">Ochrana dat (viz <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="93f58-148">Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="93f58-149">Další informace naleznete v tématu <xref:security/authentication/cookie> a <xref:security/cookie-sharing>.</span><span class="sxs-lookup"><span data-stu-id="93f58-149">For more information, see <xref:security/authentication/cookie> and <xref:security/cookie-sharing>.</span></span> |
| <span data-ttu-id="93f58-150">Identita</span><span class="sxs-lookup"><span data-stu-id="93f58-150">Identity</span></span> | <span data-ttu-id="93f58-151">Konfigurace ověřování a databáze.</span><span class="sxs-lookup"><span data-stu-id="93f58-151">Authentication and database configuration.</span></span><br><br><span data-ttu-id="93f58-152">Další informace naleznete v tématu <xref:security/authentication/identity>.</span><span class="sxs-lookup"><span data-stu-id="93f58-152">For more information, see <xref:security/authentication/identity>.</span></span> |
| <span data-ttu-id="93f58-153">Relace</span><span class="sxs-lookup"><span data-stu-id="93f58-153">Session</span></span> | <span data-ttu-id="93f58-154">Ochrana dat (šifrované soubory cookie) (viz <xref:security/data-protection/configuration/overview>) a ukládání do mezipaměti (naleznete v tématu <xref:performance/caching/distributed>).</span><span class="sxs-lookup"><span data-stu-id="93f58-154">Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) and Caching (see <xref:performance/caching/distributed>).</span></span><br><br><span data-ttu-id="93f58-155">Další informace najdete v tématu [stav relace a aplikace: stav relace](xref:fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="93f58-155">For more information, see [Session and app state: Session state](xref:fundamentals/app-state#session-state).</span></span> |
| <span data-ttu-id="93f58-156">TempData</span><span class="sxs-lookup"><span data-stu-id="93f58-156">TempData</span></span> | <span data-ttu-id="93f58-157">Ochrana dat (šifrované soubory cookie) (naleznete v tématu <xref:security/data-protection/configuration/overview>) nebo v jiné relaci (naleznete v tématu [stav relace a aplikace: stav relace](xref:fundamentals/app-state#session-state)).</span><span class="sxs-lookup"><span data-stu-id="93f58-157">Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) or Session (see [Session and app state: Session state](xref:fundamentals/app-state#session-state)).</span></span><br><br><span data-ttu-id="93f58-158">Další informace najdete v tématu [stav relace a aplikace: TempData](xref:fundamentals/app-state#tempdata).</span><span class="sxs-lookup"><span data-stu-id="93f58-158">For more information, see [Session and app state: TempData](xref:fundamentals/app-state#tempdata).</span></span> |
| <span data-ttu-id="93f58-159">Proti padělání</span><span class="sxs-lookup"><span data-stu-id="93f58-159">Anti-forgery</span></span> | <span data-ttu-id="93f58-160">Ochrana dat (viz <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="93f58-160">Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="93f58-161">Další informace naleznete v tématu <xref:security/anti-request-forgery>.</span><span class="sxs-lookup"><span data-stu-id="93f58-161">For more information, see <xref:security/anti-request-forgery>.</span></span> |

## <a name="troubleshoot"></a><span data-ttu-id="93f58-162">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="93f58-162">Troubleshoot</span></span>

<span data-ttu-id="93f58-163">Pokud ochranu dat nebo ukládání do mezipaměti není konfigurován pro prostředí webové farmy, dojde k občasné chyby při zpracování žádosti.</span><span class="sxs-lookup"><span data-stu-id="93f58-163">When Data Protection or Caching isn't configured for a web farm environment, intermittent errors occur when requests are processed.</span></span> <span data-ttu-id="93f58-164">K tomu dochází, protože uzly není sdílí stejné prostředky a požadavky uživatelů nejsou vždy směrují zpět do stejného uzlu.</span><span class="sxs-lookup"><span data-stu-id="93f58-164">This occurs because nodes don't share the same resources and user requests aren't always routed back to the same node.</span></span>

<span data-ttu-id="93f58-165">Vezměte v úvahu uživatel, který se přihlásí do aplikace ověřování souborem cookie.</span><span class="sxs-lookup"><span data-stu-id="93f58-165">Consider a user who signs into the app using cookie authentication.</span></span> <span data-ttu-id="93f58-166">Uživatel se přihlásí aplikace na uzlu jedné webové farmy.</span><span class="sxs-lookup"><span data-stu-id="93f58-166">The user signs into the app on one web farm node.</span></span> <span data-ttu-id="93f58-167">Pokud své příští žádosti o dorazí na stejný uzel, ve kterém jsou přihlášeni, aplikace je schopná dešifrovat ověřovacího souboru cookie a umožňuje přístup ke prostředek vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="93f58-167">If their next request arrives at the same node where they signed in, the app is able to decrypt the authentication cookie and allows access to the app's resource.</span></span> <span data-ttu-id="93f58-168">Pokud své příští žádosti o přijetí na jiný uzel, aplikace nelze dešifrovat ověřovacího souboru cookie z uzlu, kde uživatel přihlášený a autorizaci pro požadovaný prostředek se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="93f58-168">If their next request arrives at a different node, the app can't decrypt the authentication cookie from the node where the user signed in, and authorization for the requested resource fails.</span></span>

<span data-ttu-id="93f58-169">Když nastane některá z následujících příznaků **přerušovaně**, problém je obvykle trasovány na nesprávnou konfiguraci ochrany dat nebo ukládání do mezipaměti pro prostředí webové farmy:</span><span class="sxs-lookup"><span data-stu-id="93f58-169">When any of the following symptoms occur **intermittently**, the problem is usually traced to improper Data Protection or Caching configuration for a web farm environment:</span></span>

* <span data-ttu-id="93f58-170">Ověřování konce &ndash; ověřovacího souboru cookie je chybně nakonfigurovaná nebo nelze dešifrovat.</span><span class="sxs-lookup"><span data-stu-id="93f58-170">Authentication breaks &ndash; The authentication cookie is misconfigured or can't be decrypted.</span></span> <span data-ttu-id="93f58-171">OAuth (Facebook, Microsoft, Twitter) nebo přihlášení OpenIdConnect nezdaří s chybou "Korelace se nepovedlo."</span><span class="sxs-lookup"><span data-stu-id="93f58-171">OAuth (Facebook, Microsoft, Twitter) or OpenIdConnect logins fail with the error "Correlation failed."</span></span>
* <span data-ttu-id="93f58-172">Povolení konce &ndash; Identity se ztratí.</span><span class="sxs-lookup"><span data-stu-id="93f58-172">Authorization breaks &ndash; Identity is lost.</span></span>
* <span data-ttu-id="93f58-173">Data se ztratí stav relace.</span><span class="sxs-lookup"><span data-stu-id="93f58-173">Session state loses data.</span></span>
* <span data-ttu-id="93f58-174">Položky uložené v mezipaměti zmizí.</span><span class="sxs-lookup"><span data-stu-id="93f58-174">Cached items disappear.</span></span>
* <span data-ttu-id="93f58-175">TempData selže.</span><span class="sxs-lookup"><span data-stu-id="93f58-175">TempData fails.</span></span>
* <span data-ttu-id="93f58-176">Příspěvky selhání &ndash; selže kontrola proti padělání.</span><span class="sxs-lookup"><span data-stu-id="93f58-176">POSTs fail &ndash; The anti-forgery check fails.</span></span>

<span data-ttu-id="93f58-177">Další informace o konfiguraci ochrany dat pro webových farem, naleznete v tématu <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="93f58-177">For more information on Data Protection configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span> <span data-ttu-id="93f58-178">Další informace o konfiguraci ukládání do mezipaměti pro nasazení webové farmy, naleznete v tématu <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="93f58-178">For more information on Caching configuration for web farm deployments, see <xref:performance/caching/distributed>.</span></span>
